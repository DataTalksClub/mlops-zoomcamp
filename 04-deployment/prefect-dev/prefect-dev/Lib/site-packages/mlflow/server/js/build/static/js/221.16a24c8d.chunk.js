"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[221],{87877:function(e,t,n){n.d(t,{J:function(){return s},N:function(){return i}});var r=n(60669),a=n(46795);const s=e=>(t,n,a)=>{n?e().includes(n)?a(`Experiment "${n}" already exists.`):r.x.getExperimentByName({experiment_name:n}).then((e=>a(`Experiment "${n}" already exists in deleted state.\n                                 You can restore the experiment, or permanently delete the\n                                 experiment from the .trash folder (under tracking server's\n                                 root folder) in order to use this experiment name again.`))).catch((e=>a(void 0))):a(void 0)},i=(e,t,n)=>{t?a.x.getRegisteredModel({name:t}).then((()=>n(`Model "${t}" already exists.`))).catch((e=>n(void 0))):n(void 0)}},45653:function(e,t,n){n.d(t,{Qr:function(){return l},Xb:function(){return p},Y7:function(){return s},fx:function(){return i},yv:function(){return d}});var r=n(9133),a=n.n(r);const s=(e,t)=>{const n=a().truncate(e,{length:t});return a().takeWhile(n,(e=>"\n"!==e)).join("")},i=(e,t)=>{if(e.length>t){const n=Math.floor((t-3)/2),r=t-3-n;return e.substring(0,n)+"..."+e.substring(e.length-r,e.length)}return e},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=e=>{let t="",n=0;const r=c(e);for(;n<r.length;){const e=r.charCodeAt(n++),a=r.charCodeAt(n++),s=r.charCodeAt(n++),i=e>>2,l=(3&e)<<4|a>>4;let d=(15&a)<<2|s>>6,c=63&s;isNaN(a)?d=c=64:isNaN(s)&&(c=64),t=t+o.charAt(i)+o.charAt(l)+o.charAt(d)+o.charAt(c)}return t},d=e=>{let t="",n=0;const r=(null===e||void 0===e?void 0:e.replace(/[^A-Za-z0-9+/=]/g,""))||"";for(;n<r.length;){const e=o.indexOf(r.charAt(n++)),a=o.indexOf(r.charAt(n++)),s=o.indexOf(r.charAt(n++)),i=o.indexOf(r.charAt(n++)),l=e<<2|a>>4,d=(15&a)<<4|s>>2,c=(3&s)<<6|i;t+=String.fromCharCode(l),64!==s&&(t+=String.fromCharCode(d)),64!==i&&(t+=String.fromCharCode(c))}return u(t)},c=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/\r\n/g,"\n");let t="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);t+=r<128?String.fromCharCode(r):r>127&&r<2048?String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128)}return t},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="",n=0;for(;n<e.length;){const r=e.charCodeAt(n);if(r<128)t+=String.fromCharCode(r),n++;else if(r>191&&r<224){const a=e.charCodeAt(n+1);t+=String.fromCharCode((31&r)<<6|63&a),n+=2}else{const a=e.charCodeAt(n+1),s=e.charCodeAt(n+2);t+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&s),n+=3}}return t},p=e=>crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e)).then((e=>Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")))},12037:function(e,t,n){n.r(t),n.d(t,{default:function(){return Yo}});var r=n(89555),a=n(31014),s=n(10811),i=n(26809),o=n(93215),l=n(7204),d=n(3769),c=n(49409),u=n(67727),p=n(55794),m=n(36698),g=(n(63286),n(58481)),h=n(80683),f=n.n(h),v=n(67245),y=n(64912),x=n(50111);const b="experimentName",w="artifactLocation";class C extends a.Component{render(){return(0,x.FD)(c.lVW,{ref:this.props.innerRef,layout:"vertical",children:[(0,x.Y)(c.lVW.Item,{label:this.props.intl.formatMessage({id:"eyGoqW",defaultMessage:"Experiment Name"}),name:b,rules:[{required:!0,message:this.props.intl.formatMessage({id:"okQ1oB",defaultMessage:"Please input a new name for the new experiment."})},{validator:this.props.validator}],children:(0,x.Y)(c.pde,{placeholder:this.props.intl.formatMessage({id:"FZubuU",defaultMessage:"Input an experiment name"}),autoFocus:!0})}),(0,x.Y)(c.lVW.Item,{name:w,label:this.props.intl.formatMessage({id:"meoYKZ",defaultMessage:"Artifact Location"}),rules:[{required:!1}],children:(0,x.Y)(c.pde,{placeholder:this.props.intl.formatMessage({id:"WvHAEg",defaultMessage:"Input an artifact location (optional)"})})})]})}}const Y=(0,y.Ay)(C);var S=n(87877),A=n(72877),R=n(25869);class _ extends a.Component{constructor(){super(...arguments),this.handleCreateExperiment=async e=>{const t=e[b],n=e[w],r=await this.props.createExperimentApi(t,n);await this.props.searchExperimentsApi();const{value:{experiment_id:a}}=r;a&&this.props.navigate(g.h.getExperimentPageRoute(a))},this.debouncedExperimentNameValidator=f()((0,S.J)((()=>this.props.experimentNames)),400)}render(){const{isOpen:e}=this.props;return(0,x.Y)(v.B,{title:"Create Experiment",okText:"Create",isOpen:e,handleSubmit:this.handleCreateExperiment,onClose:this.props.onClose,children:(0,x.Y)(Y,{validator:this.debouncedExperimentNameValidator})})}}const I={createExperimentApi:i.Gh,searchExperimentsApi:i.vF},M=(0,R.h)((0,s.Ng)((e=>({experimentNames:(0,A.DZ)(e).map((e=>e.name))})),I)(_));var k=n(97026),E=n(76010);class T extends a.Component{constructor(){super(...arguments),this.handleSubmit=()=>{const{experimentId:e,activeExperimentIds:t}=this.props,n=(0,l.yk)();return this.props.deleteExperimentApi(e,n).then((()=>{if(null!==t&&void 0!==t&&t.includes(e))if(1===t.length)this.props.navigate(g.h.rootRoute);else{const n=t.filter((t=>t!==e)),r=1===n.length?g.h.getExperimentPageRoute(n[0]):g.h.getCompareExperimentsPageRoute(n);this.props.navigate(r)}})).then((()=>this.props.searchExperimentsApi(n))).catch((e=>{E.A.logErrorAndNotifyUser(e)}))}}render(){return(0,x.Y)(k.u,{isOpen:this.props.isOpen,onClose:this.props.onClose,handleSubmit:this.handleSubmit,title:`Delete Experiment "${this.props.experimentName}"`,helpText:(0,x.FD)("div",{children:[(0,x.Y)("p",{children:(0,x.FD)("b",{children:['Experiment "',this.props.experimentName,'" (Experiment ID: ',this.props.experimentId,") will be deleted."]})}),""]}),confirmButtonText:"Delete"})}}const D={deleteExperimentApi:i.lJ,searchExperimentsApi:i.vF},F=(0,R.h)((0,s.Ng)(void 0,D)(T));var L=n(58645);class P extends a.Component{constructor(){super(...arguments),this.handleRenameExperiment=e=>{const t=e[L.m];return this.props.updateExperimentApi(this.props.experimentId,t).then((()=>this.props.getExperimentApi(this.props.experimentId)))},this.debouncedExperimentNameValidator=f()((0,S.J)((()=>this.props.experimentNames)),400)}render(){const{isOpen:e,experimentName:t}=this.props;return(0,x.Y)(v.B,{title:"Rename Experiment",okText:"Save",isOpen:e,handleSubmit:this.handleRenameExperiment,onClose:this.props.onClose,children:(0,x.Y)(L.P,{type:"experiment",name:t,visible:e,validator:this.debouncedExperimentNameValidator})})}}const B={updateExperimentApi:i.Td,getExperimentApi:i.yc},N=(0,s.Ng)((e=>({experimentNames:(0,A.DZ)(e).map((e=>e.name))})),B)(P);var H=n(73287);class O extends a.Component{constructor(){super(...arguments),this.list=void 0,this.state={checkedKeys:this.props.activeExperimentIds,hidden:!1,searchInput:"",showCreateExperimentModal:!1,showDeleteExperimentModal:!1,showRenameExperimentModal:!1,selectedExperimentId:"0",selectedExperimentName:""},this.bindListRef=e=>{this.list=e},this.componentDidUpdate=()=>{this.list&&this.list.forceUpdateGrid()},this.filterExperiments=e=>{const{experiments:t}=this.props,n=e.toLowerCase();return""===n?this.props.experiments:t.filter((e=>{let{name:t}=e;return t.toLowerCase().includes(n)}))},this.handleSearchInputChange=e=>{this.setState({searchInput:e.target.value})},this.updateSelectedExperiment=(e,t)=>{this.setState({selectedExperimentId:e,selectedExperimentName:t})},this.handleCreateExperiment=()=>{this.setState({showCreateExperimentModal:!0})},this.handleDeleteExperiment=(e,t)=>()=>{this.setState({showDeleteExperimentModal:!0}),this.updateSelectedExperiment(e,t)},this.handleRenameExperiment=(e,t)=>()=>{this.setState({showRenameExperimentModal:!0}),this.updateSelectedExperiment(e,t)},this.handleCloseCreateExperimentModal=()=>{this.setState({showCreateExperimentModal:!1})},this.handleCloseDeleteExperimentModal=()=>{this.setState({showDeleteExperimentModal:!1}),this.updateSelectedExperiment("0","")},this.handleCloseRenameExperimentModal=()=>{this.setState({showRenameExperimentModal:!1}),this.updateSelectedExperiment("0","")},this.handleCheck=(e,t)=>{this.setState(((n,r)=>{let{checkedKeys:a}=n;return!0!==e||r.activeExperimentIds.includes(t)||(a=[t,...r.activeExperimentIds]),!1===e&&1!==r.activeExperimentIds.length&&(a=r.activeExperimentIds.filter((e=>e!==t))),{checkedKeys:a}}),this.pushExperimentRoute)},this.pushExperimentRoute=()=>{if(this.state.checkedKeys.length>0){const e=1===this.state.checkedKeys.length?g.h.getExperimentPageRoute(this.state.checkedKeys[0]):g.h.getCompareExperimentsPageRoute(this.state.checkedKeys);this.props.navigate(e)}},this.activeExperimentListItem=U.getExperimentListItemContainer(!0,this.props.designSystemThemeApi.theme),this.inactiveExperimentListItem=U.getExperimentListItemContainer(!1,this.props.designSystemThemeApi.theme),this.renderListItem=e=>{let{index:t,key:n,style:r,isScrolling:a,parent:s}=e;const i=s.props.data[t],{activeExperimentIds:l}=this.props,d=l.includes(i.experimentId),u=d?"active-experiment-list-item":"experiment-list-item";return(0,x.Y)("div",{css:d?this.activeExperimentListItem:this.inactiveExperimentListItem,"data-testid":u,style:r,children:(0,x.Y)(p.Ay.Item,{bordered:"false",prefixCls:"experiment-list-meta",css:U.experimentListItem,actions:[(0,x.Y)(c.Sc0,{id:i.experimentId,onChange:e=>this.handleCheck(e,i.experimentId),isChecked:d,"data-testid":`${u}-check-box`},i.experimentId),(0,x.Y)(o.N_,{className:"experiment-link",to:g.h.getExperimentPageRoute(i.experimentId),onClick:()=>this.setState({checkedKeys:[i.experimentId]}),title:i.name,"data-testid":`${u}-link`,children:i.name}),(0,x.Y)(H.K,{icon:(0,x.Y)(c.R2l,{}),onClick:this.handleRenameExperiment(i.experimentId,i.name),"data-testid":"rename-experiment-button",css:U.renameExperiment}),(0,x.Y)(H.K,{icon:(0,x.Y)("i",{className:"far fa-trash-o"}),onClick:this.handleDeleteExperiment(i.experimentId,i.name),css:U.deleteExperiment,"data-testid":"delete-experiment-button"})]},i.experimentId)},n)},this.isRowLoaded=e=>{let{index:t}=e;return!!this.props.experiments[t]},this.unHide=()=>this.setState({hidden:!1}),this.hide=()=>this.setState({hidden:!0})}render(){const{hidden:e}=this.state,{activeExperimentIds:t,designSystemThemeApi:n}=this.props,{theme:r}=n;if(e)return(0,x.Y)(c.iTX,{rotate:-90,onClick:this.unHide,css:U.icon(r),title:"Show experiment list"});const{searchInput:a}=this.state,s=this.filterExperiments(a);return(0,x.FD)("div",{id:"experiment-list-outer-container",css:U.experimentListOuterContainer,children:[(0,x.Y)(M,{isOpen:this.state.showCreateExperimentModal,onClose:this.handleCloseCreateExperimentModal}),(0,x.Y)(F,{isOpen:this.state.showDeleteExperimentModal,onClose:this.handleCloseDeleteExperimentModal,activeExperimentIds:t,experimentId:this.state.selectedExperimentId,experimentName:this.state.selectedExperimentName}),(0,x.Y)(N,{isOpen:this.state.showRenameExperimentModal,onClose:this.handleCloseRenameExperimentModal,experimentId:this.state.selectedExperimentId,experimentName:this.state.selectedExperimentName}),(0,x.FD)("div",{css:U.experimentTitleContainer,children:[(0,x.Y)(u.T.Title,{level:2,style:{margin:0},children:"Experiments"}),(0,x.FD)("div",{children:[(0,x.Y)(c.GYj,{onClick:this.handleCreateExperiment,css:U.icon(r),title:"New Experiment","data-testid":"create-experiment-button"}),(0,x.Y)(c.iTX,{onClick:this.hide,rotate:90,css:U.icon(r),title:"Hide experiment list"})]})]}),(0,x.Y)(c.pde,{placeholder:"Search Experiments","aria-label":"search experiments",value:a,onChange:this.handleSearchInputChange,"data-testid":"search-experiment-input"}),(0,x.Y)("div",{children:(0,x.Y)(m.t$,{children:e=>{let{width:t,height:n}=e;return(0,x.Y)(m.B8,{rowRenderer:this.renderListItem,data:s,ref:this.bindListRef,rowHeight:32,overscanRowCount:10,height:n,width:t,rowCount:s.length})}})})]})}}const U={experimentListOuterContainer:{name:"ddhbat",styles:"box-sizing:border-box;height:100%;margin-left:24px;margin-right:8px;padding-right:16px;width:100%;min-width:max(280px, 20vw);max-width:20vw;display:grid;grid-template-rows:auto auto 1fr"},experimentTitleContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},experimentTitle:{margin:0},experimentSearchContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2px"},experimentSearchInput:{margin:0,flex:"6 1 0"},experimentSearchIcon:{fontSize:"24px",marginLeft:"auto",flex:"1 1 0"},experimentListContainer:{marginTop:"12px"},getExperimentListItemContainer:(e,t)=>(0,r.AH)({display:"flex",marginRight:"8px",paddingRight:"5px",borderLeft:e?`solid ${t.colors.primary}`:"solid transparent",borderLeftWidth:4,backgroundColor:e?t.colors.actionDefaultBackgroundPress:"transparent"},""),experimentListItem:{name:"1d2tbd2",styles:"display:grid;width:100%;.experiment-list-meta-item-action{display:grid;grid-template-columns:auto 1fr auto auto;padding-left:0px;margin-bottom:4px;margin-top:4px;li{padding-right:4px;padding-left:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:left;font-size:13px;}}"},renameExperiment:{justifySelf:"end"},deleteExperiment:{justifySelf:"end",marginRight:"10px"},icon:e=>({color:e.colors.actionDefaultTextDefault,fontSize:e.general.iconSize,marginLeft:e.spacing.xs})};var K=(0,R.h)((0,u.V)(O)),z=n(24947),V=n(9133);const G=(0,a.createContext)(null),q=e=>{let{children:t,actions:n}=e;const[r,i]=(0,a.useState)([]),[o,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),p=(0,s.wA)(),m=(0,a.useCallback)((e=>{u(null),(()=>{const t=e.map((e=>{const t=n.getExperimentApi(e);return p(t).catch((e=>{E.A.logErrorAndNotifyUser(e)})),t.meta.id}));i((e=>(0,V.isEqual)(t,e)?e:t))})()}),[n,p]),g=(0,a.useMemo)((()=>({fetchExperiments:m,isLoadingExperiment:o,requestError:c,actions:n})),[n,m,o,c]);return(0,x.Y)(G.Provider,{value:g,children:(0,x.Y)(d.Ay,{shouldOptimisticallyRender:!0,requestIds:r,children:(e,n,a)=>(l(a.some((e=>r.includes(e.id)&&e.active))),c||a.forEach((e=>{e.error&&u(e.error)})),t)})})};var $=n(47664),W=n(64558);var j=n.p+"static/media/permission-denied-lock.16036747d57cd663d7df223781a447b2.svg";function Q(e){let{errorMessage:t}=e;const{theme:n}=(0,u.u)();return(0,x.FD)("div",{className:"center",children:[(0,x.Y)("img",{style:{height:300,marginTop:80},src:j,alt:"permission denied"}),(0,x.Y)("h1",{style:{paddingTop:10},children:"Permission Denied"}),(0,x.Y)("h2",{"data-testid":"error-message",css:(0,r.AH)({color:n.colors.textSecondary},""),children:t||"The current user does not have permission to view this page."})]})}var J=n(91167),X=n(88443),Z=n(32614);const ee=e=>(0,a.useMemo)((()=>Z.A.getStoreForComponent("ExperimentView",e)),[e]);var te=n(30214),ne=n(91144);const re="compareRunsMode",ae=()=>(0,ne.xt)()?"CHART":"TABLE",se=()=>{const[e,t]=(0,o.ok)();return[e.get(re)||ae(),e=>{t((t=>(t.set(re,e||""),t)),{replace:!1})}]};const ie="seenBefore";var oe={name:"b98nv4",styles:"position:absolute;inset:0"},le={name:"1ww443i",styles:"max-width:200px"},de={name:"2qga7i",styles:"text-align:right"};const ce=e=>{let{multipleRunsSelected:t,isTableMode:n}=e;const r=ee("compareRunsTooltip"),[s,i]=(0,a.useState)(t&&!r.getItem(ie));(0,a.useEffect)((()=>{const e=r.getItem(ie);i(!(!t||!n||e))}),[t,n,r]);const o=(0,a.useCallback)((e=>{i(e),r.setItem(ie,!0)}),[i,r]);return(0,x.Y)(x.FK,{children:(0,x.FD)(J.P.Root,{open:s,children:[(0,x.Y)(J.P.Trigger,{asChild:!0,children:(0,x.Y)("div",{css:oe})}),(0,x.FD)(J.P.Content,{align:"start",children:[(0,x.FD)("div",{css:le,children:[(0,x.Y)(u.T.Paragraph,{children:(0,x.Y)(X.A,{id:"1ECve7",defaultMessage:"You can now switch to the chart view to compare runs"})}),(0,x.Y)("div",{css:de,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsmodeswitch.tsx_65",onClick:()=>o(!1),type:"primary",children:(0,x.Y)(X.A,{id:"khknxG",defaultMessage:"Got it"})})})]}),(0,x.Y)(J.P.Arrow,{})]})]})})},ue=e=>{let{viewState:t,runsAreGrouped:n,hideBorder:r=!0}=e;const[a,s]=se(),{classNamePrefix:i}=(0,u.u)(),o=a||ae();return(0,x.FD)(c.tUM,{dangerouslyAppendEmotionCSS:{[`.${i}-tabs-nav`]:{marginBottom:0,"::before":{display:r?"none":"block"}}},activeKey:o,onChange:e=>{o!==e&&s(e)},children:[(0,x.Y)(c.tUM.TabPane,{tab:(0,x.Y)("span",{"data-testid":"experiment-runs-mode-switch-list",children:(0,x.Y)(X.A,{id:"YOz/Dk",defaultMessage:"Table"})})},"TABLE"),(0,x.Y)(c.tUM.TabPane,{tab:(0,x.FD)(x.FK,{children:[(0,x.Y)("span",{"data-testid":"experiment-runs-mode-switch-compare",children:(0,x.Y)(X.A,{id:"KOQzJx",defaultMessage:"Chart"})}),(0,x.Y)(ce,{isTableMode:"TABLE"===a,multipleRunsSelected:!!t&&Object.keys(t.runsSelected).length>1})]})},"CHART"),(0,x.Y)(c.tUM.TabPane,{disabled:n,tab:(0,x.Y)(c.m_M,{title:n?(0,x.Y)(X.A,{id:"YOp3/x",defaultMessage:"Unavailable when runs are grouped"}):void 0,children:(0,x.FD)("span",{"data-testid":"experiment-runs-mode-switch-evaluation",children:[(0,x.Y)(X.A,{id:"SCqKp8",defaultMessage:"Evaluation"}),(0,x.Y)(te.W,{})]})})},"ARTIFACT"),(0,ne.XK)()&&(0,x.Y)(c.tUM.TabPane,{tab:(0,x.FD)("span",{"data-testid":"experiment-runs-mode-switch-traces",children:[(0,x.Y)(X.A,{id:"AGQOPV",defaultMessage:"Traces"}),(0,x.Y)(te.W,{})]})},"TRACES")]})};var pe=n(60669),me=n(69526);const ge="mlflow.traceName",he=(e,t)=>{var n,r;return null===(n=e.request_metadata)||void 0===n||null===(r=n.find((e=>{let{key:n}=e;return n===t})))||void 0===r?void 0:r.value},fe=e=>he(e,"mlflow.sourceRun"),ve=e=>he(e,"total_tokens"),ye=(e,t)=>{var n,r;return null===(n=e.tags)||void 0===n||null===(r=n.find((e=>{let{key:n}=e;return n===t})))||void 0===r?void 0:r.value},xe=["timestamp_ms"];let be=function(e){return e.requestId="request_id",e.traceName="traceName",e.timestampMs="timestamp_ms",e.inputs="inputs",e.outputs="outputs",e.runName="runName",e.totalTokens="total_tokens",e.source="source",e.latency="latency",e.tags="tags",e.status="status",e}({});const we={[be.requestId]:(0,me.zR)({id:"0HqSXX",defaultMessage:"Request ID"}),[be.traceName]:(0,me.zR)({id:"60C/WF",defaultMessage:"Trace name"}),[be.timestampMs]:(0,me.zR)({id:"V3BImd",defaultMessage:"Time created"}),[be.status]:(0,me.zR)({id:"PBkS4s",defaultMessage:"Status"}),[be.inputs]:(0,me.zR)({id:"TQZ+X6",defaultMessage:"Request"}),[be.outputs]:(0,me.zR)({id:"pHAqL+",defaultMessage:"Response"}),[be.runName]:(0,me.zR)({id:"yltHdB",defaultMessage:"Run name"}),[be.totalTokens]:(0,me.zR)({id:"O5FKCr",defaultMessage:"Tokens"}),[be.source]:(0,me.zR)({id:"eM4+ab",defaultMessage:"Source"}),[be.latency]:(0,me.zR)({id:"6oYktw",defaultMessage:"Execution time"}),[be.tags]:(0,me.zR)({id:"4qVc2+",defaultMessage:"Tags"})},Ce={UNSET:null,IN_PROGRESS:(0,me.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,me.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,me.zR)({id:"igK5Su",defaultMessage:"Error"})};var Ye=n(50361);const Se=e=>`run_id IN (${e.map((e=>`'${e}'`)).join(",")})`,Ae=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const[r,s]=(0,a.useState)([]),[i,o]=(0,a.useState)(!0),[l,d]=(0,a.useState)(void 0),c=(0,a.useMemo)((()=>{const e=(0,V.first)(t);return e&&xe.includes(e.id)?`${e.id} ${e.desc?"DESC":"ASC"}`:"timestamp_ms DESC"}),[t]),[u,p]=(0,a.useState)({0:void 0}),[m,g]=(0,a.useState)(0),h=(0,a.useCallback)((async e=>{let{experimentIds:t,currentPage:n=0,pageToken:r,silent:a,orderByString:i="",filterString:l=""}=e;a||o(!0),d(void 0);try{const e=await pe.x.getExperimentTraces(t,i,r,l);if(!e.traces)return void s([]);const a=await(async(e,t)=>{const n=t.reduce(((e,t)=>{const n=t.request_id,r=fe(t);return n&&r?{...e,[n]:r}:e}),{}),r=(0,V.uniq)((0,V.values)(n));if(r.length<1)return{};const a=((await pe.x.searchRuns({experiment_ids:e,filter:Se(r),run_view_type:Ye.qi.ALL})).runs||[]).reduce(((e,t)=>({...e,[t.info.runUuid]:t.info.runName})),{});return t.reduce(((e,t)=>{const r=t.request_id;if(!r)return e;const s=n[r];return{...e,[r]:a[s]||s}}),{})})(t,e.traces),o=e.traces.map((e=>{const t=e.request_id;if(!t)return{...e};const n=a[t];return{...e,runName:n}}));s(o),p((t=>({...t,[n+1]:e.next_page_token})))}catch(c){d(c)}finally{o(!1)}}),[]),f=!i&&void 0!==u[m+1],v=!i&&(1===m||void 0!==u[m-1]);(0,a.useEffect)((()=>{h({experimentIds:e,filterString:n,orderByString:c})}),[h,n,e,c]);const y=(0,a.useCallback)((()=>{s([]),p({0:void 0}),g(0),h({experimentIds:e})}),[h,e]),x=(0,a.useCallback)((()=>{g((e=>e+1)),h({experimentIds:e,currentPage:m+1,pageToken:u[m+1],filterString:n,orderByString:c})}),[e,m,h,u,n,c]),b=(0,a.useCallback)((()=>{g((e=>e-1)),h({experimentIds:e,currentPage:m-1,pageToken:u[m-1],filterString:n,orderByString:c})}),[e,m,h,u,n,c]),w=(0,a.useCallback)((function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h({experimentIds:e,currentPage:m,pageToken:u[m],silent:t,filterString:n,orderByString:c})}),[e,m,h,u,n,c]);return{traces:r,loading:i,error:l,hasNextPage:f,hasPreviousPage:v,fetchNextPage:x,fetchPrevPage:b,refreshCurrentPage:w,reset:y}};var Re=n(70618),_e=n(9856),Ie=n(88464),Me=n(98590),ke=n(98597);var Ee={name:"1wcfv52",styles:"margin-right:0"};const Te=e=>{let{onAddEditTags:t,tags:n}=e;const{theme:a}=(0,u.u)(),s=(null===n||void 0===n?void 0:n.filter((e=>{let{key:t}=e;return t&&!t.startsWith(Me.nt)})))||[],i=s.length>0;return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"flex-start",flexWrap:"wrap",columnGap:a.spacing.xs/2,rowGap:a.spacing.xs/2},""),children:[s.map((e=>(0,x.Y)(ke.tj,{tag:e,css:Ee,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key)))," ",(0,x.Y)(u.B,{componentId:"mlflow.experiment_page.traces_table.edit_tag",size:"small",icon:i?(0,x.Y)(c.R2l,{}):(0,x.Y)(c.IPx,{}),onClick:t})]})};var De=n(52350);const Fe=(e,t)=>"IN_PROGRESS"===e?(0,x.Y)(c.O4,{css:(0,r.AH)({color:t.colors.textValidationWarning},"")}):"OK"===e?(0,x.Y)(c.C1y,{css:(0,r.AH)({color:t.colors.textValidationSuccess},"")}):"ERROR"===e?(0,x.Y)(c.qhh,{css:(0,r.AH)({color:t.colors.textValidationDanger},"")}):null,Le=e=>{let{row:{original:t}}=e;const{theme:n}=(0,u.u)(),a=(0,Ie.A)(),s=Ce[t.status||"UNSET"];return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[Fe(t.status,n),s?a.formatMessage(s):""]})};var Pe={name:"ozd7xs",styles:"flex-shrink:0"},Be={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Ne=e=>{let{value:t,traceId:n,previewFieldName:s}=e;const{theme:i}=(0,u.u)(),[o,l]=(0,a.useState)(!1),[d,p]=(0,a.useState)(null),[m,g]=(0,a.useState)(!1),h=(0,a.useCallback)((async()=>{g(!0);try{const e=await pe.x.getExperimentTraceData(n);if(s in e){const t=e[s],n=(0,V.isString)(t)?t:JSON.stringify(t);p(n)}}catch(e){const t=e instanceof De.s?e.getUserVisibleError():e.message;E.A.logErrorAndNotifyUser(`Error fetching response: ${t}`)}g(!1)}),[s,n]),f=(0,a.useCallback)((async()=>{d||await h(),l(!0)}),[d,h]),v=(0,a.useCallback)((()=>{l(!1)}),[]),y=t.length>=250;return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:i.spacing.xs},""),children:[y&&(0,x.Y)(u.B,{componentId:"mlflow.experiment_page.traces_table.expand_cell_preview",size:"small",icon:o?(0,x.Y)(c.D3D,{}):(0,x.Y)(c.vKP,{}),onClick:o?v:f,css:Pe,loading:m,type:"primary"}),(0,x.Y)("div",{title:t,css:Be,children:o?(0,x.Y)(He,{value:null!==d&&void 0!==d?d:t}):t})]})},He=e=>{let{value:t}=e;const n=(0,a.useMemo)((()=>{try{const e=JSON.parse(t);return JSON.stringify(e,null,2)}catch(e){return null}}),[t]);return(0,x.Y)("div",{css:(0,r.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:n?"monospace":void 0},""),children:n||t})},Oe=e=>{let{row:{original:t}}=e;return(0,x.Y)(Ne,{previewFieldName:"request",traceId:t.request_id||"",value:(n=t,he(n,"mlflow.traceInputs")||"")});var n},Ue=e=>{let{row:{original:t}}=e;return(0,x.Y)(Ne,{previewFieldName:"response",traceId:t.request_id||"",value:(n=t,he(n,"mlflow.traceOutputs")||"")});var n};var Ke=n(1323);var ze={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Ve=a.memo((e=>{var t;let{value:n}=e;const{theme:a}=(0,u.u)();if(!n)return(0,x.Y)(x.FK,{children:"-"});const s=(null===(t=n[E.A.sourceTypeTag])||void 0===t?void 0:t.value)||"",i=E.A.renderSource(n||{},void 0,void 0);return i?(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:a.spacing.xs,alignItems:"center"},""),children:[(0,x.Y)(Ke.m,{sourceType:s,css:(0,r.AH)({color:a.colors.textSecondary},"")}),(0,x.Y)("span",{css:ze,children:i})]}):(0,x.Y)(x.FK,{children:"-"})})),Ge=e=>{let{row:{original:t}}=e;return(0,x.Y)(Ve,{value:(0,V.keyBy)(t.tags,"key")})},qe=e=>`--header-${e}-size`,$e=e=>`--col-${e}-size`,We=e=>{let{table:t}=e;const{theme:n}=(0,u.u)();return(0,x.Y)(x.FK,{children:t.getRowModel().rows.map((e=>(0,x.Y)("div",{"data-testid":"endpoints-list-table-rows",css:(0,r.AH)({minHeight:n.general.buttonHeight,display:"flex",flexDirection:"row",":hover":{backgroundColor:"var(--table-row-hover)"}},""),children:e.getAllCells().map((e=>{var t,r;const a=null===(t=e.column.columnDef.meta)||void 0===t?void 0:t.multiline;return(0,x.Y)("div",{role:"cell",css:[{"--table-row-vertical-padding":`${n.spacing.sm}px`,flex:`calc(var(${$e(e.column.id)}) / 100)`,overflow:"hidden",borderBottom:"1px solid var(--table-separator-color)",whiteSpace:a?"pre-wrap":"nowrap",textOverflow:a?"ellipsis":void 0,padding:`${n.spacing.sm}px ${n.spacing.xs}px`},null===(r=e.column.columnDef.meta)||void 0===r?void 0:r.styles,""],children:(0,Re.Kv)(e.column.columnDef.cell,e.getContext())},e.id)}))},e.id)))})},je=a.memo(We,((e,t)=>e.table.options.data===t.table.options.data&&e.columns===t.columns));var Qe={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"},Je={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"},Xe={name:"hgn0g7",styles:"max-width:100%;text-overflow:ellipsis;display:inline-block;overflow:hidden"};const Ze=a.memo((e=>{let{traces:t,loading:n,error:r,onTraceClicked:s,onTraceTagsEdit:i,hasNextPage:l,hasPreviousPage:d,onNextPage:p,onPreviousPage:m,usingFilters:h,onResetFilters:f,sorting:v,setSorting:y,hiddenColumns:b=[],disableTokenColumn:w}=e;const C=(0,Ie.A)(),{theme:Y}=(0,u.u)(),S=(0,a.useMemo)((()=>{const e=[{header:C.formatMessage(we[be.requestId]),enableSorting:!1,enableResizing:!0,id:be.requestId,cell(e){let{row:{original:t}}=e;return(0,x.Y)(u.T.Link,{ellipsis:!0,css:Qe,onClick:()=>{null===s||void 0===s||s(t)},children:t.request_id})},meta:{styles:{minWidth:200}}},{header:C.formatMessage(we[be.traceName]),enableSorting:!1,enableResizing:!0,id:be.traceName,cell(e){let{row:{original:t}}=e;return(0,x.Y)(u.T.Link,{ellipsis:!0,css:Je,onClick:()=>{null===s||void 0===s||s(t)},children:ye(t,ge)})},meta:{styles:{minWidth:150}}},{header:C.formatMessage(we[be.timestampMs]),id:be.timestampMs,accessorFn:e=>e.timestamp_ms,enableSorting:!0,enableResizing:!1,cell(e){let{row:{original:t}}=e;return t.timestamp_ms?(0,x.Y)(c.m_M,{title:new Date(t.timestamp_ms).toLocaleString(navigator.language,{timeZoneName:"short"}),placement:"right",children:(0,x.Y)("span",{children:E.A.timeSinceStr(t.timestamp_ms)})}):null},meta:{styles:{minWidth:140,maxWidth:140}}},{header:C.formatMessage(we[be.status]),id:be.status,enableSorting:!1,enableResizing:!1,cell:Le,meta:{styles:{minWidth:110,maxWidth:110}}},{header:C.formatMessage(we[be.inputs]),id:be.inputs,enableSorting:!1,enableResizing:!0,cell:Oe,meta:{multiline:!0}},{header:C.formatMessage(we[be.outputs]),enableSorting:!1,enableResizing:!0,id:be.outputs,cell:Ue,meta:{multiline:!0}},{header:C.formatMessage(we[be.runName]),enableSorting:!1,enableResizing:!0,id:be.runName,cell(e){let{row:{original:t}}=e;const n=fe(t);if(!n||!t.experiment_id)return null;const r=t.runName||n;return(0,x.Y)(o.N_,{css:Xe,to:g.h.getRunPageRoute(t.experiment_id,n),children:r})}},{header:C.formatMessage(we[be.source]),enableSorting:!0,enableResizing:!0,id:be.source,cell:Ge,meta:{styles:{minWidth:100}}}];return w||e.push({header:C.formatMessage(we[be.totalTokens]),enableSorting:!1,enableResizing:!0,id:be.totalTokens,accessorFn:e=>ve(e),meta:{styles:{minWidth:80,maxWidth:80}}}),e.push({header:C.formatMessage(we[be.latency]),enableSorting:!1,enableResizing:!1,id:be.latency,accessorFn:e=>(0,V.isNil)(e.execution_time_ms)||!isFinite(e.execution_time_ms)?null:E.A.formatDuration(e.execution_time_ms),meta:{styles:{width:120}}},{header:C.formatMessage(we[be.tags]),enableSorting:!1,enableResizing:!0,id:be.tags,cell(e){let{row:{original:t}}=e;return(0,x.Y)(Te,{tags:t.tags||[],onAddEditTags:()=>null===i||void 0===i?void 0:i(t)})}}),e.filter((e=>e.id&&!b.includes(e.id)))}),[C,s,i,w,b]),A=(0,Re.N4)({columns:S,data:t,state:{sorting:v},getCoreRowModel:(0,_e.HT)(),getRowId:(e,t)=>e.request_id||t.toString(),getSortedRowModel:(0,_e.h5)(),onSortingChange:y,enableColumnResizing:!0,columnResizeMode:"onChange"}),R=A.getState().columnSizingInfo,_=a.useMemo((()=>{const e=A.getFlatHeaders(),t={};return e.forEach((e=>{t[qe(e.id)]=e.getSize(),t[$e(e.column.id)]=e.column.getSize()})),t}),[R,S,A]);return(0,x.Y)(x.FK,{children:(0,x.FD)(c.XIK,{scrollable:!0,empty:(()=>{if(r){const e=r instanceof De.s?r.getMessageField():r.message;return(0,x.Y)(c.SvL,{image:(0,x.Y)(u.q,{}),description:e,title:(0,x.Y)(X.A,{id:"Cj2i02",defaultMessage:"Error"})})}return!n&&0===t.length&&h?(0,x.Y)(c.SvL,{description:(0,x.Y)(X.A,{id:"LTe7m4",defaultMessage:"No traces found with the current filter query. <button>Reset filters</button> to see all traces.",values:{button:e=>(0,x.Y)(u.T.Link,{onClick:f,children:e})}}),title:(0,x.Y)(X.A,{id:"yeEPjS",defaultMessage:"No traces found"})}):n||0!==t.length?null:(0,x.Y)(c.SvL,{description:null,title:(0,x.Y)(X.A,{id:"n31miD",defaultMessage:"No traces recorded"})})})(),style:_,pagination:(0,x.Y)(c.vIA,{hasNextPage:l,hasPreviousPage:d,onNextPage:p,onPreviousPage:m}),children:[(0,x.Y)(c.Hjg,{isHeader:!0,children:A.getLeafHeaders().map((e=>{var t;return(0,x.Y)(c.A0N,{css:null===(t=e.column.columnDef.meta)||void 0===t?void 0:t.styles,sortable:e.column.getCanSort(),sortDirection:e.column.getIsSorted()||"none",onToggleSort:e.column.getToggleSortingHandler(),resizable:e.column.getCanResize(),resizeHandler:e.getResizeHandler(),isResizing:e.column.getIsResizing(),style:{flex:`calc(var(${qe(e.id)}) / 100)`},children:(0,Re.Kv)(e.column.columnDef.header,e.getContext())},e.id)}))}),n&&(0,x.Y)(c.BAM,{table:A}),!n&&!r&&(0,x.Y)(je,{table:A,columns:S})]})})})),et=e=>{let{modelTrace:t,height:n=700,useLatestVersion:s=!1}=e;const i=(0,a.useRef)(null),[o,l]=a.useState(!0);return(0,a.useEffect)((()=>{const e=e=>{var t;const n=null===(t=i.current)||void 0===t?void 0:t.contentWindow;if(n&&e.source===n&&e.data.type===tt.Ready)l(!1)};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[t]),(0,a.useEffect)((()=>{var e;const n=null===(e=i.current)||void 0===e?void 0:e.contentWindow;n&&!o&&n.postMessage({type:nt.UpdateTrace,traceData:t})}),[t,o]),(0,x.FD)("div",{css:(0,r.AH)({height:n},""),children:[o&&(0,x.FD)("div",{css:(0,r.AH)({position:"absolute",width:"100%",height:n},""),children:[(0,x.Y)(c.oud,{}),(0,x.Y)(c.QvX,{lines:5})]}),(0,x.Y)("iframe",{title:"Model Trace Explorer",src:"static-files/lib/ml-model-trace-renderer/index.html",ref:i,css:(0,r.AH)({border:"none",width:"100%",height:n},"")})]})};let tt=function(e){return e.Ready="READY",e}({}),nt=function(e){return e.UpdateTrace="UPDATE_TRACE",e}({});const rt=e=>{let{requestId:t,traceInfo:n,loadingTraceInfo:s,onClose:i}=e;const{traceData:o,loading:l,error:d}=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[n,r]=(0,a.useState)(void 0),[s,i]=(0,a.useState)(!1),[o,l]=(0,a.useState)(void 0),d=(0,a.useCallback)((async e=>{i(!0);try{const t=await pe.x.getExperimentTraceData(e);Array.isArray(t.spans)?r(t):E.A.logErrorAndNotifyUser("Invalid trace data response: "+JSON.stringify(null===t||void 0===t?void 0:t.toString()))}catch(t){l(t)}i(!1)}),[]);return(0,a.useEffect)((()=>{e&&!t&&d(e)}),[d,e,t]),{traceData:n,loading:s,error:o}}(t,"IN_PROGRESS"===(null===n||void 0===n?void 0:n.status)),{theme:p}=(0,u.u)(),m=!s&&!n,{traceInfo:g,loading:h}=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[n,r]=(0,a.useState)(void 0),[s,i]=(0,a.useState)(t),[o,l]=(0,a.useState)(void 0),d=(0,a.useCallback)((async()=>{if(t){l(void 0);try{const t=await pe.x.getExperimentTraceInfo(e);if(!t.trace_info)return void r(void 0);r(t.trace_info)}catch(n){l(n)}finally{i(!1)}}}),[t,e]);return(0,a.useEffect)((()=>{d()}),[d]),{traceInfo:n,loading:s,error:o}}(t,m),f=n||g,v=(0,a.useMemo)((()=>s||h?(0,x.Y)(c.oud,{}):f?(e=>ye(e,ge)||e.request_id)(f):t),[f,s,h,t]),y=(0,a.useMemo)((()=>o?{trace_info:f||{},info:f||{},trace_data:o,data:o}:void 0),[o,f]),b=((null===o||void 0===o?void 0:o.spans)||[]).length>0;return(0,x.Y)(c._s.Root,{modal:!0,open:!0,onOpenChange:e=>{e||i()},children:(0,x.Y)(c._s.Content,{width:"85vw",title:v,expandContentToFullHeight:!0,children:(()=>{if(l||s||h)return(0,x.FD)(x.FK,{children:[(0,x.Y)(c.oud,{}),(0,x.Y)(c.QvX,{lines:5})]});if("IN_PROGRESS"===(null===n||void 0===n?void 0:n.status))return(0,x.FD)(x.FK,{children:[(0,x.Y)(J.S,{size:"lg"}),(0,x.Y)(c.SvL,{image:(0,x.Y)(u.W,{}),description:(0,x.Y)(X.A,{id:"K+5g8S",defaultMessage:"Trace data is not available for in-progress traces. Please wait for the trace to complete."}),title:(0,x.Y)(X.A,{id:"p0O0uP",defaultMessage:"Trace data not available"})})]});if(d){d instanceof De.s?d.getMessageField():d.message;return(0,x.FD)(x.FK,{children:[(0,x.Y)(J.S,{size:"lg"}),(0,x.Y)(c.SvL,{image:(0,x.Y)(u.W,{}),description:(0,x.Y)(X.A,{id:"K+5g8S",defaultMessage:"Trace data is not available for in-progress traces. Please wait for the trace to complete."}),title:(0,x.Y)(X.A,{id:"p0O0uP",defaultMessage:"Trace data not available"})})]})}return b?y?(0,x.Y)("div",{css:(0,r.AH)({height:`calc(100% - ${p.spacing.lg}px)`,marginLeft:-p.spacing.lg,marginRight:-p.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,x.Y)(et,{modelTrace:y,height:"100%"})}):null:(0,x.FD)(x.FK,{children:[(0,x.Y)(J.S,{size:"lg"}),(0,x.Y)(c.SvL,{description:null,title:(0,x.Y)(X.A,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]})})()})})};var at=n(43683);const st=()=>{const{theme:e}=(0,u.u)();return(0,x.FD)(J.P.Root,{modal:!1,children:[(0,x.Y)(J.P.Trigger,{asChild:!0,children:(0,x.Y)(u.B,{size:"small",type:"link",icon:(0,x.Y)(c.mo0,{css:(0,r.AH)({svg:{width:16,height:16,color:e.colors.textSecondary}},"")}),componentId:"mlflow.experiment_page.traces_table.filter_tooltip"})}),(0,x.FD)(J.P.Content,{children:[(0,x.Y)(J.P.Arrow,{}),(0,x.Y)(u.T.Paragraph,{children:(0,x.Y)(X.A,{id:"2Ofya9",defaultMessage:"Search traces using a simplified version of the SQL {whereBold} clause.",values:{whereBold:(0,x.Y)("b",{children:"WHERE"})}})}),(0,x.Y)(X.A,{id:"U3btBc",defaultMessage:"Examples:"}),(0,x.Y)("ul",{children:(0,x.Y)("li",{children:(0,x.Y)("code",{children:'tags.some_tag = "abc"'})})})]})]})};var it={name:"1ykowef",styles:"margin-bottom:0"},ot={name:"ikeoj9",styles:"width:430px"},lt={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"},dt={name:"1wcfv52",styles:"margin-right:0"};const ct=e=>{let{filter:t,onChangeFilter:n,hiddenColumns:r=[],disabledColumns:s=[],toggleHiddenColumn:i}=e;const o=(0,Ie.A)(),[l,d]=(0,a.useState)(t||void 0),u=(0,a.useMemo)((()=>(0,V.entries)(we).map((e=>{let[t,n]=e;return{key:t,label:o.formatMessage(n)}})).filter((e=>{let{key:t}=e;return!s.includes(t)}))),[o,s]),p=(0,a.useMemo)((()=>r.filter((e=>!s.includes(e)))),[s,r]),m=null!==l&&void 0!==l?l:t;return(0,x.FD)(c.R9P,{css:it,children:[(0,x.Y)(c.pde,{placeholder:o.formatMessage({id:"FPMrvd",defaultMessage:"Search traces"}),value:m,css:ot,onChange:e=>d(e.target.value),prefix:(0,x.Y)(c.WIv,{}),suffix:(0,x.Y)(st,{}),allowClear:!0,onClear:()=>{n(""),d(void 0)},onKeyDown:e=>{"Enter"===e.key&&(n(m),d(void 0))}}),(0,x.FD)(c.AYc,{label:(0,x.FD)("div",{css:lt,children:[(0,x.Y)(c.jng,{}),(0,x.Y)(X.A,{id:"5TRN+F",defaultMessage:"Columns"}),p.length>0&&(0,x.Y)(c.vwO,{css:dt,children:(0,x.Y)(X.A,{id:"PHfEFY",defaultMessage:"{hiddenColumns} hidden",values:{hiddenColumns:p.length}})})]}),children:[(0,x.Y)(c.gGe,{"aria-label":o.formatMessage({id:"5TRN+F",defaultMessage:"Columns"})}),(0,x.Y)(c.dn6,{children:(0,x.Y)(c.HI_,{children:(0,x.Y)(c.dhl,{children:u.map((e=>{let{key:t,label:n}=e;return(0,x.Y)(c.jTC,{value:t,checked:!r.includes(t),onChange:()=>i(t),children:n},t)}))})})})]})]})},ut={hiddenColumns:[be.traceName,be.source]},pt=e=>{const t=(0,a.useMemo)((()=>{const t=JSON.stringify(e.slice().sort());return Z.A.getStoreForComponent("ExperimentViewTraces",t)}),[e]),[n,r]=(0,a.useState)((()=>(e=>{try{const t=e.getItem("uiState"),n=JSON.parse(t);return(0,V.isObject)(n)?n:ut}catch(t){return ut}})(t))),s=(0,a.useCallback)((e=>{r((t=>{const n=t.hiddenColumns||[];return{hiddenColumns:n.includes(e)?n.filter((t=>t!==e)):[...n,e]}}))}),[]);return(0,a.useEffect)((()=>{t.setItem("uiState",JSON.stringify(n))}),[t,n]),{uiState:n,toggleHiddenColumn:s}},mt="selectedTraceId",gt=[{id:be.timestampMs,desc:!0}],ht=e=>{let{experimentIds:t}=e;const[n,s]=(0,a.useState)(""),[i,l]=(0,a.useState)(gt),[d,c]=(()=>{var e;const[t,n]=(0,o.ok)();return[null!==(e=t.get(mt))&&void 0!==e?e:void 0,e=>{n((t=>void 0===e?(t.delete(mt),t):(t.set(mt,e),t)))}]})(),{traces:p,loading:m,error:g,hasNextPage:h,hasPreviousPage:f,fetchNextPage:v,fetchPrevPage:y,refreshCurrentPage:b}=Ae(t,i,n),{theme:w}=(0,u.u)(),C=(0,a.useMemo)((()=>{if(d)return p.find((e=>e.request_id===d))}),[d,p]),{uiState:{hiddenColumns:Y},toggleHiddenColumn:S}=pt(t),A=(0,a.useMemo)((()=>(0,V.uniq)((0,V.compact)(p.flatMap((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.map((e=>e.key))}))))),[p]),{showEditTagsModalForTrace:R,EditTagsModal:_}=(e=>{let{onSuccess:t,existingTagKeys:n=[]}=e;const{showEditTagsModal:r,EditTagsModal:s}=(0,at.Q)({saveTagsHandler:async(e,t,n)=>{if(!e.traceRequestId)return;const r=e.traceRequestId,a=n.filter((e=>{let{key:n,value:r}=e;return!t.some((e=>{let{key:t,value:a}=e;return t===n&&r===a}))})),s=t.filter((e=>{let{key:t}=e;return!n.some((e=>{let{key:n}=e;return t===n}))})),i=Promise.all([...a.map((e=>{let{key:t,value:n}=e;return pe.x.setExperimentTraceTag(r,t,n)})),...s.map((e=>{let{key:t}=e;return pe.x.deleteExperimentTraceTag(r,t)}))]);return i},valueRequired:!0,allAvailableTags:n.filter((e=>e&&!e.startsWith(Me.nt))),onSuccess:t}),i=(0,a.useCallback)((e=>{var t;if(!e.request_id)return;const n=(null===(t=e.tags)||void 0===t?void 0:t.filter((e=>{let{key:t}=e;return t&&!t.startsWith(Me.nt)})))||[];r({traceRequestId:e.request_id,tags:n||[]})}),[r]);return{showEditTagsModalForTrace:i,EditTagsModal:s}})({onSuccess:()=>b(!0),existingTagKeys:A}),I=""!==n,M=p.some((e=>!(0,V.isNil)(ve(e)))),k=(0,a.useMemo)((()=>M?[]:[be.totalTokens]),[M]);return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:w.spacing.sm,marginTop:w.spacing.md,height:"100%",overflow:"hidden"},""),children:[(0,x.Y)(ct,{filter:n,onChangeFilter:s,hiddenColumns:Y,disabledColumns:k,toggleHiddenColumn:S}),(0,x.Y)(ue,{hideBorder:!1}),(0,x.Y)(Ze,{traces:p,loading:m,error:g,onTraceClicked:e=>{let{request_id:t}=e;return c(t)},onTraceTagsEdit:R,hasNextPage:h,hasPreviousPage:f,onPreviousPage:y,onNextPage:v,onTagsUpdated:b,usingFilters:I,onResetFilters:()=>s(""),hiddenColumns:Y,disableTokenColumn:!M,setSorting:e=>{if((0,V.isFunction)(e))return l((t=>{const n=e(t),r=t[0];return n&&0!==n.length||!r?n:[{id:r.id,desc:!r.desc}]}))},sorting:i}),d&&(0,x.Y)(rt,{traceInfo:C,loadingTraceInfo:m,requestId:d,onClose:()=>c(void 0)}),_]})};var ft=n(79085),vt=n(56412);var yt={name:"490tlg",styles:"display:flex;gap:4px"};const xt=e=>{let{copyText:t}=e;return(0,x.FD)("div",{css:yt,children:[(0,x.Y)(c.pde,{readOnly:!0,value:t,"data-test-id":"copy-box"}),(0,x.Y)(vt.i,{copyText:t})]})},bt=e=>{let{visible:t,onCancel:n,link:r}=e;return(0,x.Y)(J.M,{title:(0,x.Y)(X.A,{id:"ktiuki",defaultMessage:"Get Link"}),visible:t,onCancel:n,children:(0,x.Y)(xt,{copyText:r})})};var wt=n(45653),Ct=n(25866);var Yt={name:"11jf4ye",styles:"display:flex;gap:8px"},St={name:"82a6rk",styles:"flex:1"};const At=e=>{let{onCancel:t,visible:n,experimentIds:r,searchFacetsState:o,uiState:l}=e;const[d,u]=(0,a.useState)(""),[p,m]=(0,a.useState)(!0),[h,f]=(0,a.useState)(null),v=(0,s.wA)(),y=(0,a.useMemo)((()=>({...o,...l})),[o,l]),b=(0,a.useCallback)((async e=>{if(r.length>1)return m(!1),f(e),void u(window.location.href);m(!0);const[t]=r,n=JSON.stringify(e),a=await(0,wt.Xb)(n),s=`${Ct.o6}${a}`;v((0,i.EJ)(t,s,n)).then((()=>{m(!1),f(e);const n=g.h.getExperimentPageRoute(t,!1,a),r=`${window.location.origin}${window.location.pathname}#${n}`;u(r)})).catch((e=>{throw E.A.logErrorAndNotifyUser("Failed to create shareable link for experiment"),e}))}),[v,r]);return(0,a.useEffect)((()=>{n&&h!==y&&b(y)}),[n,b,h,y]),(0,x.Y)(J.M,{title:(0,x.Y)(X.A,{id:"6KFQMl",defaultMessage:"Get shareable link"}),visible:n,onCancel:t,children:(0,x.FD)("div",{css:Yt,children:[p?(0,x.Y)(c.xUE,{css:St}):(0,x.Y)(c.pde,{placeholder:"Click button on the right to create shareable state",value:d,readOnly:!0}),(0,x.Y)(vt.i,{loading:p,copyText:d})]})})},Rt=e=>{let{searchFacetsState:t,uiState:n,experimentIds:r}=e;const[s,i]=(0,a.useState)(!1);return(0,x.FD)(x.FK,{children:[t&&n&&r?(0,x.Y)(At,{searchFacetsState:t,uiState:n,visible:s,onCancel:()=>i(!1),experimentIds:r}):(0,x.Y)(bt,{link:window.location.href,visible:s,onCancel:()=>i(!1)}),(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_header_experimentviewheadersharebutton.tsx_44",type:"primary",onClick:()=>i(!0),"data-test-id":"share-button",children:(0,x.Y)(X.A,{id:"2oFAO4",defaultMessage:"Share"})})]})},_t=a.memo((e=>{let{experiments:t}=e;const n=(0,a.useMemo)((()=>(0,x.Y)(X.A,{id:"Dhn7Mb",defaultMessage:"Displaying Runs from {numExperiments} Experiments",values:{numExperiments:t.length}})),[t.length]);return(0,x.Y)(ft.z,{title:n,breadcrumbs:[],children:(0,x.Y)(Rt,{})})}));var It=n(21616);var Mt=n(33946),kt=n(53677);class Et extends a.Component{constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this)}handleSubmit(){const e=[];return this.props.selectedRunIds.forEach((t=>{e.push(this.props.restoreRunApi(t))})),Promise.all(e).catch((e=>{let t="While restoring an experiment run, an error occurred.";e.textJson&&"RESOURCE_LIMIT_EXCEEDED"===e.textJson.error_code&&(t=t+" "+e.textJson.message),this.props.openErrorModal(t)})).then((()=>{var e,t;null===(e=(t=this.props).onSuccess)||void 0===e||e.call(t)}))}render(){const e=this.props.selectedRunIds.length;return(0,x.Y)(k.u,{isOpen:this.props.isOpen,onClose:this.props.onClose,handleSubmit:this.handleSubmit,title:`Restore Experiment ${E.A.pluralize("Run",e)}`,helpText:`${e} experiment ${E.A.pluralize("run",e)} will be restored.`,confirmButtonText:"Restore"})}}const Tt={restoreRunApi:i.iz,openErrorModal:i.Yi};var Dt=(0,s.Ng)(null,Tt)(Et);const Ft=e=>{let{showDeleteRunModal:t,showRestoreRunModal:n,showRenameRunModal:r,runsSelected:a,onCloseDeleteRunModal:s,onCloseRestoreRunModal:i,onCloseRenameRunModal:o,renamedRunName:l,refreshRuns:d}=e;const c=Object.entries(a).filter((e=>{let[,t]=e;return t})).map((e=>{let[t]=e;return t}));return(0,x.FD)(x.FK,{children:[(0,x.Y)(Mt.A,{isOpen:t,onClose:s,selectedRunIds:c,onSuccess:()=>{d()}}),(0,x.Y)(Dt,{isOpen:n,onClose:i,selectedRunIds:c,onSuccess:()=>{d()}}),(0,x.Y)(kt.jP,{runUuid:c[0],onClose:o,runName:l,isOpen:r,onSuccess:()=>{d()}})]})},Lt=e=>{let{children:t}=e;return(0,x.Y)(x.FK,{children:t})},Pt=a.memo((e=>{let{viewState:t,runsData:n,searchFacetsState:r,refreshRuns:s}=e;const{runsSelected:i}=t,{runInfos:l}=n,{lifecycleFilter:d}=r,c=(0,o.Zp)(),[p,m]=(0,a.useState)(!1),[h,f]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!1),[b,w]=(0,a.useState)(""),C=(0,a.useCallback)((()=>{const e=Object.keys(i),t=l.find((t=>t.runUuid===e[0]));t&&(w(t.runName),y(!0))}),[l,i]),Y=(0,a.useCallback)((()=>{const e=Object.keys(i),t=l.filter((t=>{let{runUuid:n}=t;return e.includes(n)})).map((e=>{let{experimentId:t}=e;return t}));c(g.h.getCompareRunPageRoute(e,[...new Set(t)].sort()))}),[c,l,i]),S=(0,a.useCallback)((()=>m(!0)),[]),A=(0,a.useCallback)((()=>f(!0)),[]),R=(0,a.useCallback)((()=>m(!1)),[]),_=(0,a.useCallback)((()=>f(!1)),[]),I=(0,a.useCallback)((()=>y(!1)),[]),M=Object.values(t.runsSelected).filter(Boolean).length,k=M>0,E=1===M,T=M>1;return(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:Bt.controlBar,children:[(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactions.tsx_110","data-testid":"run-rename-button",onClick:C,disabled:!E,children:(0,x.Y)(X.A,{id:"oWPgX7",defaultMessage:"Rename"})}),d===Ct.gy.ACTIVE?(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactions.tsx_117","data-testid":"runs-delete-button",disabled:!k,onClick:S,danger:!0,children:(0,x.Y)(X.A,{id:"3Rb4sG",defaultMessage:"Delete"})}):null,d===Ct.gy.DELETED?(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactions.tsx_126","data-testid":"runs-restore-button",disabled:!k,onClick:A,children:(0,x.Y)(X.A,{id:"Potju2",defaultMessage:"Restore"})}):null,(0,x.Y)("div",{css:Bt.buttonSeparator}),(0,x.Y)(Lt,{children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactions.tsx_136","data-testid":"runs-compare-button",disabled:!T,onClick:Y,children:(0,x.Y)(X.A,{id:"RaGnOQ",defaultMessage:"Compare"})})})]}),(0,x.Y)(Ft,{runsSelected:i,onCloseRenameRunModal:I,onCloseDeleteRunModal:R,onCloseRestoreRunModal:_,showDeleteRunModal:p,showRestoreRunModal:h,showRenameRunModal:v,renamedRunName:b,refreshRuns:s})]})})),Bt={buttonSeparator:e=>({borderLeft:`1px solid ${e.colors.border}`,marginLeft:e.spacing.xs,marginRight:e.spacing.xs,height:"100%"}),controlBar:e=>({display:"flex",gap:e.spacing.sm,alignItems:"center"})};var Nt=n(59525),Ht=n(14343);var Ot={name:"bjn8wh",styles:"position:relative"};const Ut=a.memo((e=>{const{runInfos:t}=e,{theme:n}=(0,u.u)(),{refreshRuns:s}=e,o=(0,z.z)(),[l,d]=(0,a.useState)(0),[p,m]=(0,a.useState)(0);return(0,a.useEffect)((()=>{m(0),d((()=>Date.now()))}),[t]),(0,a.useEffect)((()=>{if(!l)return;const e=setInterval((()=>{const e={experimentIds:o,filter:`attributes.start_time > ${l}`,maxResults:Ct.ks};(0,i.bc)(e).then((e=>{var t;const n=(null===(t=e.runs)||void 0===t?void 0:t.length)||0;m(n)}))}),Ct.a0);return()=>clearInterval(e)}),[l,o]),(0,x.FD)("div",{css:Ot,children:[p>0&&(0,x.Y)("div",{title:Ct.ks>p?`${p}`:Ct.ks-1+"+",css:(0,r.AH)({position:"absolute",top:0,right:0,transform:"translate(50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",width:p>9?28:20,height:20,borderRadius:10,border:`1px solid ${n.colors.white}`,backgroundColor:n.colors.lime,color:n.colors.white,fontSize:10,fontWeight:"bold",userSelect:"none",zIndex:1},""),children:Ct.ks>p?p:Ct.ks-1+"+"}),(0,x.Y)(c.m_M,{title:(0,x.Y)(X.A,{id:"ag05Pe",defaultMessage:"Refresh"}),useAsLabel:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrefreshbutton.tsx_123",onClick:s,"data-testid":"runs-refresh-button",icon:(0,x.Y)(c.Fjq,{})})})]})})),Kt=(0,s.Ng)((e=>({runInfos:e.entities.runInfosByUuid})),void 0,void 0,{areStatesEqual:(e,t)=>e.entities.runInfosByUuid===t.entities.runInfosByUuid})(Ut),zt=()=>(0,x.FD)("div",{className:"search-input-tooltip-content",children:[(0,x.Y)(X.A,{id:"kIlkgf",defaultMessage:"Search runs using a simplified version of the SQL {whereBold} clause.",values:{whereBold:(0,x.Y)("b",{children:"WHERE"})}})," ",(0,x.Y)(X.A,{id:"nYKZy4",defaultMessage:"<link>Learn more</link>",values:{link:e=>(0,x.Y)("a",{href:$.g2,target:"_blank",rel:"noopener noreferrer",children:e})}}),(0,x.Y)("br",{}),(0,x.Y)(X.A,{id:"U3btBc",defaultMessage:"Examples:"}),(0,x.Y)("br",{}),"\u2022 metrics.rmse >= 0.8",(0,x.Y)("br",{}),"\u2022 metrics.`f1 score` < 1",(0,x.Y)("br",{}),"\u2022 params.model = 'tree'",(0,x.Y)("br",{}),"\u2022 attributes.run_name = 'my run'",(0,x.Y)("br",{}),"\u2022 tags.`mlflow.user` = 'myUser'",(0,x.Y)("br",{}),"\u2022 metric.f1_score > 0.9 AND params.model = 'tree'",(0,x.Y)("br",{}),"\u2022 dataset.name IN ('dataset1', 'dataset2')",(0,x.Y)("br",{}),"\u2022 attributes.run_id IN ('a1b2c3d4', 'e5f6g7h8')",(0,x.Y)("br",{}),"\u2022 tags.model_class LIKE 'sklearn.linear_model%'"]});const Vt=["run_id","run_name","status","artifact_uri","user_id","start_time","end_time","created"].map((e=>({value:`attributes.${e}`})));var Gt={name:"lugakg",styles:"font-weight:normal"};const qt=(e,t)=>{const n=e.split(RegExp(t.replace(".","\\."),"ig")),r=e.match(RegExp(t.replace(".","\\."),"ig"));return(0,x.Y)("span",{css:Gt,"data-test-id":e,children:n.map(((e,t)=>(0,x.FD)(a.Fragment,{children:[e,t!==n.length-1&&r&&(0,x.Y)("b",{children:r[t]})]},t)))})};const $t="tooltipLastPopup";var Wt={name:"c61v0h",styles:".du-bois-light-select-item-option-active:not(.du-bois-light-select-item-option-disabled){background-color:#e6f1f5;}"},jt={name:"9gxvqt",styles:"display:flex;gap:4px;align-items:center"};const Qt=e=>{const{runsData:t,searchFilter:n,requestError:s,onSearchFilterChange:i,onClear:o}=e,{theme:l}=(0,u.u)(),[d,p]=(0,a.useState)(""),[m,g]=(0,a.useState)(void 0),[h,f]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!1),b=(0,a.useRef)({metricNames:[],paramNames:[],tagNames:[]}),[w,C]=(0,a.useState)({Metrics:10,Parameters:10,Tags:10}),Y=(0,a.useRef)([]),[S,A]=(0,a.useState)(void 0);(0,a.useEffect)((()=>{p(n)}),[n]);const R=(0,a.useMemo)((()=>{const e=b.current,n=((e,t)=>{const n=(e,t)=>[...new Set([...e,...t])],r=e=>e.flatMap((e=>Object.keys(e)));return{metricNames:n(t.metricNames,e.metricKeyList),paramNames:n(t.paramNames,e.paramKeyList),tagNames:n(r(t.tagNames),r(e.tagsList)).filter((e=>!e.startsWith("mlflow."))).map((e=>e.includes('"')||e.includes(" ")||e.includes(".")?`\`${e}\``:e.includes("`")?`"${e}"`:e))}})(t,e);return b.current=n,[{label:"Metrics",options:(r=n).metricNames.map((e=>({value:`metrics.${e}`})))},{label:"Parameters",options:r.paramNames.map((e=>({value:`params.${e}`})))},{label:"Tags",options:r.tagNames.map((e=>({value:`tags.${e}`})))},{label:"Attributes",options:Vt}];var r}),[t]);(0,a.useEffect)((()=>{const e=Y.current,t=(e=>{const t=/>|<|>=|<=|=|!=|like|ilike/gi,n=(e=>{const t=/and[\s]+/gi,n=[];let r,a;for(;a=t.lastIndex,r=t.exec(e);)n.push({clause:e.substring(a,r.index),startIndex:a});return n.push({clause:e.substring(a),startIndex:a}),n})(e),r=[];return n.forEach((e=>{const n=e.clause.split(t)[0],{startIndex:a}=e;r.push({name:n,startIndex:0+a,endIndex:n.length+a})})),r})(d);if(Y.current=t,v)return void y(!1);const n=t.map((e=>e.name)),r=e.map((e=>e.name));if(!(0,V.isEqual)(n,r)&&t.length>=e.length){let n=0;for(;n<t.length;){if(n>=e.length||t[n].name.trim()!==e[n].name.trim())return g(!0),void A(t[n]);n++}}g(!1)}),[d]);const _=(0,a.useMemo)((()=>S?((e,t,n)=>e.map((e=>{const r=e.options.filter((e=>e.value.toLowerCase().includes(t.name.toLowerCase().trim()))).map((e=>({value:e.value,label:qt(e.value,t.name.trim())}))),a=n[e.label],s=[...r.slice(0,a),...r.length>a?[{label:"...",value:`..._${e.label}`}]:[]];return{label:e.label,options:s}})).filter((e=>e.options.length>0)))(R,S,w):[]),[R,S,w]),I=(0,a.useCallback)(((e,t)=>{if(S)if(e.startsWith("...")){g(!0);const e=t.value.split("_")[1];C((t=>({...t,[e]:t[e]+10})))}else{const t=d.substring(0,S.startIndex),n=d.substring(S.endIndex);p(t+e+" "+n),y(!0),g(!1)}}),[d,p,S,g]),M=ee($t),[k,E]=(0,a.useState)((()=>{const e=Math.floor(Date.now()/1e3),t=M.getItem($t);return!t||parseInt(t,10)<e-604800})),T=a.useRef(null);(0,a.useEffect)((()=>{if(s&&k){var e;const t=Math.floor(Date.now()/1e3);M.setItem($t,t),E(!1),null===(e=T.current)||void 0===e||e.click()}}),[s]);const D=0===_.flatMap((e=>e.options)).length,F=m&&h&&!D,L=(0,a.useCallback)((e=>{"Enter"===e.key&&(F?g(!1):i(d)),"Escape"===e.key&&(e.preventDefault(),F&&g(!1))}),[F,d,i]);return(0,x.Y)("div",{css:(0,r.AH)({display:"flex",gap:l.spacing.sm,width:430,[l.responsive.mediaQueries.xs]:{width:"auto"}},""),children:(0,x.Y)(c.j9R,{dropdownMatchSelectWidth:560,css:(0,r.AH)({width:560,[l.responsive.mediaQueries.xs]:{width:"auto"}},""),defaultOpen:!1,defaultActiveFirstOption:!0,open:F,options:_,onSelect:I,value:d,"data-test-id":"runs-search-autocomplete",dropdownRender:e=>(0,x.Y)("div",{css:Wt,children:e}),children:(0,x.Y)(c.pde,{value:d,prefix:(0,x.Y)(c.WIv,{css:(0,r.AH)({svg:{width:16,height:16,color:l.colors.textSecondary}},"")}),onKeyDown:L,onClick:()=>f(!0),onBlur:()=>f(!1),onChange:e=>p(e.target.value),placeholder:'metrics.rmse < 1 and params.model = "tree"',"data-test-id":"search-box",suffix:(0,x.FD)("div",{css:jt,children:[d&&(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_runssearchautocomplete.tsx_212",onClick:o,type:"link","data-test-id":"clear-button",children:(0,x.Y)(u.C,{})}),(0,x.Y)(c.m_M,{title:(0,x.Y)(zt,{}),placement:"right",dangerouslySetAntdProps:{overlayInnerStyle:{width:"150%"},trigger:["focus","click"]},children:(0,x.Y)(u.B,{size:"small",ref:T,componentId:"mlflow.experiment_page.search_filter.tooltip",type:"link",icon:(0,x.Y)(c.mo0,{css:(0,r.AH)({svg:{width:16,height:16,color:l.colors.textSecondary}},"")})})})]})})})})};var Jt=n(18476),Xt=n(37616);var Zt={name:"1voqbl3",styles:"margin-top:0;font-weight:normal"};const en=e=>{let{isOpen:t,closeModal:n,experimentId:a}=e;const{theme:s}=(0,u.u)(),i=`\nimport mlflow\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.datasets import load_diabetes\nfrom sklearn.ensemble import RandomForestRegressor\n\n# set the experiment id\nmlflow.set_experiment(experiment_id="${a}")\n\nmlflow.autolog()\ndb = load_diabetes()\n\nX_train, X_test, y_train, y_test = train_test_split(db.data, db.target)\n\n# Create and train models.\nrf = RandomForestRegressor(n_estimators=100, max_depth=6, max_features=3)\nrf.fit(X_train, y_train)\n\n# Use the model to make predictions on the test dataset.\npredictions = rf.predict(X_test)\n`.trimStart(),o=`\nimport mlflow\nimport openai\n\n# you must set the OPENAI_API_KEY environment variable\nassert (\n  "OPENAI_API_KEY" in os.environ\n), "Please set the OPENAI_API_KEY environment variable."\n\n# set the experiment id\nmlflow.set_experiment(experiment_id="${a}")\n\nsystem_prompt = (\n  "The following is a conversation with an AI assistant."\n  + "The assistant is helpful and very friendly."\n)\n\n# start a run\nmlflow.start_run()\nmlflow.log_param("system_prompt", system_prompt)\n\n# Create a question answering model using prompt engineering\n# with OpenAI. Log the model to MLflow Tracking\nlogged_model = mlflow.openai.log_model(\n    model="gpt-3.5-turbo",\n    task=openai.ChatCompletion,\n    artifact_path="model",\n    messages=[\n        {"role": "system", "content": system_prompt},\n        {"role": "user", "content": "{question}"},\n    ],\n)\n\n# Evaluate the model on some example questions\nquestions = pd.DataFrame(\n    {\n        "question": [\n            "How do you create a run with MLflow?",\n            "How do you log a model with MLflow?",\n            "What is the capital of France?",\n        ]\n    }\n)\nmlflow.evaluate(\n    model=logged_model.model_uri,\n    model_type="question-answering",\n    data=questions,\n)\nmlflow.end_run()\n`.trimStart(),l=18*(Math.min(...[i,o].map((e=>e.split("\n").length)))+1);return(0,x.Y)(J.M,{visible:t,onCancel:n,onOk:n,footer:(0,x.Y)("div",{css:(0,r.AH)({display:"flex",gap:s.spacing.sm,justifyContent:"flex-end"},""),children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_createnotebookrunmodal.tsx_117",onClick:n,type:"primary",children:(0,x.Y)(X.A,{id:"ttyLD4",defaultMessage:"Okay"})})}),title:(0,x.FD)("div",{children:[(0,x.Y)(u.T.Title,{level:2,css:(0,r.AH)({marginTop:s.spacing.sm,marginBottom:s.spacing.xs},""),children:(0,x.Y)(X.A,{id:"iF1UfU",defaultMessage:"New run using notebook"})}),(0,x.Y)(u.T.Hint,{css:Zt,children:"Run this code snippet in a notebook or locally, to create an experiment run"})]}),children:(0,x.FD)(c.tUM,{children:[(0,x.Y)(c.mFh,{tab:(0,x.Y)(X.A,{id:"71dHIO",defaultMessage:"Classical ML"}),children:(0,x.Y)(Xt.z7,{style:{padding:"5px",height:l},language:"python",actions:(0,x.Y)("div",{style:{marginTop:s.spacing.sm,marginRight:s.spacing.md},children:(0,x.Y)(vt.i,{copyText:i,showLabel:!1,icon:(0,x.Y)(c.TdU,{})})}),children:i})},"classical-ml"),(0,x.Y)(c.mFh,{tab:(0,x.Y)(X.A,{id:"xBVMQz",defaultMessage:"LLM"}),children:(0,x.Y)(Xt.z7,{style:{padding:"5px",height:l},language:"python",actions:(0,x.Y)("div",{style:{marginTop:s.spacing.sm,marginRight:s.spacing.md},children:(0,x.Y)(vt.i,{copyText:o,showLabel:!1,icon:(0,x.Y)(c.TdU,{})})}),children:o})},"llm")]})})};var tn=n(4877),nn=n.n(tn);class rn extends De.s{getGatewayErrorMessage(){var e,t,n,r;return(null===(e=this.textJson)||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message)||(null===(n=this.textJson)||void 0===n?void 0:n.message)||(null===(r=this.textJson)||void 0===r?void 0:r.toString())||this.text}}const an=(e,t)=>{if(t===Ye.W8.LLM_V1_COMPLETIONS){var n,r;const t=e,a=null===(n=t.choices)||void 0===n||null===(r=n[0])||void 0===r?void 0:r.text,{usage:s}=t;if(a&&s)return{text:a,metadata:{total_tokens:s.total_tokens,output_tokens:s.completion_tokens,input_tokens:s.prompt_tokens}}}if(t===Ye.W8.LLM_V1_CHAT){var a,s,i;const t=e,n=null===(a=t.choices)||void 0===a||null===(s=a[0])||void 0===s||null===(i=s.message)||void 0===i?void 0:i.content,{usage:r}=t;if(n&&r)return{text:n,metadata:{total_tokens:r.total_tokens,output_tokens:r.completion_tokens,input_tokens:r.prompt_tokens}}}throw new Error(`Unrecognizable AI gateway response metadata "${e.usage}"!`)};var sn;class on{static createEvaluationTextPayload(e,t){switch(t){case Ye.W8.LLM_V1_COMPLETIONS:return{prompt:e};case Ye.W8.LLM_V1_CHAT:return{messages:[{content:e,role:"user"}]};case Ye.W8.LLM_V1_EMBEDDINGS:throw new Error(`Unsupported served LLM model task "${t}"!`);default:throw new Error(`Unknown served LLM model task "${t}"!`)}}}sn=on,on.queryMLflowDeploymentEndpointRoute=async(e,t)=>{nn()(e.mlflowDeployment,"Trying to call a MLflow deployment route without a deployment_url");const{inputText:n}=t,r={...sn.createEvaluationTextPayload(n,e.task),...t.parameters};return pe.x.gatewayProxyPost({gateway_path:e.mlflowDeployment.endpoint_url.substring(1),json_data:r})},on.queryModelGatewayRoute=async(e,t)=>{if("mlflow_deployment_endpoint"===e.type){nn()(e.mlflowDeployment,"Trying to call a serving endpoint route without an endpoint");const n=await sn.queryMLflowDeploymentEndpointRoute(e,t);return an(n,e.task)}throw new Error("Unknown route type")};var ln=n(54346),dn=n(65795);const cn=[{type:"slider",name:"temperature",string:(0,me.zR)({id:"Jrri/Y",defaultMessage:"Temperature"}),helpString:(0,me.zR)({id:"5yWkFd",defaultMessage:"Increase or decrease the confidence level of the language model."}),max:1,min:0,step:.01},{type:"input",name:"max_tokens",string:(0,me.zR)({id:"qR3llD",defaultMessage:"Max tokens"}),helpString:(0,me.zR)({id:"cEwSR8",defaultMessage:"Maximum number of language tokens returned from evaluation."}),max:65536,min:1,step:1},{type:"list",name:"stop",string:(0,me.zR)({id:"FAfPOl",defaultMessage:"Stop Sequences"}),helpString:(0,me.zR)({id:"J2XCE/",defaultMessage:"Specify sequences that signal the model to stop generating text."})}],un={temperature:.01,max_tokens:100},pn=()=>{const[e,t]=(0,a.useState)(un),n=(0,a.useCallback)(((e,n)=>{t((t=>({...t,[e]:n})))}),[]);return{parameterDefinitions:cn,parameters:e,updateParameter:n}};var mn=n(20193);var gn={name:"151f7v8",styles:"span{font-weight:normal;}"};const hn=e=>{let{disabled:t=!1,parameters:n,updateParameter:a}=e;const{parameterDefinitions:s}=pn(),{theme:i}=(0,u.u)();return(0,x.FD)("div",{css:(0,r.AH)({marginBottom:i.spacing.lg},""),children:[(0,x.Y)(c.D$Q.Label,{css:(0,r.AH)({marginBottom:i.spacing.md},""),children:(0,x.Y)(X.A,{id:"KADUUT",defaultMessage:"Model parameters"})}),s.map((e=>(0,x.Y)("div",{css:(0,r.AH)({marginBottom:i.spacing.md},""),children:(0,x.FD)(x.FK,{children:[(0,x.FD)(c.D$Q.Label,{htmlFor:e.name,css:gn,children:[(0,x.Y)(X.A,{...e.string}),(0,x.Y)(c.m_M,{title:(0,x.Y)(X.A,{...e.helpString}),placement:"right",children:(0,x.Y)(c.mo0,{css:(0,r.AH)({marginLeft:i.spacing.sm,verticalAlign:"text-top",color:i.colors.textSecondary},"")})})]}),(0,x.Y)(c.D$Q.Hint,{}),"temperature"===e.name&&(0,x.Y)(mn.o,{"data-testid":e.name,disabled:t,max:e.max,min:e.min,step:e.step,defaultValue:n[e.name]||0,onChange:t=>a(e.name,t)}),"input"===e.type&&(0,x.Y)(c.pde,{"data-testid":e.name,type:"number",disabled:t,max:e.max,min:e.min,step:e.step,value:n[e.name]||0,onChange:t=>a(e.name,parseInt(t.target.value,10))}),"list"===e.type&&(0,x.Y)(c._vn,{allowClear:!0,mode:"tags",style:{width:"100%"},open:!1,disabled:t,onChange:t=>a(e.name,t),value:n[e.name]||[],dangerouslySetAntdProps:{suffixIcon:null}})]})},e.name)))]})},fn=" }}",vn="new_variable",yn=()=>{const[e,t]=(0,a.useState)(dn.KH),n=(0,a.useRef)(),r=(0,a.useCallback)((()=>{t((e=>{const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.includes(vn))return vn;const t=(0,V.max)(e.map((e=>{var t;return parseInt((null===(t=e.match(/new_variable_(\d+)/))||void 0===t?void 0:t[1])||"1",10)})))||1;return`${vn}_${t+1}`}((0,dn.rl)(e)),r=`${e} {{ ${t}${fn}`;return requestAnimationFrame((()=>{const e=n.current;e&&(e.focus(),e.setSelectionRange(r.length-t.length-3,r.length-3))})),r}))}),[t]);return{savePromptTemplateInputRef:(0,a.useCallback)((e=>{var t;n.current=null===e||void 0===e||null===(t=e.resizableTextArea)||void 0===t?void 0:t.textArea}),[]),handleAddVariableToTemplate:r,promptTemplate:e,updatePromptTemplate:t}},xn=(0,me.zR)({id:"lM0z8k",defaultMessage:"The following variable names contain spaces which is disallowed: {invalidNames}"}),bn=e=>{let{violations:t}=e;const{namesWithSpaces:n}=t,{formatMessage:r}=(0,Ie.A)();return(0,x.Y)(x.FK,{children:n.length>0&&(0,x.Y)(u.T.Text,{color:"warning",size:"sm","aria-label":r(xn,{invalidNames:n.join(", ")}),children:(0,x.Y)(X.A,{...xn,values:{invalidNames:(0,x.Y)(x.FK,{children:n.map((e=>(0,x.Y)("code",{children:e},e)))})}})})})};var wn=n(57207);const Cn=[{prompt:["You are a marketing consultant for a technology company. Develop a marketing strategy report for {{ company_name }} aiming to {{ company_goal }}"],variables:[{name:"company_name",value:"XYZ Company"},{name:"company_goal",value:"Increase top-line revenue"}]},{prompt:['You are a helpful and friendly customer support chatbot. Answer the users question "{{ user_question }}" clearly, based on the following documentation: {{ documentation }}'],variables:[{name:"user_question",value:"Is MLflow open source?"},{name:"documentation",value:"MLflow is an open source platform for managing the end-to-end machine learning lifecycle."}]},{prompt:['Summarize the given text "{{ text }}" into a concise and coherent summary, capturing the main ideas and key points. Make sure that the summary does not exceed {{ word_count }} words.'],variables:[{name:"text",value:"Although C. septempunctata larvae and adults mainly eat aphids, they also feed on Thysanoptera, Aleyrodidae, on the larvae of Psyllidae and Cicadellidae, and on eggs and larvae of some beetles and butterflies. There are one or two generations per year. Adults overwinter in ground litter in parks, gardens and forest edges and under tree bark and rocks. C. septempunctata has a broad ecological range, generally living wherever there are aphids for it to eat. This includes, amongst other biotopes, meadows, fields, Pontic\u2013Caspian steppe, parkland, gardens, Western European broadleaf forests and mixed forests. In the United Kingdom, there are fears that the seven-spot ladybird is being outcompeted for food by the harlequin ladybird. An adult seven-spot ladybird may reach a body length of 7.6\u201312.7 mm (0.3\u20130.5 in). Their distinctive spots and conspicuous colours warn of their toxicity, making them unappealing to predators. The species can secrete a fluid from joints in their legs which gives them a foul taste. A threatened ladybird may both play dead and secrete the unappetising substance to protect itself. The seven-spot ladybird synthesizes the toxic alkaloids, N-oxide coccinelline and its free base precoccinelline; depending on sex and diet, the spot size and coloration can provide some indication of how toxic the individual insect is to potential predators."},{name:"word_count",value:"75"}]},{prompt:["Generate a list of ten titles for my book. The book is about {{ topic }}. Each title should be between {{ word_range }} words long.","### Examples of great titles ###","{{ examples }}"],variables:[{name:"topic",value:"my journey as an adventurer who has lived an unconventional life, meeting many different personalities and finally finding peace in gardening."},{name:"word_range",value:"two to five"},{name:"examples",value:'"Long walk to freedom", "Wishful drinking", "I know why the caged bird sings"'}]},{prompt:["Generate a SQL query from a user\u2019s question, using the information from the table.","Question: {{ user_question }}","Table Information: {{ table_information }}"],variables:[{name:"user_question",value:"Which product generated the most sales this month?"},{name:"table_information",value:"CREATE TABLE Sales (SaleID INT PRIMARY KEY, ProductID INT, SaleDate DATE, CustomerID INT, QuantitySold INT, UnitPrice DECIMAL(10, 2));"}]}],{TextArea:Yn}=c.pde,Sn=e=>{let{isOpen:t,closeExamples:n,closeModal:a,updatePromptTemplate:s,updateInputVariableValue:i}=e;const{theme:o}=(0,u.u)();return(0,x.Y)(J.M,{verticalSizing:"maxed_out",visible:t,onCancel:a,title:(0,x.Y)("div",{children:(0,x.FD)(u.T.Title,{level:2,css:(0,r.AH)({marginTop:o.spacing.sm,marginBottom:o.spacing.xs},""),children:[(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodalexamples.tsx_48",css:(0,r.AH)({marginRight:o.spacing.sm,marginBottom:o.spacing.sm},""),icon:(0,x.Y)(c.A60,{}),onClick:n}),(0,x.Y)(X.A,{id:"KzC+38",defaultMessage:"Prompt template examples"})]})}),dangerouslySetAntdProps:{width:1200},children:Cn.map((e=>(0,x.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:o.spacing.md},""),children:[(0,x.FD)("div",{css:(0,r.AH)({boxSizing:"border-box",border:`1px solid ${o.colors.actionDefaultBorderDefault}`,borderRadius:o.borders.borderRadiusMd,background:o.colors.backgroundPrimary,padding:o.spacing.md,margin:0,overflow:"hidden",display:"flex",flexDirection:"column",gap:`${o.spacing.xs}px`},""),children:[(0,x.FD)(u.T.Title,{level:4,children:[(0,x.Y)(X.A,{id:"GDzD7I",defaultMessage:"Prompt Template"}),(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodalexamples.tsx_90",type:"tertiary",size:"small",style:{float:"right"},onClick:()=>(e=>{s(e.prompt.join("\n")),e.variables.forEach((e=>{let{name:t,value:n}=e;i(t,n)})),n()})(e),children:(0,x.Y)(X.A,{id:"Np53PR",defaultMessage:"Try this template"})})]}),e.prompt.map((e=>(0,x.Y)(u.T.Paragraph,{children:e},e))),(0,x.Y)(wn.A,{css:(0,r.AH)({marginTop:o.spacing.xs,marginBottom:o.spacing.xs},"")}),e.variables.map((e=>{let{name:t,value:n}=e;return(0,x.FD)("div",{children:[(0,x.Y)(u.T.Title,{level:4,children:t}),(0,x.Y)(u.T.Paragraph,{children:n})]},t)}))]}),(0,x.Y)(J.S,{})]},e.prompt.join("\n"))))})};const{TextArea:An}=c.pde;var Rn={name:"1ll9bqd",styles:"cursor:default"};const _n=e=>{let{evaluationMetadata:t,isEvaluating:n,isOutputDirty:s,evaluationOutput:i,evaluationError:o,evaluateButtonTooltip:l,disabled:d,onEvaluateClick:p,onCancelClick:m}=e;const{theme:g}=(0,u.u)(),h=(0,a.useMemo)((()=>t?n?null:(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:g.spacing.xs,alignItems:"center"},""),children:[dn.Ef in t&&(0,x.FD)(u.T.Hint,{size:"sm",children:[Math.round(Number(t[dn.Ef]))," ms","MLFLOW_total_tokens"in t?",":""]}),dn.jC in t&&(0,x.Y)(u.T.Hint,{size:"sm",children:(0,x.Y)(X.A,{id:"/nPZbt",defaultMessage:"{totalTokens} total tokens",values:{totalTokens:t[dn.jC]}})})]}):null),[t,n,g]);return(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:(0,r.AH)({marginBottom:g.spacing.md},""),children:[(0,x.Y)(c.m_M,{title:l,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcreatepromptrunoutput.tsx_85","data-testid":"button-evaluate",icon:(0,x.Y)(c.udU,{}),onClick:p,disabled:d,loading:n,children:(0,x.Y)(X.A,{id:"72uGpl",defaultMessage:"Evaluate"})})}),n&&(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcreatepromptrunoutput.tsx_99","data-testid":"button-cancel",icon:(0,x.Y)(c.wFz,{}),onClick:m,css:(0,r.AH)({marginLeft:g.spacing.sm},""),children:(0,x.Y)(X.A,{id:"CTEh+b",defaultMessage:"Cancel"})})]}),(0,x.FD)(c.D$Q.Label,{children:[(0,x.Y)(X.A,{id:"ydoHrJ",defaultMessage:"Output"}),s&&(0,x.Y)(c.m_M,{title:(0,x.Y)(X.A,{id:"gc+GrI",defaultMessage:"Model, input data or prompt have changed since last evaluation of the output"}),children:(0,x.Y)(u.W,{css:(0,r.AH)({marginLeft:g.spacing.xs},"")})})]}),(0,x.Y)(c.D$Q.Hint,{children:(0,x.Y)(X.A,{id:"JtQQMn",defaultMessage:"This is the output generated by the LLM using the prompt template and input values defined above."})}),!o&&n&&(0,x.Y)("div",{css:(0,r.AH)({marginTop:g.spacing.sm},""),children:(0,x.Y)(c.QvX,{lines:5})}),!n&&(0,x.Y)(An,{rows:5,css:Rn,"data-testid":"prompt-output",value:i,readOnly:!0}),!n&&o&&(0,x.Y)(c.D$Q.Message,{message:o,type:"error"}),(0,x.Y)("div",{css:(0,r.AH)({marginTop:g.spacing.sm},""),children:h})]})};var In=n(17111);const Mn=e=>{let{routeName:t,routeType:n,compiledPrompt:r,inputValues:a,parameters:s,outputColumn:i,rowKey:o,run:l}=e;return(e=>{let{routeName:t,routeType:n,compiledPrompt:r,inputValues:a,parameters:s,outputColumn:i,rowKey:o,run:l}=e;return async(e,i)=>{const{modelGateway:d}=i();d.modelGatewayRoutesLoading.loading||0!==Object.keys(d.modelGatewayRoutes).length||await e(kn());const c=i().modelGateway.modelGatewayRoutes[`${n}:${t}`];if(!c){const e=`MLflow deployment endpoint ${t} does not exist anymore!`;throw E.A.logErrorAndNotifyUser(e),new Error(e)}const u={inputText:r,parameters:s};return e({type:"EVALUATE_PROMPT_TABLE_VALUE",payload:on.queryModelGatewayRoute(c,u),meta:{inputValues:a,run:l,compiledPrompt:r,rowKey:o,startTime:performance.now()}})}})({...{routeName:t,compiledPrompt:r,inputValues:a,parameters:s,outputColumn:i,rowKey:o,run:l},routeType:n})},kn=()=>async e=>e({type:"SEARCH_MLFLOW_DEPLOYMENTS_MODEL_ROUTES",payload:pe.x.gatewayProxyGet({gateway_path:"api/2.0/endpoints/"}),meta:{id:(0,l.yk)()}}),En=e=>e instanceof rn?e.getGatewayErrorMessage():e instanceof De.s?e.getMessageField():e.message;const{TextArea:Tn}=c.pde;var Dn={name:"1voqbl3",styles:"margin-top:0;font-weight:normal"},Fn={name:"t691yx",styles:"display:grid;grid-template-columns:300px 1fr;gap:48px"},Ln={name:"1d3w5wq",styles:"width:100%"},Pn={name:"1eoy87d",styles:"display:flex;justify-content:space-between"};const Bn=e=>{let{isOpen:t,closeModal:n,runBeingDuplicated:o,visibleRuns:l=[],refreshRuns:d}=e;const[p]=(0,z.z)(),{theme:m}=(0,u.u)(),{parameters:g,updateParameter:h}=pn(),[,f]=se(),[v,y]=(0,a.useState)(""),[b,w]=(0,a.useState)(""),[C,Y]=(0,a.useState)(!1),[S,A]=(0,a.useState)(!1),[R,_]=(0,a.useState)(null),[I,M]=(0,a.useState)(""),[k,T]=(0,a.useState)({}),[D,F]=(0,a.useState)(!1),[L,P]=(0,a.useState)(!1),B=(0,a.useRef)(null),N=(0,s.wA)();(0,a.useEffect)((()=>{N(kn()).catch((e=>{E.A.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e)}))}),[N]);const H=(0,Ie.A)(),{updateInputVariables:O,inputVariables:U,inputVariableValues:K,updateInputVariableValue:G,inputVariableNameViolations:q,clearInputVariableValues:$}=(()=>{const[e,t]=(0,a.useState)((0,dn.rl)("")),[n,r]=(0,a.useState)({namesWithSpaces:[]}),[s,i]=(0,a.useState)(dn.kU),o=(0,a.useCallback)((()=>i({})),[]),l=(0,a.useMemo)((()=>(0,V.debounce)((e=>{t((t=>{const n=(0,dn.rl)(e);return(0,V.isEqual)(n,t)?t:n})),r((0,dn.Eb)(e))}),250)),[]),d=(0,a.useCallback)(((e,t)=>{i((n=>({...n,[e]:t})))}),[]),c=(0,a.useMemo)((()=>(0,V.fromPairs)(Object.entries(s).filter((t=>{let[n]=t;return e.includes(n)})))),[s,e]);return{updateInputVariables:l,inputVariables:e,inputVariableValues:c,updateInputVariableValue:d,inputVariableNameViolations:n,clearInputVariableValues:o}})(),{handleAddVariableToTemplate:W,savePromptTemplateInputRef:j,promptTemplate:Q,updatePromptTemplate:Z}=yn();(0,a.useEffect)((()=>{t&&!o&&w((0,ln.Lr)())}),[t,o]),(0,a.useEffect)((()=>{O(Q)}),[Q,O]),(0,a.useEffect)((()=>{if(o){const{promptTemplate:e,routeName:t,parameters:n}=(0,dn.vC)(o);(0,dn.xP)(o),e&&Z(e),n.temperature&&h("temperature",n.temperature),n.max_tokens&&h("max_tokens",n.max_tokens),t&&y(t),M(""),F(!1);const r=(0,ln.gK)(o.runName,(0,V.compact)(l.map((e=>{let{runName:t}=e;return t}))));w(r),$()}}),[o,$,h,Z,l]);const ee=(0,s.d4)((e=>{let{modelGateway:t}=e;return t.modelGatewayRoutes})),te=(0,a.useMemo)((()=>(0,V.sortBy)(Object.values(ee),"name")),[ee]),ne=(0,s.d4)((e=>{let{modelGateway:t}=e;return t.modelGatewayRoutesLoading.loading}));(0,a.useEffect)((()=>{I&&F(!0)}),[K,Q,g,v]);const re=(0,a.useCallback)((()=>{const e=ee[v],t=Math.random().toString(36);if(B.current=t,!e)throw new Error("No model route found!");_(null),A(!0);const n=(0,dn.TG)(Q,K),r=performance.now();on.queryModelGatewayRoute(e,{inputText:n,parameters:g}).then((e=>{if(B.current===t){const{text:n,metadata:a}=e,s=performance.now()-r;M(n);const i={...a,latency:s},o=Object.entries(i).reduce(((e,t)=>{let[n,r]=t;return{...e,[`MLFLOW_${n}`]:r}}),{});T(o),F(!1),A(!1),B.current===t&&(B.current=null)}})).catch((e=>{const n=En(e),r=H.formatMessage({id:"nyHcAz",defaultMessage:'MLflow deployment returned the following error: "{errorMessage}"'},{errorMessage:n});E.A.logErrorAndNotifyUser(r),A(!1),_(r),B.current===t&&(B.current=null)}))}),[K,ee,g,Q,v,H]),ae=(0,a.useCallback)((()=>{B.current&&(A(!1),B.current=null)}),[A]),ie=H.formatMessage({id:"AyceYA",defaultMessage:"Served LLM model"}),oe=H.formatMessage({id:"pTDM+x",defaultMessage:"Select LLM model endpoint"}),le=Q.trim().length>0,de=(0,a.useMemo)((()=>U.every((e=>{var t;return null===(t=K[e])||void 0===t?void 0:t.trim()}))),[U,K]),ce=b.trim().length>0,ue=v&&le&&de,pe=Boolean(v&&le&&de&&I&&!D&&U.length>0&&ce&&!R),me=(0,a.useMemo)((()=>v?le?de?I?D?H.formatMessage({id:"/K6wBr",defaultMessage:"Input data or prompt template have changed since last evaluation of the output"}):0===U.length?H.formatMessage({id:"z+0t/R",defaultMessage:"You need to define at least one input variable"}):ce?null:H.formatMessage({id:"dYbJha",defaultMessage:"Please provide run name"}):H.formatMessage({id:"gUhc5g",defaultMessage:"You need to evaluate the resulting output first"}):H.formatMessage({id:"flJNTA",defaultMessage:"You need to provide values for all defined inputs"}):H.formatMessage({id:"dHAuWp",defaultMessage:"You need to provide a prompt template"}):H.formatMessage({id:"4HbEVz",defaultMessage:"You need to select a served model endpoint using dropdown first"})),[de,U.length,H,D,I,le,v,ce]),ge=(0,a.useMemo)((()=>v?le?de?null:H.formatMessage({id:"flJNTA",defaultMessage:"You need to provide values for all defined inputs"}):H.formatMessage({id:"dHAuWp",defaultMessage:"You need to provide a prompt template"}):H.formatMessage({id:"4HbEVz",defaultMessage:"You need to select a served model endpoint using dropdown first"})),[de,H,le,v]);if(t&&L)return(0,x.Y)(Sn,{isOpen:t&&L,closeExamples:()=>P(!1),closeModal:n,updatePromptTemplate:Z,updateInputVariableValue:G});return(0,x.FD)(J.M,{verticalSizing:"maxed_out",visible:t,onCancel:n,onOk:n,footer:(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:m.spacing.sm,justifyContent:"flex-end"},""),children:[(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_589",onClick:n,children:(0,x.Y)(X.A,{id:"mqTFL+",defaultMessage:"Cancel"})}),(0,x.Y)(c.m_M,{title:me,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_596",onClick:()=>{var e,t;Y(!0);const r=null===(e=ee[v])||void 0===e?void 0:e.name,a={...g,route_type:null===(t=ee[v])||void 0===t?void 0:t.type},s=(0,dn.TG)(Q,K);N((0,i.$v)({experimentId:p,promptTemplate:Q,modelInput:s,modelParameters:a,modelRouteName:r,promptParameters:K,modelOutput:I,runName:b,modelOutputParameters:k})).then((()=>{d(),n(),Y(!1),f("ARTIFACT")})).catch((e=>{E.A.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e),Y(!1)}))},"data-testid":"button-create-run",type:"primary",disabled:!pe,children:(0,x.Y)(X.A,{id:"8Uwpjw",defaultMessage:"Create run"})})})]}),title:(0,x.FD)("div",{children:[(0,x.Y)(u.T.Title,{level:2,css:(0,r.AH)({marginTop:m.spacing.sm,marginBottom:m.spacing.xs},""),children:(0,x.Y)(X.A,{id:"sLhmy7",defaultMessage:"New run"})}),(0,x.Y)(u.T.Hint,{css:Dn,children:"Create a new run using a large-language model by giving it a prompt template and model parameters"})]}),dangerouslySetAntdProps:{width:1200},children:[(0,x.FD)("div",{css:Fn,children:[(0,x.FD)("div",{children:[(0,x.Y)(c.D$Q.Label,{htmlFor:"selected_model",css:(0,r.AH)({marginBottom:m.spacing.sm},""),children:ie}),(0,x.Y)("div",{css:(0,r.AH)({marginBottom:m.spacing.lg,display:"flex",alignItems:"center"},""),children:(0,x.FD)(c.AYc,{label:ie,modal:!1,value:v?[(he=v,he.includes(":")?he.split(":")[1]:he)]:void 0,children:[(0,x.Y)(c.gGe,{id:"selected_model",css:Ln,allowClear:!1,placeholder:oe,withInlineLabel:!1}),(0,x.Y)(c.dn6,{loading:ne,maxHeight:400,matchTriggerWidth:!0,children:!ne&&(0,x.Y)(c.HI_,{children:(0,x.Y)(c.dhl,{autoFocus:!0,children:te.map((e=>(0,x.FD)(c.crD,{value:e.key,onChange:e=>{y(e)},checked:v===e.key,children:[e.name,e.mlflowDeployment&&(0,x.Y)(c.b5C,{children:e.mlflowDeployment.model.name})]},e.key)))})})})]})}),v&&(0,x.Y)(hn,{parameters:g,updateParameter:h}),(0,x.Y)("div",{css:Nn.formItem,children:(0,x.FD)(x.FK,{children:[(0,x.FD)(c.D$Q.Label,{htmlFor:"new_run_name",children:[(0,x.Y)(X.A,{id:"Zqj4VA",defaultMessage:"New run name"}),!b.trim()&&(0,x.Y)(c.D$Q.Message,{type:"error",message:H.formatMessage({id:"dYbJha",defaultMessage:"Please provide run name"})})]}),(0,x.Y)(c.pde,{id:"new_run_name","data-testid":"run-name-input",required:!0,value:b,onChange:e=>w(e.target.value)})]})})]}),(0,x.FD)("div",{children:[(0,x.FD)("div",{css:Nn.formItem,children:[(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:Pn,children:[(0,x.Y)(c.D$Q.Label,{htmlFor:"prompt_template",children:(0,x.Y)(X.A,{id:"uBTAtY",defaultMessage:"Prompt Template"})}),(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_695",onClick:()=>P(!0),style:{marginLeft:"auto"},size:"small",children:(0,x.Y)(X.A,{id:"13vJft",defaultMessage:"View Examples"})})]}),(0,x.Y)(c.D$Q.Hint,{children:(0,x.Y)(X.A,{id:"gC2Kxm",defaultMessage:"Give instructions to the model. Use '{{ }}' or the \"Add new variable\" button to add variables to your prompt."})})]}),(0,x.Y)(Tn,{id:"prompt_template",autoSize:{minRows:3},"data-testid":"prompt-template-input",value:Q,onChange:e=>Z(e.target.value),ref:j}),(0,x.Y)(bn,{violations:q})]}),U.map((e=>(0,x.Y)("div",{css:Nn.formItem,children:(0,x.FD)(x.FK,{children:[(0,x.Y)(c.D$Q.Label,{htmlFor:e,children:(0,x.Y)("span",{children:e})}),(0,x.Y)(Tn,{id:e,autoSize:!0,value:K[e]?K[e]:"",onChange:t=>G(e,t.target.value)})]})},e))),(0,x.Y)("div",{css:(0,r.AH)({marginBottom:2*m.spacing.md},""),children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_736",icon:(0,x.Y)(Nt.P,{}),onClick:W,children:(0,x.Y)(X.A,{id:"71hvMu",defaultMessage:"Add new variable"})})}),(0,x.Y)(_n,{evaluateButtonTooltip:ge,evaluationMetadata:k,evaluationOutput:I,disabled:!ue,isEvaluating:S,isOutputDirty:D,onCancelClick:ae,onEvaluateClick:re,evaluationError:R})]})]}),C&&(0,x.Y)("div",{css:(0,r.AH)({inset:0,backgroundColor:m.colors.overlayOverlay,position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1},""),children:(0,x.Y)(u.S,{})})]});var he},Nn={formItem:{marginBottom:16}},Hn=a.createContext({createNewRun:()=>{}}),On=e=>{let{children:t,visibleRuns:n,refreshRuns:r}=e;const[s,i]=(0,a.useState)(!1),[o,l]=(0,a.useState)(null),d=(0,a.useMemo)((()=>({createNewRun:e=>{i(!0),l(e||null)}})),[]);return(0,x.FD)(Hn.Provider,{value:d,children:[t,(0,ne.Ii)()&&(0,x.Y)(Bn,{visibleRuns:n,isOpen:s,closeModal:()=>i(!1),runBeingDuplicated:o,refreshRuns:r})]})},Un=()=>(0,a.useContext)(Hn),Kn=()=>({searchFilter:"",orderByKey:Ct.XM,orderByAsc:Ct.z$,startTime:Ct.xx,lifecycleFilter:Ct.ae,datasetsFilter:[],modelVersionFilter:Ct.eR}),zn=e=>(0,V.isArray)(e)?e.join():e,Vn={searchFilter:{deserializeLocalStorage:zn,deserializeQueryString:zn},orderByAsc:{serializeQueryString(e){return e.toString()},deserializeQueryString(e){return"true"===e}},datasetsFilter:{serializeQueryString(e){const t=e.map((e=>{let{name:t,digest:n,context:r}=e;return{name:t,digest:n,context:r}}));return(0,wt.Qr)(JSON.stringify(t))},deserializeQueryString(e){try{const t=JSON.parse((0,wt.yv)(e));return Array.isArray(t)?t:[]}catch{return[]}}},compareRunCharts:{serializeQueryString(e){return(0,wt.Qr)(JSON.stringify(e))},deserializeQueryString(e){try{const t=JSON.parse((0,wt.yv)(e));if(!Array.isArray(t))return;return t}catch{return}}},compareRunsMode:{serializeLocalStorage(){}}},Gn=["searchFilter","orderByKey","orderByAsc","startTime","lifecycleFilter","modelVersionFilter","datasetsFilter"],qn=()=>{const[e]=(0,o.ok)(),t=(0,a.useMemo)((()=>(0,V.pick)(Object.fromEntries(e.entries()),Gn)),[e]),{searchFilter:n,orderByKey:r,orderByAsc:s,startTime:i,lifecycleFilter:l,modelVersionFilter:d,datasetsFilter:c}=t,u=(0,V.keys)(t).length<1,{experimentId:p}=(0,o.g)(),m=e.get("experiments"),g=(0,a.useMemo)((()=>p?[p]:m?(e=>{try{return e?JSON.parse(e):[]}catch{return[]}})(m):[]),[p,m]);return[(0,a.useMemo)((()=>{if(u)return null;const e=(e=>{const t={...e};for(const r of Object.keys(t)){var n;const e=null===(n=Vn[r])||void 0===n?void 0:n.deserializeQueryString;e&&(t[r]=e(t[r]))}return t})((0,V.omitBy)({searchFilter:n,orderByKey:r,orderByAsc:s,startTime:i,lifecycleFilter:l,modelVersionFilter:d,datasetsFilter:c},V.isNil));return(0,V.assign)(Kn(),e)}),[n,r,s,i,l,d,c,u]),g]},$n=()=>{const[,e]=(0,o.ok)();return(t,n)=>{const r=(e=>{const t={...e};for(const r of Object.keys(t)){var n;const e=null===(n=Vn[r])||void 0===n?void 0:n.serializeQueryString;e&&(t[r]=e(t[r]))}return t})(t);e((e=>((0,V.entries)(r).forEach((t=>{let[n,r]=t;e.set(n,r)})),e)),n)}};var Wn=n(21879);const jn=a.memo((e=>{let{searchFacetsState:t,experimentId:n,runsData:i,viewState:o,updateViewState:l,onDownloadCsv:d,requestError:p,additionalControls:m,refreshRuns:g,viewMaximized:h,autoRefreshEnabled:f=!1}=e;const v=$n(),[y]=se(),b=(0,Wn.e)(),w=(0,z.z)().length>1,{startTime:C,lifecycleFilter:Y,datasetsFilter:S,searchFilter:A}=t,R=y,_=(0,Ie.A)(),{createNewRun:I}=Un(),[M,k]=(0,a.useState)(!1),{theme:E}=(0,u.u)(),T=(0,a.useMemo)((()=>(0,It.XU)(_)),[_]),D=Y===Ct.gy.ACTIVE?_.formatMessage({id:"0pdAuV",defaultMessage:"Active"}):_.formatMessage({id:"yJpGwW",defaultMessage:"Deleted"}),F=_.formatMessage({id:"+fb25b",defaultMessage:"Time created"}),L=void 0===R||"ARTIFACT"===R,P=(0,s.d4)((e=>e.entities.datasetsByExperimentId[n])),B=void 0!==P;return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:E.spacing.sm,justifyContent:"space-between",[E.responsive.mediaQueries.xs]:{flexDirection:"column"}},""),children:[(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:E.spacing.sm,alignItems:"center",flexWrap:"wrap"},""),children:[(0,x.Y)(Qt,{runsData:i,searchFilter:A,onSearchFilterChange:e=>{v({searchFilter:e})},onClear:()=>{v(Kn())},requestError:p}),(0,x.FD)(c.AYc,{label:F,value:"ALL"!==C?[T[C]]:[],children:[(0,x.Y)(c.gGe,{allowClear:"ALL"!==C,onClear:()=>{v({startTime:"ALL"})},"data-test-id":"start-time-select-dropdown"}),(0,x.Y)(c.dn6,{children:(0,x.Y)(c.HI_,{children:Object.keys(T).map((e=>(0,x.Y)(c.crD,{checked:e===C,title:T[e],"data-test-id":`start-time-select-${e}`,value:e,onChange:()=>{v({startTime:e})},children:T[e]},e)))})})]}),(0,x.FD)(c.AYc,{label:_.formatMessage({id:"iLFoPb",defaultMessage:"State"}),value:[D],children:[(0,x.Y)(c.gGe,{allowClear:!1,"data-testid":"lifecycle-filter"}),(0,x.Y)(c.dn6,{children:(0,x.FD)(c.HI_,{children:[(0,x.Y)(c.crD,{checked:Y===Ct.gy.ACTIVE,"data-testid":"active-runs-menu-item",value:Ct.gy.ACTIVE,onChange:()=>{v({lifecycleFilter:Ct.gy.ACTIVE})},children:(0,x.Y)(X.A,{id:"0pdAuV",defaultMessage:"Active"})},Ct.gy.ACTIVE),(0,x.Y)(c.crD,{checked:Y===Ct.gy.DELETED,"data-testid":"deleted-runs-menu-item",value:Ct.gy.DELETED,onChange:()=>{v({lifecycleFilter:Ct.gy.DELETED})},children:(0,x.Y)(X.A,{id:"yJpGwW",defaultMessage:"Deleted"})},Ct.gy.DELETED)]})})]}),(0,x.Y)(c.AYc,{label:_.formatMessage({id:"IZ95jb",defaultMessage:"Datasets"}),value:S.map((e=>e.name)),multiSelect:!0,children:(0,x.FD)(c.m_M,{title:!B&&(0,x.Y)(X.A,{id:"v8UFxB",defaultMessage:"No datasets were recorded for this experiment's runs."}),children:[(0,x.Y)(c.gGe,{allowClear:!0,onClear:()=>v({datasetsFilter:[]}),"data-test-id":"datasets-select-dropdown",showTagAfterValueCount:1,disabled:!B}),B&&(0,x.Y)(c.dn6,{maxHeight:600,children:(0,x.Y)(c.HI_,{children:(0,x.Y)(c.dhl,{children:P.map((e=>(0,x.FD)(c.jTC,{checked:S.some((t=>(0,Jt.R)(t,e))),title:e.name,"data-test-id":`dataset-dropdown-${e.name}`,value:e.name,onChange:()=>(e=>{const t=S.some((t=>(0,Jt.R)(t,e)))?S.filter((t=>!(0,Jt.R)(t,e))):[...S,e];v({datasetsFilter:t})})(e),children:[e.name," (",e.digest,")"," ",e.context&&(0,x.Y)(c.vwO,{css:(0,r.AH)({textTransform:"capitalize",marginRight:E.spacing.xs},""),children:e.context})]},e.name+e.digest+e.context)))})})})]})}),m]}),(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:E.spacing.sm,alignItems:"flex-start"},""),children:[(0,x.FD)(c.rId.Root,{children:[(0,x.Y)(c.rId.Trigger,{asChild:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_338",icon:(0,x.Y)(c.ssM,{}),"aria-label":_.formatMessage({id:"E5gbt5",defaultMessage:"More options"})})}),(0,x.FD)(c.rId.Content,{children:[(0,x.FD)(c.rId.Item,{className:"csv-button",onClick:d,children:[(0,x.Y)(c.rId.IconWrapper,{children:(0,x.Y)(c.s3U,{})}),`Download ${i.runInfos.length} runs`]}),(0,ne.Hn)()&&(0,x.FD)(x.FK,{children:[(0,x.Y)(c.rId.Separator,{}),(0,x.FD)(c.rId.CheckboxItem,{checked:f,onClick:()=>b((e=>({...e,autoRefreshEnabled:!e.autoRefreshEnabled}))),children:[(0,x.Y)(c.rId.ItemIndicator,{}),(0,x.Y)(X.A,{id:"YamyaP",defaultMessage:"Auto-refresh"})]})]})]})]}),(0,x.Y)(en,{isOpen:M,closeModal:()=>k(!1),experimentId:n}),L&&(0,x.Y)(c.m_M,{title:_.formatMessage({id:"eZOxx1",defaultMessage:"Toggle the preview sidepane"}),useAsLabel:!0,children:(0,x.Y)(Ht.k,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_403",pressed:o.previewPaneVisible,icon:(0,x.Y)(c.CPw,{}),onClick:()=>l({previewPaneVisible:!o.previewPaneVisible})})}),!(0,ne.Hn)()&&(0,x.Y)(Kt,{refreshRuns:g}),(0,ne.Ii)()&&!w&&(0,x.FD)(c.rId.Root,{children:[(0,x.Y)(c.rId.Trigger,{asChild:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_415",type:"primary",icon:(0,x.Y)(Nt.P,{}),children:(0,x.Y)(X.A,{id:"PEYesH",defaultMessage:"New run"})})}),(0,x.FD)(c.rId.Content,{children:[(0,x.FD)(c.rId.Item,{onSelect:()=>I(),children:[" ",(0,x.Y)(X.A,{id:"UmwZQv",defaultMessage:"using Prompt Engineering"}),(0,x.Y)(te.W,{})]}),(0,x.FD)(c.rId.Item,{onSelect:()=>k(!0),children:[" ",(0,x.Y)(X.A,{id:"vNRmQa",defaultMessage:"using Notebook"})]})]})]})]})]})}));var Qn={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"},Jn={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const Xn=a.memo((e=>{const t=$n(),n=(0,Wn.e)(),r=(0,Ie.A)(),{sortOptions:s}=e,{orderByKey:i,orderByAsc:o}=e,l=e=>{let{value:r}=e;const[a,s]=r.split(Ct.KE);t({orderByAsc:s===Ct.mh,orderByKey:a}),n((e=>e.selectedColumns.includes(a)?e:{...e,selectedColumns:[...e.selectedColumns,a]}))},d=(0,a.useMemo)((()=>`${i}${Ct.KE}${o?Ct.mh:Ct.KU}`),[o,i]),u=(0,a.useMemo)((()=>{const e=s.find((e=>e.value===d));let t=null===e||void 0===e?void 0:e.label;if(!t){const e=i.match(/^.+\.`(.+)`$/);e&&(t=e[1])}return`${r.formatMessage({id:"llrWuc",defaultMessage:"Sort"})}: ${t}`}),[d,i,s,r]),p=(0,a.useMemo)((()=>(0,x.FD)("span",{css:Qn,children:[o?(0,x.Y)(c.GCP,{}):(0,x.Y)(c.MMv,{})," ",u]})),[u,o]),m=e=>{l({value:e}),h(!1)},[g,h]=(0,a.useState)(!1);return(0,x.FD)(c.AYc,{label:p,onOpenChange:h,open:g,children:[(0,x.Y)(c.gGe,{onClear:()=>{l({value:""})},"data-test-id":"sort-select-dropdown","aria-label":u}),(0,x.Y)(c.dn6,{minWidth:250,children:(0,x.Y)(c.HI_,{children:(0,x.Y)(c.dhl,{children:s.map((e=>(0,x.Y)(c.crD,{value:e.value,onChange:m,checked:e.value===d,"data-test-id":`sort-select-${e.label}-${e.order}`,children:(0,x.FD)("span",{css:Jn,children:[e.order===Ct.mh?(0,x.Y)(c.Kpk,{}):(0,x.Y)(c.ZLN,{}),(0,wt.fx)(e.label,50)]})},e.value)))})})})]})})),Zn="GROUP",er=(0,It.GF)(Zn,Ct.RO.ATTRIBUTES),tr=(0,It.GF)(Zn,Ct.RO.PARAMS),nr=(0,It.GF)(Zn,Ct.RO.METRICS),rr=(0,It.GF)(Zn,Ct.RO.TAGS),ar=(e,t)=>e.filter((e=>e.toLowerCase().includes(t.toLowerCase()))),sr=(e,t)=>{if(!t)return e;const n=e.toLowerCase().indexOf(t.toLowerCase()),r=e.substring(0,n),a=e.substring(n,n+t.length),s=e.substring(n+t.length);return n>-1?(0,x.FD)("span",{children:[r,(0,x.Y)("strong",{children:a}),s]}):e},ir=a.memo((e=>{let{runsData:t,columnSelectorVisible:n,onChangeColumnSelectorVisible:s,selectedColumns:i}=e;const o=(0,Wn.e)(),l=(0,z.z)(),[d,p]=(0,a.useState)(""),{theme:m}=(0,u.u)(),g=(0,a.useRef)(null),h=(0,a.useRef)(null),f=(0,a.useRef)(null),v=(0,a.useMemo)((()=>(e=>{const t=[Ct.qo.USER,Ct.qo.SOURCE,Ct.qo.VERSION,Ct.qo.MODELS,Ct.qo.DESCRIPTION];return e&&t.unshift(Ct.qo.EXPERIMENT_NAME),t.unshift(Ct.qo.DATASET),t})(l.length>1)),[l.length]),y=(0,a.useCallback)((e=>o((t=>{const n=e(t.selectedColumns),r=Array.from(new Set(n));return{...t,selectedColumns:r}}))),[o]),b=(0,a.useMemo)((()=>E.A.getVisibleTagKeyList(t.tagsList)),[t]),w=(0,a.useMemo)((()=>({[Ct.RO.ATTRIBUTES]:v.map((e=>(0,It.GF)(Ct.RO.ATTRIBUTES,e))),[Ct.RO.PARAMS]:t.paramKeyList.map((e=>(0,It.GF)(Ct.RO.PARAMS,e))),[Ct.RO.METRICS]:t.metricKeyList.map((e=>(0,It.GF)(Ct.RO.METRICS,e))),[Ct.RO.TAGS]:b.map((e=>(0,It.GF)(Ct.RO.TAGS,e)))})),[t,v,b]),C=(0,a.useMemo)((()=>{const e=[],n=ar(v,d),r=ar(t.paramKeyList,d),a=ar(t.metricKeyList,d),s=ar(b,d);return n.length&&e.push({key:er,title:"Attributes",children:n.map((e=>({key:(0,It.GF)(Ct.RO.ATTRIBUTES,e),title:sr(e,d)})))}),a.length&&e.push({key:nr,title:`Metrics (${a.length})`,children:a.map((e=>({key:(0,It.GF)(Ct.RO.METRICS,e),title:sr(e,d)})))}),r.length&&e.push({key:tr,title:`Parameters (${r.length})`,children:r.map((e=>({key:(0,It.GF)(Ct.RO.PARAMS,e),title:sr(e,d)})))}),s.length&&e.push({key:rr,title:`Tags (${s.length})`,children:s.map((e=>({key:(0,It.GF)(Ct.RO.TAGS,e),title:e})))}),e}),[v,d,t,b]),Y=(0,a.useCallback)(((e,t)=>{y(e?e=>e.filter((e=>!t.includes(e))):e=>[...e,...t])}),[y]),S=(0,a.useCallback)(((e,t)=>{y(t?t=>t.filter((t=>t!==e)):t=>[...t,e])}),[y]);(0,a.useEffect)((()=>{n&&(p(""),requestAnimationFrame((()=>{var e,t;null===h||void 0===h||null===(e=h.current)||void 0===e||e.scrollTo(0,0),null===(t=g.current)||void 0===t||t.focus({preventScroll:!0}),f.current&&f.current.scrollIntoView({block:"nearest",behavior:"smooth"})})))}),[n]);const A=(0,a.useCallback)(((e,t)=>{let{node:{key:n,checked:r}}=t;if((0,It.tG)(n.toString(),Zn)){const e=(0,It.dz)(n.toString(),Zn),t=w[e];t&&Y(r,ar(t,d))}else S(n.toString(),r)}),[w,Y,S,d]),R=(0,a.useCallback)((e=>{if("ArrowDown"===e.key){const e=(null===(t=h.current)||void 0===t?void 0:t.querySelector('[role="tree"] input'))||null;e&&e.focus()}var t}),[]),_=(0,x.FD)("div",{css:(0,r.AH)({backgroundColor:m.colors.backgroundPrimary,width:400,border:"1px solid",borderColor:m.colors.border,[m.responsive.mediaQueries.xs]:{width:"100vw"}},""),onKeyDown:e=>{var t;"Escape"===e.key&&(s(!1),null===(t=f.current)||void 0===t||t.focus())},children:[(0,x.Y)("div",{css:e=>({padding:e.spacing.md}),children:(0,x.Y)(c.pde,{value:d,prefix:(0,x.Y)(c.WIv,{}),placeholder:"Search columns",allowClear:!0,ref:g,onChange:e=>{p(e.target.value)},onKeyDown:R})}),(0,x.Y)("div",{ref:h,css:(0,r.AH)({maxHeight:480,overflowY:"scroll",overflowX:"hidden",paddingBottom:m.spacing.md,"span[title]":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},[m.responsive.mediaQueries.xs]:{maxHeight:"calc(100vh - 100px)"}},""),children:(0,x.Y)(c.PH6,{"data-testid":"column-selector-tree",mode:"checkable",dangerouslySetAntdProps:{checkedKeys:i,onCheck:A},defaultExpandedKeys:[er,tr,nr,rr],treeData:C})})]});return(0,x.Y)(c.msM,{overlay:_,placement:"bottomLeft",trigger:["click"],visible:n,onVisibleChange:s,children:(0,x.FD)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscolumnselector.tsx_315",ref:f,style:{display:"flex",alignItems:"center"},"data-testid":"column-selection-dropdown",icon:(0,x.Y)(c.jng,{}),children:[(0,x.Y)(X.A,{id:"ny+fBZ",defaultMessage:"Columns"})," ",(0,x.Y)(c.D3D,{})]})})}));var or=n(62862),lr=n(12772);const dr=(0,me.YK)({minimum:{id:"iT8ODo",defaultMessage:"Minimum"},maximum:{id:"au61Yy",defaultMessage:"Maximum"},average:{id:"/LfvdB",defaultMessage:"Average"},attributes:{id:"cy9EfG",defaultMessage:"Attributes"},tags:{id:"LEiN8m",defaultMessage:"Tags"},params:{id:"i9OADf",defaultMessage:"Params"},dataset:{id:"RtKhwd",defaultMessage:"Dataset"},noParams:{id:"Q73eXs",defaultMessage:"No params"},noTags:{id:"jHWRLw",defaultMessage:"No tags"},aggregationTooltip:{id:"fKx4kG",defaultMessage:"Aggregation: {value}"},noResults:{id:"aaVp/T",defaultMessage:"No results"}});var cr={name:"9q39xd",styles:"min-width:32px"},ur={name:"o5v4ro",styles:"max-height:400px;overflow-y:scroll"};const pr=e=>{let{runsData:t,onChange:n,groupBy:s,useGroupedValuesInCharts:i,onUseGroupedValuesInChartsChange:o}=e;const l=(0,Ie.A)(),d=(0,a.useRef)(null),p=(0,a.useRef)(null),m=(0,a.useRef)(null),g=(0,a.useRef)(null),h=l.formatMessage(dr.minimum),f=l.formatMessage(dr.maximum),v=l.formatMessage(dr.average),y=l.formatMessage(dr.dataset),b=(0,a.useMemo)((()=>(0,V.uniq)((0,V.values)(t.tagsList).flatMap((e=>(0,V.keys)(e).filter((e=>!e.startsWith(Me.nt))))))),[t.tagsList]),{aggregateFunction:w=lr.it.Average,groupByKeys:C=[]}=s||{},Y={min:h,max:f,average:v}[w],{theme:S}=(0,u.u)(),[A,R]=(0,a.useState)("");(0,a.useEffect)((()=>{requestAnimationFrame((()=>{g.current.focus()}))}),[]);const _=b.filter((e=>e.toLowerCase().includes(A.toLowerCase()))),I=t.paramKeyList.filter((e=>e.toLowerCase().includes(A.toLowerCase()))),M=(0,a.useMemo)((()=>!(0,V.isEmpty)((0,V.compact)(t.datasetsList))),[t.datasetsList])&&y.toLowerCase().includes(A.toLowerCase()),k=_.length>0||I.length>0||M,E=(0,a.useCallback)(((e,t,r)=>{if(r){const r=[...C];r.some((n=>n.mode===e&&n.groupByData===t))||r.push({mode:e,groupByData:t}),n({aggregateFunction:w,groupByKeys:r})}else{const r=C.filter((n=>!(n.mode===e&&n.groupByData===t)));if(!r.length)return void n(null);n({aggregateFunction:w,groupByKeys:r})}}),[w,C,n]),T=(e,t)=>C.some((n=>n.mode===e&&n.groupByData===t));return(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:S.spacing.xs,padding:S.spacing.sm},""),children:[(0,x.Y)(c.pde,{value:A,onChange:e=>R(e.target.value),prefix:(0,x.Y)(c.WIv,{}),placeholder:"Search",autoFocus:!0,ref:g,onKeyDown:e=>{if("ArrowDown"!==e.key&&"Tab"!==e.key)"Escape"!==e.key&&e.stopPropagation();else{const e=d.current||p.current||m.current;null===e||void 0===e||e.focus()}}}),(0,x.FD)(c.rId.Root,{children:[(0,x.Y)(c.m_M,{placement:"right",title:(0,x.Y)(X.A,{...dr.aggregationTooltip,values:{value:Y||w}}),children:(0,x.Y)(c.rId.Trigger,{asChild:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_168",icon:(0,x.Y)(c.L64,{}),css:cr,"aria-label":"Change aggregation function"})})}),(0,x.FD)(c.rId.Content,{align:"start",side:"right",children:[(0,ne.Bh)()&&(0,x.FD)(x.FK,{children:[(0,x.FD)(c.rId.CheckboxItem,{disabled:!C.length,checked:i,onCheckedChange:o,children:[(0,x.Y)(c.rId.ItemIndicator,{}),"Use grouping from the runs table in charts"]}),(0,x.Y)(c.rId.Separator,{})]}),(0,x.FD)(c.rId.RadioGroup,{value:w,onValueChange:e=>{if((0,V.values)(lr.it).includes(e)){const t=e,r={...s,aggregateFunction:t};n(r)}},children:[(0,x.FD)(c.rId.RadioItem,{disabled:!C.length,value:lr.it.Min,children:[(0,x.Y)(c.rId.ItemIndicator,{}),h]},lr.it.Min),(0,x.FD)(c.rId.RadioItem,{disabled:!C.length,value:lr.it.Max,children:[(0,x.Y)(c.rId.ItemIndicator,{}),f]},lr.it.Max),(0,x.FD)(c.rId.RadioItem,{disabled:!C.length,value:lr.it.Average,children:[(0,x.Y)(c.rId.ItemIndicator,{}),v]},lr.it.Average)]})]})]})]}),(0,x.FD)(c.rId.Group,{css:ur,children:[M&&(0,x.FD)(x.FK,{children:[(0,x.Y)(c.rId.Label,{children:(0,x.Y)(X.A,{...dr.attributes})}),y.toLowerCase().includes(A.toLowerCase())&&(0,x.FD)(c.rId.CheckboxItem,{checked:T(lr.uq.Dataset,"dataset"),ref:d,onCheckedChange:e=>E(lr.uq.Dataset,"dataset",e),children:[(0,x.Y)(c.rId.ItemIndicator,{}),y]},(0,or._p)(lr.uq.Dataset,"dataset",w)),(0,x.Y)(c.rId.Separator,{})]}),_.length>0&&(0,x.FD)(x.FK,{children:[(0,x.Y)(c.rId.Label,{children:(0,x.Y)(X.A,{...dr.tags})}),_.map(((e,t)=>{const n=(0,or._p)(lr.uq.Tag,e,w);return(0,x.FD)(c.rId.CheckboxItem,{checked:T(lr.uq.Tag,e),ref:0===t?p:void 0,onCheckedChange:t=>E(lr.uq.Tag,e,t),children:[(0,x.Y)(c.rId.ItemIndicator,{}),e]},n)})),!b.length&&(0,x.FD)(c.rId.Item,{disabled:!0,children:[(0,x.Y)(c.rId.ItemIndicator,{})," ",(0,x.Y)(X.A,{...dr.noTags})]}),(0,x.Y)(c.rId.Separator,{})]}),I.length>0&&(0,x.FD)(x.FK,{children:[(0,x.Y)(c.rId.Label,{children:(0,x.Y)(X.A,{...dr.params})}),I.map(((e,t)=>{const n=(0,or._p)(lr.uq.Param,e,w);return(0,x.FD)(c.rId.CheckboxItem,{checked:T(lr.uq.Param,e),ref:0===t?m:void 0,onCheckedChange:t=>E(lr.uq.Param,e,t),children:[(0,x.Y)(c.rId.ItemIndicator,{}),e]},n)})),!t.paramKeyList.length&&(0,x.Y)(c.rId.Item,{disabled:!0,children:(0,x.Y)(X.A,{...dr.noParams})})]}),!k&&(0,x.Y)(c.rId.Item,{disabled:!0,children:(0,x.Y)(X.A,{...dr.noResults})})]})]})};var mr={name:"taqmwb",styles:"margin-left:4px;margin-right:0"};const gr=a.memo((e=>{let{runsData:t,groupBy:n,isLoading:a,onChange:s,useGroupedValuesInCharts:i,onUseGroupedValuesInChartsChange:o}=e;const{theme:l}=(0,u.u)(),d=(0,or.Zp)(n)||{aggregateFunction:lr.it.Average,groupByKeys:[]},p=d&&!(0,V.isEmpty)(d.groupByKeys);return(0,x.FD)(c.rId.Root,{modal:!1,children:[(0,x.Y)(c.rId.Trigger,{asChild:!0,children:(0,x.FD)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_306",icon:(0,x.Y)(c.aTS,{}),style:{display:"flex",alignItems:"center"},"data-testid":"column-selection-dropdown",endIcon:(0,x.Y)(c.D3D,{}),children:[p?(0,x.Y)(X.A,{id:"AFI74W",defaultMessage:"Group by: {value}",values:{value:d.groupByKeys[0].groupByData}}):(0,x.Y)(X.A,{id:"fjM/KK",defaultMessage:"Group by"}),d.groupByKeys.length>1&&(0,x.FD)(c.vwO,{css:mr,children:["+",d.groupByKeys.length-1]}),n&&(0,x.Y)(c.htq,{"aria-hidden":"false",css:(0,r.AH)({color:l.colors.textPlaceholder,fontSize:l.typography.fontSizeSm,marginLeft:l.spacing.sm,":hover":{color:l.colors.actionTertiaryTextHover}},""),role:"button",onClick:()=>{s(null)},onPointerDownCapture:e=>{e.stopPropagation()}})]})}),(0,x.Y)(c.rId.Content,{children:a?(0,x.Y)(c.rId.Item,{children:(0,x.Y)(u.S,{})}):(0,x.Y)(pr,{groupBy:d,onChange:s,runsData:t,onUseGroupedValuesInChartsChange:o,useGroupedValuesInCharts:i})})]})}));var hr={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},fr={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const vr=e=>{let{sortOptions:t,orderByKey:n,orderByAsc:s,onOptionSelected:i}=e;const{theme:o}=(0,u.u)(),l=$n(),d=(0,Wn.e)(),p=(0,a.useRef)(null),[m,g]=(0,a.useState)(""),h=(0,a.useRef)(null),f=(0,a.useMemo)((()=>t.filter((e=>e.label.toLowerCase().includes(m.toLowerCase())))),[t,m]),v=e=>{l({orderByAsc:e}),i()};return(0,a.useEffect)((()=>{requestAnimationFrame((()=>{var e;null===(e=p.current)||void 0===e||e.focus()}))}),[]),(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:(0,r.AH)({padding:`${o.spacing.sm}px ${o.spacing.lg/2}px ${o.spacing.sm}px`,width:"100%",display:"flex",gap:o.spacing.xs},""),children:[(0,x.Y)(c.pde,{prefix:(0,x.Y)(c.WIv,{}),value:m,type:"search",onChange:e=>g(e.target.value),placeholder:"Search",autoFocus:!0,ref:p,onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(t=h.current)||void 0===t||t.focus()}}),(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:o.spacing.xs},""),children:[(0,x.Y)(Ht.k,{pressed:!s,icon:(0,x.Y)(c.ZLN,{}),componentId:"mlflow.experiment_page.sort_select_v2.sort_desc",onClick:()=>v(!1),"aria-label":"Sort descending"}),(0,x.Y)(Ht.k,{pressed:s,icon:(0,x.Y)(c.Kpk,{}),componentId:"mlflow.experiment_page.sort_select_v2.sort_asc",onClick:()=>v(!0),"aria-label":"Sort ascending"})]})]}),(0,x.FD)(c.rId.Group,{css:hr,children:[f.map(((e,t)=>(0,x.FD)(c.rId.CheckboxItem,{onClick:()=>(e=>{l({orderByKey:e}),d((t=>t.selectedColumns.includes(e)?t:{...t,selectedColumns:[...t.selectedColumns,e]})),i()})(e.value),checked:e.value===n,"data-test-id":`sort-select-${e.label}`,ref:0===t?h:void 0,children:[(0,x.Y)(c.rId.ItemIndicator,{}),(0,x.Y)("span",{css:fr,children:(0,wt.fx)(e.label,50)})]},e.value))),!f.length&&(0,x.Y)(c.rId.Item,{disabled:!0,children:(0,x.Y)(X.A,{id:"EkUD0b",defaultMessage:"No results"})})]})]})};var yr={name:"9q39xd",styles:"min-width:32px"};const xr=a.memo((e=>{let{metricKeys:t,paramKeys:n,orderByAsc:r,orderByKey:s}=e;const i=(0,Ie.A)(),[o,l]=(0,a.useState)(!1),{theme:d}=(0,u.u)(),p=(0,a.useMemo)((()=>Object.keys(Ct.Eg).map((e=>({label:Ct.Eg[e],value:Ct.T8[e]})))),[]),m=(0,a.useMemo)((()=>t.map((e=>({label:e,value:`${(0,It.GF)(Ct.RO.METRICS,e)}`})))),[t]),g=(0,a.useMemo)((()=>n.map((e=>({label:e,value:`${(0,It.GF)(Ct.RO.PARAMS,e)}`})))),[n]),h=(0,a.useMemo)((()=>[...p,...m,...g]),[p,m,g]),f=(0,a.useMemo)((()=>{const e=h.find((e=>e.value===s));let t=null===e||void 0===e?void 0:e.label;if(!t){const e=s.match(/^.+\.`(.+)`$/);e&&(t=e[1])}return`${i.formatMessage({id:"sKaamx",defaultMessage:"Sort"})}: ${t}`}),[h,i,s]);return(0,x.FD)(c.rId.Root,{open:o,onOpenChange:l,modal:!1,children:[(0,x.Y)(c.rId.Trigger,{"data-test-id":"sort-select-dropdown",asChild:!0,children:(0,x.Y)(u.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:r?(0,x.Y)(c.GCP,{}):(0,x.Y)(c.MMv,{}),css:yr,"aria-label":f,endIcon:(0,x.Y)(c.D3D,{}),children:f})}),(0,x.Y)(c.rId.Content,{minWidth:250,children:(0,x.Y)(vr,{sortOptions:h,orderByKey:s,orderByAsc:r,onOptionSelected:()=>l(!1)})})]})})),br=a.memo((e=>{var t;let{runsData:n,viewState:s,updateViewState:i,searchFacetsState:o,experimentId:l,requestError:d,expandRows:p,updateExpandRows:m,refreshRuns:g,uiState:h,isLoading:f}=e;const[v,y]=se(),{paramKeyList:b,metricKeyList:w,tagsList:C}=n,{orderByAsc:Y,orderByKey:S}=o,A=(0,Wn.e)(),R="TABLE"!==v,_="ARTIFACT"===v,{theme:I}=(0,u.u)(),M=b,k=w,T=E.A.getVisibleTagKeyList(C),D=(0,a.useCallback)((()=>(0,It.D1)(n,T,M,k)),[k,M,T,n]),F=((e,t)=>(0,a.useMemo)((()=>{let n=[];const r=[Ct.mh,Ct.KU];return n=[...Object.keys(Ct.Eg).reduce(((e,t)=>{const n=Ct.Eg[t];return r.forEach((r=>{e.push({label:n,value:Ct.T8[t]+Ct.KE+r,order:r})})),e}),[]),...e.reduce(((e,t)=>(r.forEach((n=>{e.push({label:t,value:`${(0,It.GF)(Ct.RO.METRICS,t)}${Ct.KE}${n}`,order:n})})),e)),[]),...t.reduce(((e,t)=>(r.forEach((n=>{e.push({label:t,value:`${(0,It.GF)(Ct.RO.PARAMS,t)}${Ct.KE}${n}`,order:n})})),e)),[])],n}),[e,t]))(k,M),L=Object.values(s.runsSelected).filter(Boolean).length,P=L>1||1===L||L>0,B=!_,N=(0,a.useCallback)((e=>i({columnSelectorVisible:e})),[i]),H=(0,a.useCallback)((()=>m(!p)),[p,m]),O=(0,a.useMemo)((()=>n.datasetsList.some((e=>(null===e||void 0===e?void 0:e.length)>1))),[n]);return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:I.spacing.sm,flexDirection:"column",marginTop:h.viewMaximized?void 0:I.spacing.md},""),children:[P&&(0,x.Y)(Pt,{runsData:n,searchFacetsState:o,viewState:s,refreshRuns:g}),!P&&(0,x.Y)(jn,{onDownloadCsv:D,searchFacetsState:o,experimentId:l,viewState:s,updateViewState:i,runsData:n,requestError:d,refreshRuns:g,viewMaximized:h.viewMaximized,autoRefreshEnabled:h.autoRefreshEnabled,additionalControls:(0,x.FD)(x.FK,{children:[(0,ne.Ir)()?(0,x.Y)(xr,{orderByAsc:Y,orderByKey:S,metricKeys:k,paramKeys:M}):(0,x.Y)(Xn,{orderByAsc:Y,orderByKey:S,sortOptions:F}),!R&&(0,x.Y)(ir,{columnSelectorVisible:s.columnSelectorVisible,onChangeColumnSelectorVisible:N,runsData:n,selectedColumns:h.selectedColumns}),!R&&O&&(0,x.Y)(c.ffE,{onClick:H,children:(0,x.Y)(X.A,{id:"mRc7MY",defaultMessage:"Expand rows"})}),B&&(0,x.Y)(gr,{groupBy:h.groupBy,onChange:e=>{A((t=>({...t,groupBy:e})))},runsData:n,isLoading:f,useGroupedValuesInCharts:null===(t=h.useGroupedValuesInCharts)||void 0===t||t,onUseGroupedValuesInChartsChange:e=>{A((t=>({...t,useGroupedValuesInCharts:e})))}})]})}),(0,x.Y)("div",{children:(0,x.Y)(ue,{viewState:s,runsAreGrouped:Boolean(h.groupBy)})})]})}));var wr=n(45959),Cr=n.n(wr);const Yr=a.lazy((()=>Promise.all([n.e(794),n.e(402)]).then(n.bind(n,22402)))),Sr=e=>(0,x.Y)(a.Suspense,{fallback:(0,x.Y)("div",{css:e=>({display:"flex",justifyContent:"center",margin:e.spacing.md}),children:(0,x.Y)(u.S,{})}),children:(0,x.Y)(Yr,{...e})});var Ar=n(81866),Rr=n(32378);const _r={ALL:null,LAST_HOUR:36e5,LAST_24_HOURS:864e5,LAST_7_DAYS:6048e5,LAST_30_DAYS:2592e6,LAST_YEAR:31104e6},Ir=(e,t,n,r,a)=>{const s=t.lifecycleFilter===Rr.gy.ACTIVE?Ye.qi.ACTIVE_ONLY:Ye.qi.DELETED_ONLY,{runsPinned:o}=t,l=(e=>{let{orderByKey:t,orderByAsc:n}=e;return t?n?[t+" ASC"]:[t+" DESC"]:[]})(t),d=((e,t)=>{let{startTime:n}=e;const r=_r[n];return n&&r&&"ALL"!==n?"attributes.start_time >= "+(t-r):null})(t,n),c=(e=>{let{datasetsFilter:t}=e;return 0===t.length?null:`dataset.name IN (${t.map((e=>`'${e.name}'`)).join(",")}) AND dataset.digest IN (${t.map((e=>`'${e.digest}'`)).join(",")})`})(t),u=((e,t,n)=>{let{searchFilter:r}=e;const a=[];if(r&&a.push(r),t&&a.push(t),n&&a.push(n),0!==a.length)return a.join(" and ")})(t,d,c),p=(e=>{let{orderByKey:t,searchFilter:n}=e;return!t&&!n||t===Ct.T8.DATE})(t);return{experimentIds:e,filter:u,runViewType:s,orderBy:l,shouldFetchParents:p,pageToken:r,runsPinned:o,maxResults:a||i.Aj}},Mr=e=>{const{lifecycleFilter:t,modelVersionFilter:n,datasetsFilter:r,searchFilter:a,startTime:s}=e;return Boolean(t!==Ct.ae||n!==Ct.eR||0!==r.length||a||s!==Ct.xx)},kr=e=>{let{enableSorting:t,canonicalSortKey:n,displayName:a,context:s}=e;const{orderByKey:i,orderByAsc:o}=s||{},l=$n(),{theme:d}=(0,u.u)();return(0,x.FD)("div",{role:"columnheader",css:(0,r.AH)({height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 12px",gap:d.spacing.sm,svg:{color:d.colors.textSecondary},"&:hover":{color:t?d.colors.actionTertiaryTextHover:"unset",svg:{color:d.colors.actionTertiaryTextHover}}},""),className:n===i?"is-ordered-by":"",onClick:t?()=>(()=>{let e=!o;n!==i&&(e=!1),l({orderByKey:n,orderByAsc:e})})():void 0,children:[(0,x.Y)("span",{"data-test-id":`sort-header-${a}`,children:a}),t&&n===i?o?(0,x.Y)(c.GCP,{}):(0,x.Y)(c.MMv,{}):null]})};var Er=n(76758);const Tr=a.memo((e=>{let{value:t}=e;const{startTime:n,referenceTime:r,runStatus:a}=t||{};return n?(0,x.FD)("span",{css:Dr.cellWrapper,title:E.A.formatTimestamp(n),children:[(0,x.Y)(Er.F,{status:a}),E.A.timeSinceStr(n,r)]}):(0,x.Y)(x.FK,{children:"-"})})),Dr={cellWrapper:e=>({display:"flex",alignItems:"center",gap:e.spacing.sm})},Fr=e=>{let{text:t,maxSize:n,className:r,allowShowMore:s=!1,dataTestId:i}=e;if(t.length<=n)return(0,x.Y)("span",{className:r,"data-testid":i,children:t});const o=`${t.substr(0,n)}...`,[l,d]=(0,a.useState)(!1);return(0,x.FD)("span",{className:r,"data-testid":i,children:[l?t:o,s&&(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_common_components_trimmedtext.tsx_30",type:"link",onClick:()=>d(!l),size:"small",css:Lr.expandButton,"data-test-id":"trimmed-text-button",children:l?"collapse":"expand"})]})},Lr={expandButton:{display:"inline-block"}},Pr=a.memo((e=>{let{value:t}=e;const n=E.A.getRunDescriptionFromTags(t)||"-";return(0,x.Y)(x.FK,{children:(0,x.Y)(c.m_M,{title:n,children:(0,x.Y)("span",{children:(0,x.Y)(Fr,{text:n,maxSize:50})})})})})),Br=a.memo((e=>{let{data:t,value:n}=e;return t.experimentId?(0,x.Y)(o.N_,{to:g.h.getExperimentPageRoute(t.experimentId),title:n.name,children:n.basename}):null}));var Nr=n(69869),Hr=n(21317);var Or={name:"1989ovb",styles:"vertical-align:middle"},Ur={name:"1p2zdak",styles:"margin-right:0;vertical-align:middle"},Kr={name:"osm46o",styles:"width:20px;display:flex;align-items:center;justify-content:flex-start;flex-shrink:0"},zr={name:"167129t",styles:"text-overflow:ellipsis;overflow:hidden;cursor:pointer"};const Vr=e=>{let{model:{isUc:t,registeredModelName:n,registeredModelVersion:a,flavors:s,artifactPath:i}={},experimentId:l,runUuid:d}=e;const{theme:p}=(0,u.u)();return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",gap:p.spacing.xs,overflow:"hidden"},""),children:[(0,x.Y)("div",{css:Kr,children:n?(0,x.Y)(Hr.h,{css:(0,r.AH)({color:p.colors.actionPrimaryBackgroundDefault},"")}):(0,x.Y)(c.oiI,{css:(0,r.AH)({color:p.colors.actionPrimaryBackgroundDefault},"")})}),(0,x.Y)(o.N_,{to:n&&a?Nr.fM.getModelVersionPageRoute(n,a):g.h.getRunPageRoute(l,d,i),target:"_blank",css:zr,children:(()=>{const e=`${n} v${a}`;if(n)return(0,x.FD)(c.m_M,{title:e,placement:"topLeft",children:[(0,x.Y)("span",{css:Or,children:n})," ",(0,x.FD)(c.vwO,{css:Ur,children:["v",a]})]});return(null===s||void 0===s?void 0:s[0])||(0,x.Y)(X.A,{id:"giZdtW",defaultMessage:"Model"})})()})]})};var Gr={name:"1xsgnar",styles:"width:100%;&>div{max-width:100%;display:flex;}"};const qr=a.memo((e=>{if(!e.value)return(0,x.Y)(x.FK,{children:"-"});const{registeredModels:t,loggedModels:n,experimentId:r,runUuid:a}=e.value,s=E.A.mergeLoggedAndRegisteredModels(n,t);return s&&s.length?(0,x.Y)("div",{css:Gr,children:(0,x.Y)(c.nEg,{children:s.map(((e,t)=>(0,x.Y)(Vr,{model:e,experimentId:r,runUuid:a},e.artifactPath||t)))})}):(0,x.Y)(x.FK,{children:"-"})})),$r=a.memo((e=>{let{value:t}=e;if(!t)return(0,x.Y)(x.FK,{children:"-"});const{version:n,name:r,type:a}=t;return E.A.renderSourceVersion(n,r,a)||(0,x.Y)(x.FK,{children:"-"})}));var Wr,jr,Qr=n(58898);function Jr(){return Jr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Jr.apply(this,arguments)}function Xr(e,t){let{title:n,titleId:r,...s}=e;return a.createElement("svg",Jr({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},s),n?a.createElement("title",{id:r},n):null,Wr||(Wr=a.createElement("path",{d:"M8 3C3.45 3 1.4375 6.33333 1 8C1.4375 9.66667 3.45 13 8 13C12.55 13 14.5625 9.66667 15 8C14.5625 6.33333 12.55 3 8 3Z",fill:"currentColor",stroke:"currentColor"})),jr||(jr=a.createElement("circle",{cx:8,cy:8,r:2.25,fill:"currentColor",stroke:"white",strokeWidth:1.5})))}const Zr=a.forwardRef(Xr);n.p;const ea=()=>(0,ne.M1)()?(0,x.Y)(u.I,{component:Zr}):(0,x.Y)(c.kFX,{}),ta={mouseEnterDelay:0,mouseLeaveDelay:0},na=e=>{let{runUuid:t,className:n,rowHidden:r,buttonHidden:a,disabled:s,onClick:i,label:o}=e;const{theme:l}=(0,u.u)();return a?(0,x.Y)("div",{className:n,css:[ra.button(l),""]}):s?(0,x.Y)(c.DAb,{className:n,css:[ra.button(l),{opacity:.25,color:l.colors.grey400},""]}):(0,x.Y)(c.m_M,{dangerouslySetAntdProps:ta,placement:"right",title:o,children:(0,x.FD)("label",{className:n,css:ra.button(l),children:[(0,x.Y)("span",{css:u.v,children:o}),(0,x.Y)("input",{type:"checkbox",className:"is-visibility-toggle-checkbox",checked:!r,onChange:()=>{t&&((0,ne.M1)()?i(Qr.oy.CUSTOM,t):i(t))}}),r?(0,x.Y)(c.DAb,{}):(0,x.Y)(ea,{})]})})},ra={button:e=>({width:e.general.iconFontSize,color:e.colors.grey400,".ag-row:hover &":{color:e.colors.grey500}})},aa=a.createContext({runsHiddenMode:Qr.oy.FIRST_10_RUNS,useGroupedValuesInCharts:!0}),sa=e=>{let{children:t,runsHiddenMode:n,useGroupedValuesInCharts:r}=e;const s=(0,a.useMemo)((()=>({runsHiddenMode:n,useGroupedValuesInCharts:null===r||void 0===r||r})),[n,r]);return(0,x.Y)(aa.Provider,{value:s,children:t})},ia=()=>a.useContext(aa),oa={visibility:{groups:(0,me.YK)({unhide:{id:"8Gz0OE",defaultMessage:"Unhide group"},hide:{id:"TfuAgs",defaultMessage:"Hide group"}}),runs:(0,me.YK)({unhide:{id:"xmpvlI",defaultMessage:"Unhide run"},hide:{id:"qTjYVU",defaultMessage:"Hide run"}})},pinning:{groups:(0,me.YK)({unpin:{id:"jkeYf8",defaultMessage:"Unpin group"},pin:{id:"8hpS0b",defaultMessage:"Pin group"}}),runs:(0,me.YK)({unpin:{id:"ugm2f6",defaultMessage:"Unpin run"},pin:{id:"fjiojF",defaultMessage:"Pin run"}})}},la={mouseEnterDelay:0,mouseLeaveDelay:0},da=a.memo((e=>{const t=(0,Wn.e)(),{theme:n}=(0,u.u)(),{useGroupedValuesInCharts:r}=ia(),{groupParentInfo:s,runDateAndNestInfo:i,visibilityControl:o}=e.data,{belongsToGroup:l}=i||{},d=Boolean(s),p=(0,ne.Bh)()&&o===lr.VB.Disabled,{pinned:m,hidden:g}=e.value,{runUuid:h,rowUuid:f}=e.data,v=s?f:h,y=(0,ne.Bh)()&&!1===r&&s?Boolean(s.allRunsHidden):g,b=d?y?oa.visibility.groups.unhide:oa.visibility.groups.hide:y?oa.visibility.runs.unhide:oa.visibility.runs.hide,w=d?m?oa.pinning.groups.unpin:oa.pinning.groups.pin:m?oa.pinning.runs.unpin:oa.pinning.runs.pin,C=(0,a.useMemo)((()=>(0,ne.Bh)()?o===lr.VB.Hidden:!(!(0,ne.M1)()||s&&!(0,or.mC)(s)||Boolean(h)&&!l)),[s,l,h,o]);return(0,x.FD)("div",{css:ua.actionsContainer,children:[(0,x.Y)(na,{rowHidden:y,buttonHidden:C,disabled:p,label:(0,x.Y)(X.A,{...b}),onClick:e.onToggleVisibility,runUuid:v,css:[ua.actionCheckbox(n),(0,ne.M1)()&&ua.showOnlyInCompareMode,""]}),(e.data.pinnable&&h||s)&&(0,x.Y)(c.m_M,{dangerouslySetAntdProps:la,placement:"right",title:(0,x.Y)(X.A,{...w}),children:(0,x.FD)("label",{css:ua.actionCheckbox(n),className:"is-pin-toggle","data-testid":"column-pin-toggle",children:[(0,x.Y)("span",{css:u.v,children:(0,x.Y)(X.A,{...w})}),(0,x.Y)("input",{type:"checkbox",checked:m,onChange:()=>{const n=s?e.data.rowUuid:h;t((e=>n?{...e,runsPinned:e.runsPinned.includes(n)?e.runsPinned.filter((e=>e!==n)):[...e.runsPinned,n]}:e))}}),m?(0,x.Y)(c.aS3,{}):(0,x.Y)(c.tsw,{})]})},Math.random())]})}),((e,t)=>{var n,r;return e.value.hidden===t.value.hidden&&e.value.pinned===t.value.pinned&&e.data.visibilityControl===t.data.visibilityControl&&(null===(n=e.data.groupParentInfo)||void 0===n?void 0:n.allRunsHidden)===(null===(r=t.data.groupParentInfo)||void 0===r?void 0:r.allRunsHidden)})),ca=e=>{let{event:t}=e;return!!("Tab"===t.key&&t.target instanceof HTMLElement&&(t.target.classList.contains("ag-cell")||t.target.classList.contains("is-visibility-toggle-checkbox")))},ua={actionsContainer:{display:"flex",gap:18},showOnlyInCompareMode:{display:"none",".is-table-comparing-runs-mode &":{display:"flex"}},actionCheckbox:e=>({input:{width:0,appearance:"none"},cursor:"pointer",display:"flex",svg:{width:e.general.iconFontSize,height:e.general.iconFontSize,cursor:"pointer"},"&.is-pin-toggle svg":{color:"transparent",".ag-row:hover &":{color:e.colors.grey500}},"& input:checked + span svg":{color:e.colors.grey500},"& input:focus-visible + span svg":{color:e.colors.grey500}})},pa=()=>(0,ne.M1)()?(0,x.Y)(u.I,{component:Zr}):(0,x.Y)(c.kFX,{}),ma=a.memo((e=>{let{allRunsHidden:t,onToggleVisibility:n}=e;const{theme:r}=(0,u.u)(),a=(0,Ie.A)(),{runsHiddenMode:s}=ia();return(0,x.FD)(c.rId.Root,{modal:!1,children:[(0,x.Y)(c.rId.Trigger,{asChild:!0,children:(0,x.Y)("button",{css:[ha.actionButton(r),(0,ne.M1)()&&ha.showOnlyInCompareMode,""],"data-testid":"experiment-view-runs-visibility-column-header","aria-label":a.formatMessage({id:"9HXup+",defaultMessage:"Toggle visibility of runs"}),children:s===Qr.oy.HIDEALL||t?(0,x.Y)(c.DAb,{}):(0,x.Y)(pa,{})})}),(0,x.Y)(c.rId.Content,{children:(0,x.FD)(c.rId.RadioGroup,{value:s,onValueChange:e=>n(e),children:[(0,x.FD)(c.rId.RadioItem,{value:Qr.oy.FIRST_10_RUNS,children:[(0,x.Y)(c.rId.ItemIndicator,{}),(0,x.Y)(X.A,{id:"w39cZ4",defaultMessage:"Show first 10"})]}),(0,x.FD)(c.rId.RadioItem,{value:Qr.oy.FIRST_20_RUNS,children:[(0,x.Y)(c.rId.ItemIndicator,{}),(0,x.Y)(X.A,{id:"ONIiUE",defaultMessage:"Show first 20"})]}),(0,x.FD)(c.rId.RadioItem,{value:Qr.oy.SHOWALL,children:[(0,x.Y)(c.rId.ItemIndicator,{}),(0,x.Y)(X.A,{id:"4yjF8O",defaultMessage:"Show all runs"})]}),(0,x.FD)(c.rId.RadioItem,{value:Qr.oy.HIDEALL,children:[(0,x.Y)(c.rId.ItemIndicator,{}),(0,x.Y)(X.A,{id:"Qi6Etm",defaultMessage:"Hide all runs"})]})]})})]})})),ga=a.memo((e=>{const t=(0,Ie.A)();return(0,a.useEffect)((()=>{var n;const r=null===(n=e.eGridHeader)||void 0===n?void 0:n.querySelector("input");r&&(r.ariaLabel=t.formatMessage({id:"Csmj/2",defaultMessage:"Select all runs"}))}),[e.eGridHeader,t]),(0,ne.M1)()?(0,x.Y)(ma,{...e}):(0,x.FD)(c.rId.Root,{modal:!1,children:[(0,x.Y)(c.rId.Trigger,{asChild:!0,children:(0,x.Y)("button",{css:[ha.actionButton,""],"data-testid":"experiment-view-runs-visibility-column-header",children:e.allRunsHidden?(0,x.Y)(c.DAb,{}):(0,x.Y)(pa,{})})}),(0,x.FD)(c.rId.Content,{children:[(0,x.FD)(c.rId.Item,{onClick:()=>e.onToggleVisibility(Qr.oy.HIDEALL),"data-testid":"experiment-view-runs-visibility-hide-all",children:[(0,x.Y)(c.rId.IconWrapper,{children:(0,x.Y)(c.DAb,{})}),(0,x.Y)(X.A,{id:"UEESlL",defaultMessage:"Hide all runs"})]}),(0,x.FD)(c.rId.Item,{onClick:()=>e.onToggleVisibility(Qr.oy.SHOWALL),"data-testid":"experiment-view-runs-visibility-show-all",children:[(0,x.Y)(c.rId.IconWrapper,{children:(0,x.Y)(pa,{})}),(0,x.Y)(X.A,{id:"4yjF8O",defaultMessage:"Show all runs"})]})]})]})})),ha={actionButton:e=>({background:"transparent",border:"none",cursor:"pointer",padding:"8px",".ag-checkbox:not(.ag-hidden) + &":{padding:"0 1px"},svg:{width:e.general.iconFontSize,height:e.general.iconFontSize,cursor:"pointer",color:e.colors.grey500}}),showOnlyInCompareMode:{display:"none",".is-table-comparing-runs-mode &":{display:"flex"}}};var fa=n(79432),va=n(70403);var ya={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"},xa={name:"mlsake",styles:"margin-left:0;margin-right:0"};const ba=e=>{let{data:t,isComparingRuns:n}=e;const s=t.groupParentInfo,i=t.hidden;nn()(s,"groupParentInfo should be defined");const{theme:o}=(0,u.u)(),{useGroupedValuesInCharts:l}=ia(),d=(0,va.LE)(),p=(0,va.MQ)(),m=(0,Wn.e)(),g=(0,a.useCallback)(((e,t)=>{m((n=>{const{groupsExpanded:r}=n;return{...n,groupsExpanded:{...r,[e]:t}}}))}),[m]),h=(0,or.QD)(s),f=(0,a.useMemo)((()=>(0,ne.Bh)()?l&&!(0,or.mC)(s):!(0,or.mC)(s)),[s,l]);return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:o.spacing.sm,alignItems:"center"},""),children:[s.expanderOpen?(0,x.Y)(c.D3D,{role:"button",onClick:()=>{g(s.groupId,!1)}}):(0,x.Y)(c.vKP,{role:"button",onClick:()=>{g(s.groupId,!0)}}),f&&(0,x.Y)(fa.E,{color:d(s.groupId),hidden:n&&i,onChangeColor:e=>{p({groupUuid:s.groupId,colorValue:e})}}),(0,x.FD)("div",{css:(0,r.AH)({display:"inline-flex",gap:o.spacing.sm,alignItems:"center",overflow:"hidden",textOverflow:"ellipsis"},""),children:[(0,or.mC)(s)?(0,x.Y)(X.A,{id:"PKYh23",defaultMessage:"Additional runs"}):(0,x.Y)("span",{title:h,css:ya,children:(0,x.Y)(X.A,{id:"jq95vC",defaultMessage:"Group: {groupName}",values:{groupName:h}})}),(0,x.Y)(c.vwO,{css:xa,children:s.runUuids.length})]})]})};var wa={name:"xahbfd",styles:"width:12px;height:12px;flex-shrink:0"};const Ca=a.memo((e=>{const{theme:t}=(0,u.u)(),n=(0,va.MQ)(),r=(0,va.LE)(),{useGroupedValuesInCharts:a}=ia();if(e.data.groupParentInfo)return(0,x.Y)(ba,{...e});const{onExpand:s,data:i}=e,{runName:l,experimentId:d,runUuid:p,runDateAndNestInfo:m,hidden:h}=i;nn()(d,"experimentId should be set for run rows"),nn()(p,"runUuid should be set for run rows"),nn()(m,"runDateAndNestInfo should be set for run rows");const{hasExpander:f,expanderOpen:v,childrenIds:y,level:b,belongsToGroup:w}=m,C=!isNaN(b)&&f,Y=(0,ne.Bh)()?w&&a:w;return(0,x.FD)("div",{css:Ya.cellWrapper,children:[(0,x.Y)("div",{css:Ya.expanderWrapper,children:(0,x.Y)("div",{css:Ya.nestLevel(t),style:{width:(b+1)*t.spacing.lg},children:C&&(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_cells_runnamecellrenderer.tsx_46",css:Ya.expanderButton,size:"small",onClick:()=>{s(p,y)},type:"link",icon:v?(0,x.Y)(c.pgH,{}):(0,x.Y)(c.Xeq,{})},"Expander-"+p)})}),(0,x.FD)("div",{css:Ya.runLink,children:[Y?(0,x.Y)("div",{css:wa}):(0,x.Y)(fa.E,{color:r(p),hidden:(0,ne.M1)()&&e.isComparingRuns&&h,"data-testid":"experiment-view-table-run-color",onChangeColor:e=>n({runUuid:p,colorValue:e})}),(0,x.Y)(o.N_,{to:g.h.getRunPageRoute(d,p),css:Ya.runLink,tabIndex:0,children:(0,x.Y)("span",{css:Ya.runName,children:l})})]})]})})),Ya={link:e=>({display:"inline-block",minWidth:e.typography.fontSizeBase,minHeight:e.typography.fontSizeBase}),cellWrapper:{display:"flex"},expanderButton:{svg:{width:12,height:12}},runLink:{overflow:"hidden",display:"flex",gap:8,alignItems:"center","&:focus-visible":{textDecoration:"underline"}},runName:{overflow:"hidden",textOverflow:"ellipsis"},expanderWrapper:{display:"none",".ag-grid-expanders-visible &":{display:"block"}},nestLevel:e=>({display:"flex",justifyContent:"flex-end",height:e.spacing.lg})};var Sa={name:"gikiyg",styles:"display:flex;justify-content:center;align-items:center;height:32px"};const Aa=a.memo((e=>{let{loadMoreRunsFunc:t}=e;return(0,x.Y)("div",{css:Sa,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_cells_loadmorerowrenderer.tsx_20",type:"primary",onClick:t,size:"small",children:(0,x.Y)(X.A,{id:"9CqEWy",defaultMessage:"Load more"})})})}));var Ra={name:"rnnx2x",styles:"font-size:12px"},_a={name:"rnnx2x",styles:"font-size:12px"};const Ia=e=>{let{datasetWithTags:t,onDatasetSelected:n,appendComma:a=!1,inPopover:s=!1}=e;const{theme:i}=(0,u.u)(),{dataset:o,tags:l}=t;if(!o)return null;const d=null===l||void 0===l?void 0:l.find((e=>{let{key:t}=e;return t===Ct.AS}));return(0,x.FD)("div",{css:(0,r.AH)({display:"flex",flexShrink:0,alignItems:"center",overflow:"hidden",marginRight:i.spacing.xs},""),children:[(0,x.Y)(c.KbA,{css:(0,r.AH)({color:i.colors.textSecondary,marginRight:i.spacing.xs},"")})," ",(0,x.Y)("span",{css:(0,r.AH)({minWidth:32,marginRight:i.spacing.xs,flexShrink:0},""),title:`${o.name} (${o.digest})`,children:s?(0,x.Y)(J.P.Close,{asChild:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_cells_datasetscellrenderer.tsx_49",type:"link",onClick:n,tabIndex:0,children:(0,x.FD)("span",{css:Ra,children:[o.name," (",o.digest,")"]})})}):(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_cells_datasetscellrenderer.tsx_56",type:"link",onClick:n,"data-testid":"open-dataset-drawer",tabIndex:0,children:(0,x.FD)("span",{children:[o.name," (",o.digest,")"]})})}),d&&(0,x.Y)(c.vwO,{css:(0,r.AH)({textTransform:"capitalize",marginRight:i.spacing.xs},""),children:(0,x.Y)("span",{css:_a,children:d.value})}),a&&(0,x.Y)(x.FK,{children:","})]})};var Ma={name:"zjik7",styles:"display:flex"},ka={name:"eq7f8j",styles:"display:flex;align-items:flex-end"},Ea={name:"h1n7cn",styles:"max-height:400px;overflow:auto"};const Ta=a.memo((e=>{let{value:t,data:n,onDatasetSelected:s,expandRows:i}=e;const o=(0,a.useRef)(null),[l,d]=(0,a.useState)(0),[c,p]=(0,a.useState)(!1),m=(0,a.useMemo)((()=>(t||[]).slice(0,3)),[t]),{theme:g}=(0,u.u)(),h=(t||[]).length;(0,a.useEffect)((()=>{if(!o.current)return()=>{};const e=(0,V.throttle)((e=>{let[t]=e;if(i){const e=t.contentRect.height;let n=0,r=0;for(let a=0;a<t.target.children.length;a++){const s=t.target.children.item(a);if(r+s.clientHeight>e)break;r+=s.clientHeight,n++}d(n),p(n<h)}else{const e=t.contentRect.width;if(0===e&&h)return d(0),void p(!0);let n=0,r=0;for(let s=0;s<t.target.children.length;s++){const a=t.target.children.item(s);if(r+a.clientWidth>=e)break;r+=a.clientWidth,n++}const a=Math.min(h,n+1);d(a),p(n<h)}}),100),t=new ResizeObserver(e);return t.observe(o.current),()=>t.disconnect()}),[i,h]);const f=h-l;if(!t||h<1)return(0,x.Y)(x.FK,{children:"-"});const v=i?m:t;return(0,x.FD)("div",{css:Ma,children:[(0,x.Y)("div",{css:(0,r.AH)({overflow:"hidden",display:"flex",flexDirection:i?"column":"row"},""),ref:o,children:v.map(((e,t)=>(0,x.Y)(Ia,{appendComma:!i&&t<v.length-1,datasetWithTags:e,onDatasetSelected:()=>null===s||void 0===s?void 0:s(e,n)},`${e.dataset.name}-${e.dataset.digest}`)))}),(f>0||c)&&(0,x.FD)("div",{css:ka,children:[!i&&c&&(0,x.Y)("span",{css:(0,r.AH)({paddingLeft:0,paddingRight:g.spacing.xs},""),children:"\u2026"}),f>0&&(0,x.FD)(J.P.Root,{modal:!1,children:[(0,x.Y)(J.P.Trigger,{asChild:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_cells_datasetscellrenderer.tsx_172",size:"small",style:{borderRadius:"8px",width:"40px"},tabIndex:0,children:(0,x.FD)(u.T.Text,{color:"secondary",children:["+",f]})})}),(0,x.Y)(J.P.Content,{align:"start",css:Ea,children:t.slice(h-f).map((e=>(0,x.Y)("div",{css:(0,r.AH)({height:g.general.heightSm,display:"flex",alignItems:"center"},""),children:(0,x.Y)(Ia,{datasetWithTags:e,onDatasetSelected:()=>null===s||void 0===s?void 0:s(e,n),inPopover:!0})},`${e.dataset.name}-${e.dataset.digest}`)))})]})]})]})})),Da=e=>{let{event:t}=e;return"Tab"===t.key&&t.target instanceof HTMLElement&&(t.target.classList.contains("ag-cell")||t.target instanceof HTMLButtonElement)},Fa=e=>{var t;let{value:n,data:a}=e;const{theme:s}=(0,u.u)();return null!==(t=a.groupParentInfo)&&void 0!==t&&t.aggregateFunction?(0,x.FD)(u.T.Text,{children:[n," ",(0,x.FD)("span",{css:(0,r.AH)({color:s.colors.textSecondary},""),children:["(",a.groupParentInfo.aggregateFunction,")"]})]}):n};var La=n(53606);const Pa=e=>{var t;let{colDef:n,context:r}=e;return r.orderByKey===(null===(t=n.headerComponentParams)||void 0===t?void 0:t.canonicalSortKey)},Ba=e=>(0,ne.M1)()?e?105:73:105,Na=e=>`${It.iy}-${e}`,Ha=e=>`${It.tZ}-${e}`,Oa=e=>`${It.Pl}-${e}`,Ua=e=>{let{loading:t,...n}=e;return(0,u.S)({loading:!1,...n})},Ka=e=>{let{event:t}=e;return"Tab"===t.key&&t.target instanceof HTMLElement&&t.target.classList.contains("ag-cell")},za={[Ct.T8.USER]:(0,It.GF)(Ct.RO.ATTRIBUTES,"User"),[Ct.T8.RUN_NAME]:(0,It.GF)(Ct.RO.ATTRIBUTES,"Run Name"),[Ct.T8.SOURCE]:(0,It.GF)(Ct.RO.ATTRIBUTES,"Source"),[Ct.T8.VERSION]:(0,It.GF)(Ct.RO.ATTRIBUTES,"Version"),[Ct.T8.DESCRIPTION]:(0,It.GF)(Ct.RO.ATTRIBUTES,"Description")},Va=e=>{let{data:t}=e;return t.rowUuid},Ga=e=>{let{rowNode:t}=e;return t.data.isLoadMoreRow},qa=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=[Ct.qo.USER,Ct.qo.SOURCE,Ct.qo.VERSION,Ct.qo.MODELS,Ct.qo.DATASET,Ct.qo.DESCRIPTION];return e&&t.push(Ct.qo.EXPERIMENT_NAME),t},$a=e=>{let{selectedColumns:t,compareExperiments:n,onTogglePin:r,onToggleVisibility:s,onExpand:i,paramKeyList:o,metricKeyList:l,tagKeyList:d,columnApi:c,onDatasetSelected:p,isComparingRuns:m,expandRows:g,allRunsHidden:h,runsHiddenMode:f}=e;const{theme:v}=(0,u.u)(),y=(e=>{let{paramKeyList:t,metricKeyList:n,tagKeyList:r}=e;const s=(0,a.useRef)(new Set),i=(0,a.useRef)(new Set),o=(0,a.useRef)(new Set),l=(0,a.useMemo)((()=>(t.forEach((e=>i.current.add(e))),Array.from(i.current))),[t]),d=(0,a.useMemo)((()=>(n.forEach((e=>s.current.add(e))),Array.from(s.current))),[n]),c=(0,a.useMemo)((()=>(r.forEach((e=>o.current.add(e))),Array.from(o.current))),[r]);return(0,a.useMemo)((()=>({paramKeys:l,metricKeys:d,tagKeys:c})),[d,l,c])})({metricKeyList:l,tagKeyList:d,paramKeyList:o}),x=(0,La.U)(`(max-width: ${v.responsive.breakpoints.sm}px)`),b=(0,a.useMemo)((()=>{const e=[];e.push({valueGetter:e=>{let{data:{pinned:t,hidden:n}}=e;return{pinned:t,hidden:n}},checkboxSelection:!0,headerComponent:"RowActionsHeaderCellRenderer",headerComponentParams:{onToggleVisibility:s,allRunsHidden:h},headerCheckboxSelection:!0,headerName:"",cellClass:"is-checkbox-cell",cellRenderer:"RowActionsCellRenderer",cellRendererParams:{onTogglePin:r,onToggleVisibility:s},pinned:x?void 0:"left",minWidth:Ba(m),width:Ba(m),maxWidth:Ba(m),resizable:!1,suppressKeyboardEvent:ca});const t=m&&(0,ne.Zt)();if(e.push({headerName:Ct.qo.RUN_NAME,colId:t?void 0:za[Ct.T8.RUN_NAME],headerTooltip:Ct.T8.RUN_NAME,pinned:x?void 0:"left",sortable:!0,cellRenderer:"RunNameCellRenderer",cellRendererParams:{onExpand:i,isComparingRuns:m},equals:(e,t)=>{var n,r;return(null===e||void 0===e?void 0:e.rowUuid)===(null===t||void 0===t?void 0:t.rowUuid)&&(null===e||void 0===e||null===(n=e.groupParentInfo)||void 0===n?void 0:n.expanderOpen)===(null===t||void 0===t||null===(r=t.groupParentInfo)||void 0===r?void 0:r.expanderOpen)},headerComponentParams:{canonicalSortKey:Ct.T8.RUN_NAME},cellClassRules:{"is-ordered-by":Pa},initialWidth:t?void 0:190,flex:t?1:void 0,resizable:!m,suppressKeyboardEvent:Ka}),m)return e;e.push({headerName:Ct.qo.DATE,headerTooltip:Ct.T8.DATE,pinned:x?void 0:"left",sortable:!0,field:"runDateAndNestInfo",cellRenderer:"DateCellRenderer",cellRendererParams:{onExpand:i},equals:(e,t)=>(0,V.isEqual)(e,t),headerComponentParams:{canonicalSortKey:Ct.T8.DATE},cellClassRules:{"is-ordered-by":Pa},initialWidth:150}),e.push({headerName:Ct.qo.DATASET,colId:(0,It.GF)(Ct.RO.ATTRIBUTES,Ct.qo.DATASET),headerTooltip:Ct.qo.DATASET,sortable:!1,field:"datasets",cellRenderer:"DatasetsCellRenderer",cellRendererParams:{onDatasetSelected:p,expandRows:g},cellClass:"is-multiline-cell",initialWidth:300,suppressKeyboardEvent:Da}),e.push({headerName:Ct.qo.DURATION,field:"duration",initialWidth:80}),n&&e.push({headerName:Ct.qo.EXPERIMENT_NAME,colId:(0,It.GF)(Ct.RO.ATTRIBUTES,Ct.qo.EXPERIMENT_NAME),field:"experimentName",cellRenderer:"ExperimentNameCellRenderer",equals:(e,t)=>(0,V.isEqual)(e,t),initialWidth:140,initialHide:!0,suppressKeyboardEvent:Ka}),e.push({headerName:Ct.qo.USER,colId:za[Ct.T8.USER],headerTooltip:Ct.T8.USER,field:"user",sortable:!0,headerComponentParams:{canonicalSortKey:Ct.T8.USER},cellClassRules:{"is-ordered-by":Pa},initialHide:!0}),e.push({headerName:Ct.qo.SOURCE,colId:za[Ct.T8.SOURCE],field:"tags",cellRenderer:"SourceCellRenderer",equals:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E.A.getSourceName(e)===E.A.getSourceName(t)},sortable:!0,headerComponentParams:{canonicalSortKey:Ct.T8.SOURCE},cellClassRules:{"is-ordered-by":Pa},initialHide:!0,suppressKeyboardEvent:Ka}),e.push({headerName:Ct.qo.VERSION,colId:za[Ct.T8.VERSION],field:"version",cellRenderer:"VersionCellRenderer",equals:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,V.isEqual)(e,t)},sortable:!0,headerComponentParams:{canonicalSortKey:Ct.T8.VERSION},cellClassRules:{"is-ordered-by":Pa},initialHide:!0}),e.push({headerName:Ct.qo.MODELS,colId:(0,It.GF)(Ct.RO.ATTRIBUTES,Ct.qo.MODELS),field:"models",cellRenderer:"ModelsCellRenderer",initialWidth:200,equals:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,V.isEqual)(e,t)},initialHide:!0,suppressKeyboardEvent:Ka}),e.push({headerName:Ct.qo.DESCRIPTION,colId:za[Ct.T8.DESCRIPTION],field:"tags",cellRenderer:"RunDescriptionCellRenderer",initialWidth:300,initialHide:!0,sortable:!0,headerComponentParams:{canonicalSortKey:Ct.T8.DESCRIPTION},cellClassRules:{"is-ordered-by":Pa}});const{metricKeys:a,paramKeys:o,tagKeys:l}=y;return a.length&&e.push({headerName:"Metrics",groupId:Ct.RO.METRICS,children:a.map((e=>{const t=(0,It.GF)(Ct.RO.METRICS,e);return{headerName:e,colId:t,headerTooltip:(0,It.$e)(Ct.RO.METRICS,e),field:Ha(e),tooltipField:Ha(e),initialWidth:100,initialHide:!0,sortable:!0,headerComponentParams:{canonicalSortKey:t},cellRendererSelector:e=>{let{data:{groupParentInfo:t}}=e;return t?{component:"AggregateMetricValueCell"}:void 0},cellClassRules:{"is-previewable-cell":()=>!0,"is-ordered-by":Pa}}}))}),o.length&&e.push({headerName:"Parameters",groupId:Ct.RO.PARAMS,children:o.map((e=>{const t=(0,It.GF)(Ct.RO.PARAMS,e);return{colId:t,headerName:e,headerTooltip:(0,It.$e)(Ct.RO.PARAMS,e),field:Na(e),tooltipField:Na(e),initialHide:!0,initialWidth:100,sortable:!0,headerComponentParams:{canonicalSortKey:t},cellClassRules:{"is-previewable-cell":()=>!0,"is-ordered-by":Pa}}}))}),l.length&&e.push({headerName:"Tags",colId:Ct.RO.TAGS,children:l.map((e=>({colId:(0,It.GF)(Ct.RO.TAGS,e),headerName:e,initialHide:!0,initialWidth:100,headerTooltip:(0,It.$e)(Ct.RO.TAGS,e),field:Oa(e),tooltipField:Oa(e)})))}),e}),[r,s,i,n,y,m,p,g,h,x]),w=(0,a.useMemo)((()=>[...qa(!0).map((e=>(0,It.GF)(Ct.RO.ATTRIBUTES,e))),...y.paramKeys.map((e=>(0,It.GF)(Ct.RO.PARAMS,e))),...y.metricKeys.map((e=>(0,It.GF)(Ct.RO.METRICS,e))),...y.tagKeys.map((e=>(0,It.GF)(Ct.RO.TAGS,e)))]),[y]);return(0,a.useEffect)((()=>{if(c&&!m)for(const e of w){const n=t.includes(e);c.setColumnVisible(e,n)}}),[t,c,w,m]),b},Wa={initialWidth:100,autoSizePadding:0,headerComponentParams:{menuIcon:"fa-bars"},resizable:!0,filter:!0,suppressMenu:!0,suppressMovable:!0},ja=e=>{let{isFiltered:t,onClearFilters:n}=e;return(0,x.Y)("div",{css:Qa.noResultsWrapper,children:(0,x.Y)("div",{css:Qa.noResults,children:t?(0,x.Y)(c.SvL,{button:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsemptytable.tsx_35",type:"primary",onClick:n,children:(0,x.Y)(X.A,{id:"pEpexK",defaultMessage:"Clear filters"})}),description:(0,x.Y)(X.A,{id:"Nnsm0p",defaultMessage:"All runs in this experiment have been filtered. Change or clear filters to view runs."}),title:(0,x.Y)(X.A,{id:"Tl63jz",defaultMessage:"All runs are filtered"}),image:(0,x.Y)(c.YGH,{})}):(0,x.Y)(c.SvL,{description:(0,x.Y)(X.A,{id:"coo35p",defaultMessage:"No runs have been logged yet. <link>Learn more</link> about how to create ML model training runs in this experiment.",values:{link:e=>(0,x.Y)("a",{target:"_blank",href:$.XO,rel:"noreferrer",children:e})}}),title:(0,x.Y)(X.A,{id:"sByLVU",defaultMessage:"No runs logged"}),image:(0,x.Y)(c.cuA,{})})})})},Qa={noResults:{maxWidth:360},noResultsWrapper:e=>({marginTop:e.spacing.lg,inset:0,backgroundColor:e.colors.backgroundPrimary,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"})},Ja=e=>{let{updateRunListHidden:t,runListHidden:n}=e;const{theme:a}=(0,u.u)();return(0,x.FD)("div",{css:(0,r.AH)({position:"absolute",top:0,bottom:0,width:2*a.spacing.md,right:-a.spacing.md,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent","&:hover":{opacity:1,".bar":{opacity:1},".button":{border:`2px solid ${a.colors.primary}`}},opacity:n?1:0,transition:"opacity 0.2s"},""),children:[(0,x.Y)("div",{className:"bar",css:(0,r.AH)({transition:"opacity 0.2s",opacity:0,position:"absolute",left:a.spacing.md-2,top:0,backgroundColor:a.colors.primary,bottom:0,width:3,pointerEvents:"none"},"")}),(0,x.Y)("div",{className:"button",css:(0,r.AH)({transition:"border-color 0.2s",position:"relative",width:a.general.iconSize,height:a.general.iconSize,backgroundColor:a.colors.backgroundPrimary,borderRadius:a.general.iconSize,overflow:"hidden",border:`1px solid ${a.colors.border}`,display:"flex",alignItems:"center",justifyContent:"center"},""),children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunstablecollapse.tsx_70",onClick:()=>t(!n),icon:n?(0,x.Y)(c.vKP,{}):(0,x.Y)(c.YJP,{}),size:"small"})})]})},Xa="is-out-of-viewport",Za="is-hidden",es="is-minimized",ts=".ag-root",ns=".ag-pinned-left-cols-container",rs=".ag-center-cols-container",as=".ag-header",ss=".ag-body-viewport",is=e=>{let{onClick:t,gridContainerElement:n,isInitialized:r,visible:s,moreRunsAvailable:i,moreAvailableRunsTableColumnCount:o=0}=e;const l=(0,a.useRef)(null),d=(0,a.useRef)(),p=(0,a.useRef)(Boolean(i));(0,a.useEffect)((()=>{p.current=Boolean(i)}),[i]);const m=(0,a.useCallback)((e=>{if(!l.current||!window.ResizeObserver||!e)return;const t=l.current,n=e.querySelector(ts),r=e.querySelector(ns),a=e.querySelector(rs),s=e.querySelector(as),i=e.querySelector(ss);let o=0,c=0,u=0,m=0,g=0,h=0;if(r&&a&&s&&n&&i){const e=new ResizeObserver((e=>{var l,f,v,y;for(const t of e)t.target===n&&(o=t.contentRect.width),t.target===r&&(c=t.contentRect.width,u=t.contentRect.height),t.target===i&&(g=t.contentRect.height),t.target===s&&(h=t.contentRect.height),t.target===a&&(m=t.contentRect.width);const x=c+m,b=h;x+180>=o?null===(l=d.current)||void 0===l||l.classList.add(Xa):null===(f=d.current)||void 0===f||f.classList.remove(Xa);const w=p.current?32:0,C=u<g?u-w:g;C<100?null===(v=d.current)||void 0===v||v.classList.add(es):null===(y=d.current)||void 0===y||y.classList.remove(es),t.style.transform=`translate3d(${x}px, ${b}px, 0)`,t.style.height=`${C+1}px`}));return e.observe(r),e.observe(a),e.observe(s),e.observe(n),e.observe(i),()=>e.disconnect()}}),[]);return(0,a.useEffect)((()=>{r&&n&&(d.current=n,m(n))}),[m,r,n]),window.ResizeObserver?(0,x.Y)("div",{ref:l,css:os.columnContainer,className:s?"":Za,children:s&&(0,x.Y)("div",{css:os.buttonContainer,children:(0,x.FD)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunstableaddcolumncta.tsx_218",css:os.button,type:"link",onClick:t,children:[(0,x.Y)(c.GYj,{css:os.buttonIcon}),(0,x.Y)("div",{css:os.caption,children:(0,x.Y)(X.A,{id:"npHb2a",defaultMessage:"Show more columns {count, select, 0 {} other {({count} total)}}",values:{count:o}})})]})})}):null},os={columnContainer:e=>({width:180,height:0,position:"absolute",border:`1px solid ${e.colors.borderDecorative}`,borderTop:0,top:0,left:0,willChange:"transform",transform:"translate3d(0, 0, 0)",[`.${es} &`]:{display:"flex",alignItems:"center"},[`&.${Za}, .${Xa} &`]:{display:"none"},pointerEvents:"none",display:"flex",alignItems:"center"}),buttonContainer:e=>({top:0,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg,width:"100%",[`.${es} &`]:{paddingTop:e.spacing.xs},pointerEvents:"all"}),button:{whiteSpace:"pre-wrap",width:"100%"},buttonIcon:e=>({color:e.colors.textSecondary}),caption:e=>({color:e.colors.textSecondary,[`.${es} &`]:{display:"none"}})},ls=e=>(0,x.Y)("strong",{children:e}),ds=e=>{let{isLoading:t,allRunsCount:n}=e;return(0,x.FD)("div",{css:cs.statusBar,children:[(0,x.Y)(u.T.Text,{size:"sm",color:t?"secondary":void 0,children:(0,x.Y)(X.A,{id:"gLj8lU",defaultMessage:"<strong>{length}</strong> matching {length, plural, =0 {runs} =1 {run} other {runs}}",values:{strong:ls,length:n}})}),t&&(0,x.Y)(u.S,{size:"small"})]})},cs={statusBar:e=>({height:28,display:"flex",gap:8,marginTop:-1,position:"relative",alignItems:"center",borderTop:`1px solid ${e.colors.border}`})};var us={name:"4fhn5u",styles:"white-space:pre-wrap;overflow-y:auto;flex:1"};const ps=e=>{let{content:t,copyText:n,headerText:a,empty:s,onClose:i}=e;const{theme:o}=(0,u.u)();return(0,x.Y)("div",{css:(0,r.AH)({width:300,padding:o.spacing.sm,paddingRight:0,borderLeft:`1px solid ${o.colors.borderDecorative}`,overflow:"hidden",display:"flex",flexDirection:"column",height:"100%"},""),"data-testid":"preview-sidebar-content",children:t?(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:(0,r.AH)({display:"grid",gridTemplateColumns:"1fr auto auto",rowGap:o.spacing.sm,alignItems:"flex-start",flex:"0 0 auto"},""),children:[a&&(0,x.Y)(u.T.Title,{level:4,css:(0,r.AH)({overflowX:"hidden",overflowY:"auto",marginTop:o.spacing.sm,marginRight:o.spacing.xs,maxHeight:200},""),children:a}),n&&(0,x.Y)(vt.i,{copyText:n,showLabel:!1,icon:(0,x.Y)(c.TdU,{})}),i&&(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_common_components_previewsidebar.tsx_67",type:"primary",icon:(0,x.Y)(u.C,{}),onClick:i})]}),(0,x.Y)("div",{css:us,children:t})]}):(0,x.Y)("div",{css:(0,r.AH)({marginTop:o.spacing.md},""),children:s})})},ms=(e,t,n)=>{n.forEachNode((n=>{var r;if(null!==(r=n.data)&&void 0!==r&&r.isLoadMoreRow)return;const{runInfo:a,runDateAndNestInfo:s}=n.data;if(!a)return;const i=a.runUuid;e.includes(i)&&(null!==s&&void 0!==s&&s.childrenIds&&e.push(...s.childrenIds),n.setSelected(t,!1,!0))}))},gs=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=(0,Wn.e)(),r=(0,a.useRef)(e);r.current=e;const s=(0,a.useCallback)(((e,a)=>{n((n=>{if(e===Qr.oy.SHOWALL)return{...n,runsHiddenMode:Qr.oy.SHOWALL,runsHidden:[]};if(e===Qr.oy.HIDEALL)return{...n,runsHiddenMode:Qr.oy.HIDEALL,runsHidden:[]};if(e===Qr.oy.FIRST_10_RUNS)return{...n,runsHiddenMode:Qr.oy.FIRST_10_RUNS,runsHidden:[]};if(e===Qr.oy.FIRST_20_RUNS)return{...n,runsHiddenMode:Qr.oy.FIRST_20_RUNS,runsHidden:[]};if(a){var s;const e=r.current.filter((e=>{let{hidden:t}=e;return t})).map((e=>{let{groupParentInfo:t,rowUuid:n,runUuid:r}=e;return t?n:r})),i=null===(s=r.current.find((e=>{let{rowUuid:t,groupParentInfo:n}=e;return t===a&&n})))||void 0===s?void 0:s.groupParentInfo;if(i&&(0,ne.Bh)()&&!1===t){let t=[];return t=i.allRunsHidden?e.filter((e=>!i.runUuids.includes(e))):e.concat(i.runUuids.filter((t=>!e.includes(t)))),{...n,runsHiddenMode:Qr.oy.CUSTOM,runsHidden:t}}const o=e.includes(a)?e.filter((e=>e!==a)):[...e,a];return{...n,runsHiddenMode:Qr.oy.CUSTOM,runsHidden:o}}return n}))}),[n,t]);return s};var hs={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const fs=a.memo((e=>{let{experiments:t,searchFacetsState:n,runsData:r,isLoading:s,moreRunsAvailable:i,updateViewState:o,onAddColumnClicked:l,rowsData:d,loadMoreRunsFunc:p,onDatasetSelected:m,expandRows:g,viewState:h,uiState:f,compareRunsMode:v}=e;const{theme:y}=(0,u.u)(),b=(0,Wn.e)(),w=$n(),{orderByKey:C,orderByAsc:Y}=n,{selectedColumns:S,runsPinned:A,runsHidden:R,runListHidden:_}=f,I=(0,a.useCallback)((e=>{b((t=>({...t,runListHidden:e})))}),[b]),M="TABLE"!==v,{paramKeyList:k,metricKeyList:T,tagsList:D}=r,[F,L]=(0,a.useState)(),[P,B]=(0,a.useState)(),N=((0,a.useRef)([]),(0,a.useMemo)((()=>E.A.getVisibleTagKeyList(D)),[D])),H=(0,a.useRef)(null),O=(0,a.useMemo)((()=>d.some((e=>{var t;return null===(t=e.runDateAndNestInfo)||void 0===t?void 0:t.hasExpander}))),[d]),U=(0,a.useCallback)((e=>b((t=>{let{runsExpanded:n,...r}=t;return{...r,runsExpanded:{...n,[e]:!n[e]}}}))),[b]),K=(0,a.useCallback)((e=>{b((t=>({...t,runsPinned:t.runsPinned.includes(e)?t.runsPinned.filter((t=>t!==e)):[...t.runsPinned,e]})))}),[b]),z=gs(d,f.useGroupedValuesInCharts),G=(0,a.useCallback)((e=>{b((t=>{if(e===Qr.oy.SHOWALL)return{...t,runsHidden:[]};if(e===Qr.oy.HIDEALL)return{...t,runsHidden:r.runInfos.map((e=>{let{runUuid:t}=e;return t}))};const n=e;return{...t,runsHidden:t.runsHidden.includes(n)?t.runsHidden.filter((e=>e!==n)):[...t.runsHidden,n]}}))}),[b,r]),q=(0,ne.M1)()?z:G,$=(0,a.useCallback)((e=>{L(e.api),B(e.columnApi)}),[]),{handleRowSelected:W,onSelectionChange:j}=(e=>{const t=(0,a.useCallback)((t=>{let{api:n}=t;const r=n.getSelectedRows().filter((e=>e.runInfo)).map((e=>{let{runInfo:t}=e;return t.runUuid}));e({runsSelected:r.reduce(((e,t)=>({...e,[t]:!0})),{})})}),[e]);return{handleRowSelected:(0,a.useCallback)((e=>{const t=Boolean(e.node.isSelected()),{runDateAndNestInfo:n,runInfo:r,groupParentInfo:a}=e.data;if(a&&ms(a.runUuids,t,e.api),!n)return;const{isParent:s,expanderOpen:i,childrenIds:o}=n;if(s&&i&&o)ms(o,t,e.api);else if(r){ms([r.runUuid],t,e.api);const n=(0,V.uniqBy)(e.api.getSelectedRows().filter((e=>Boolean(e.runUuid))),"runUuid");l=n,e.api.forEachNode((e=>{const t=e.data;t.groupParentInfo&&(t.groupParentInfo.runUuids.every((e=>l.some((t=>t.runUuid===e))))&&e.setSelected(!0,!1,!0),t.groupParentInfo.runUuids.some((e=>l.some((t=>t.runUuid===e))))||e.setSelected(!1,!1,!0))}))}var l}),[]),onSelectionChange:t}})(o),Q=r.runInfos.every((e=>{let{runUuid:t}=e;return R.includes(t)})),J=$a({selectedColumns:S,onExpand:U,compareExperiments:t.length>1,onTogglePin:K,onToggleVisibility:q,metricKeyList:T,paramKeyList:k,tagKeyList:N,columnApi:P,isComparingRuns:M,onDatasetSelected:m,expandRows:g,allRunsHidden:Q,runsHiddenMode:f.runsHiddenMode}),Z=(0,a.useCallback)((e=>{(0,ne.Zt)()&&e&&M&&e.sizeColumnsToFit()}),[M]);(0,a.useEffect)((()=>{if(F)if(s)F.showLoadingOverlay();else{if(F.hideOverlay(),d.length&&i)return F.setRowData([...d,{runUuid:"",rowUuid:(0,V.uniqueId)("load_more"),isLoadMoreRow:!0}]),void Z(F);F.setRowData(d),Z(F)}}),[F,d,s,i,p,Z]);const ee=(0,a.useMemo)((()=>qa(t.length>1).length+(T.length+k.length+N.length)),[t.length,N.length,T.length,k.length]),te=S.length>=ee,re=Math.max(0,ee-S.length),ae=(0,a.useMemo)((()=>r.runInfos.filter((e=>A.includes(e.runUuid)||r.runUuidsMatchingFilter.includes(e.runUuid))).length),[r,A]);(0,a.useLayoutEffect)((()=>{F&&(M&&(F.deselectAll(),F.sizeColumnsToFit()),F.resetRowHeights())}),[F,M]);const se=(0,a.useCallback)((e=>{if(M||!g)return It.Fc;const t=(0,It.GF)(Ct.RO.ATTRIBUTES,Ct.qo.DATASET);return((e,t)=>{if(e){var n;const{data:e}=t,r=Math.min((null===(n=e.datasets)||void 0===n?void 0:n.length)||1,3);return It.Fc*r}return It.Fc})(S.includes(t),e)}),[S,M,g]);(0,a.useEffect)((()=>{null===F||void 0===F||F.resetRowHeights()}),[F,S,g]);const[ie,oe]=(0,a.useState)(null),le=(0,a.useCallback)((e=>{var t;let{column:n,data:r,value:a}=e;const s=null===(t=n.getParent())||void 0===t?void 0:t.getGroupId();(s===Ct.RO.METRICS||s===Ct.RO.PARAMS)&&(oe({value:a,header:`Run name: ${r.runName}, Column name: ${n.getColId()}`}),o({previewPaneVisible:!0}))}),[o]),de=!te&&!M&&d.length>0,ce=!M&&h.previewPaneVisible,ue=!_||!M,pe=!_,me=M&&!(0,ne.Zt)(),ge=d.length<1&&!s&&!_,he=(0,a.useMemo)((()=>({orderByAsc:Y,orderByKey:C})),[Y,C]);return(0,x.FD)("div",{css:e=>({display:"grid",flex:1,gridTemplateColumns:ce?"1fr auto":"1fr",borderTop:`1px solid ${e.colors.border}`}),className:M&&(0,ne.M1)()?"is-table-comparing-runs-mode":void 0,children:[(0,x.FD)("div",{css:hs,children:[(0,x.FD)("div",{ref:H,className:Cr()("ag-theme-balham ag-grid-sticky",{"ag-grid-expanders-visible":O,"is-table-comparing-runs-mode":M&&(0,ne.M1)()}),css:[vs.agGridOverrides(y),{display:ue?"block":"hidden",height:"100%"},""],"aria-hidden":!ue,children:[(0,x.Y)(sa,{runsHiddenMode:f.runsHiddenMode,useGroupedValuesInCharts:Boolean(f.groupBy)&&f.useGroupedValuesInCharts,children:(0,x.Y)(Sr,{context:he,defaultColDef:Wa,columnDefs:J,rowSelection:"multiple",onGridReady:$,onSelectionChanged:j,getRowHeight:se,headerHeight:It.Fc,onRowSelected:W,suppressRowClickSelection:!0,suppressColumnMoveAnimation:!0,suppressScrollOnNewData:!0,isFullWidthRow:Ga,fullWidthCellRenderer:"LoadMoreRowRenderer",fullWidthCellRendererParams:{loadMoreRunsFunc:p},suppressFieldDotNotation:!0,enableCellTextSelection:!0,components:{agColumnHeader:kr,loadingOverlayComponent:Ua,LoadMoreRowRenderer:Aa,SourceCellRenderer:Ve,ModelsCellRenderer:qr,VersionCellRenderer:$r,DateCellRenderer:Tr,ExperimentNameCellRenderer:Br,RunDescriptionCellRenderer:Pr,RowActionsCellRenderer:da,RowActionsHeaderCellRenderer:ga,RunNameCellRenderer:Ca,DatasetsCellRenderer:Ta,AggregateMetricValueCell:Fa},suppressNoRowsOverlay:!0,loadingOverlayComponent:"loadingOverlayComponent",loadingOverlayComponentParams:{showImmediately:!0},getRowId:Va,rowBuffer:101,onCellClicked:le,onGridSizeChanged:e=>{let{api:t}=e;return Z(t)}})}),de&&(0,x.Y)(is,{gridContainerElement:H.current,isInitialized:Boolean(F),onClick:l,visible:!s,moreRunsAvailable:i,moreAvailableRunsTableColumnCount:re})]}),ge&&(0,x.Y)(ja,{onClearFilters:()=>{w(Kn())},isFiltered:Mr(n)}),pe&&(0,x.Y)(ds,{allRunsCount:ae,isLoading:s}),me&&(0,x.Y)(Ja,{runListHidden:_,updateRunListHidden:I})]}),ce&&(0,x.Y)(ps,{content:null===ie||void 0===ie?void 0:ie.value,copyText:null===ie||void 0===ie?void 0:ie.value,headerText:null===ie||void 0===ie?void 0:ie.header,onClose:()=>o({previewPaneVisible:!1}),empty:(0,x.Y)(c.SvL,{description:(0,x.Y)(X.A,{id:"cAKSkQ",defaultMessage:"Select a cell to display preview"})})})]})})),vs={agGridOverrides:e=>{const t=(e=>({rowForeground:e.colors.textPrimary,rowBackground:e.colors.backgroundPrimary,rowBackgroundHover:`${e.colors.backgroundSecondary}0A`,rowBackgroundSelected:`${e.colors.backgroundSecondary}14`,rowBackgroundHoverSelected:`${e.colors.backgroundSecondary}1F`,columnSortedBy:`${e.colors.blue400}1F`,headerBackground:e.colors.backgroundSecondary,headerTextColor:e.colors.textSecondary,headerGroupTextColor:e.colors.textSecondary,borderColor:e.colors.borderDecorative,headerBorderColor:"transparent",checkboxBorderColor:e.colors.actionDefaultBorderDefault,checkboxBorderColorChecked:e.colors.backgroundPrimary,checkboxBackgroundColorChecked:e.colors.actionPrimaryBackgroundDefault,overlayBackground:`${e.colors.backgroundSecondary}99`}))(e);return{height:"100%",position:"relative","&.ag-theme-balham":{"--ag-border-color":t.borderColor,"--ag-row-border-color":t.borderColor,"--ag-foreground-color":t.rowForeground,"--ag-background-color":t.rowBackground,"--ag-odd-row-background-color":t.rowBackground,"--ag-row-hover-color":t.rowBackgroundHover,"--ag-selected-row-background-color":t.rowBackgroundSelected,"--ag-header-foreground-color":t.headerTextColor,"--ag-header-background-color":t.headerBackground,"--ag-modal-overlay-background-color":t.overlayBackground,"&.ag-grid-sticky .ag-header":{position:"sticky",top:0,zIndex:1},"&.ag-grid-sticky .ag-root":{overflow:"visible"},"&.ag-grid-sticky .ag-root-wrapper":{border:"0",borderRadius:"4px",overflow:"visible"},".ag-header::after":{content:'""',position:"absolute",top:It.Fc,left:0,right:0,height:1,backgroundColor:t.borderColor},".ag-cell":{display:"flex",overflow:"hidden","& > .ag-cell-wrapper":{overflow:"hidden"}},".ag-header-cell":{padding:0},".ag-header-cell .ag-checkbox":{padding:"0 7px",borderLeft:"1px solid transparent"},".ag-cell.is-ordered-by, .ag-header-cell > .is-ordered-by":{backgroundColor:t.columnSortedBy},".ag-header-row":{"--ag-border-color":t.headerBorderColor},".ag-header-row.ag-header-row-column-group":{"--ag-header-foreground-color":t.headerGroupTextColor},".ag-row.ag-row-selected.ag-row-hover":{backgroundColor:t.rowBackgroundHoverSelected},".ag-header:not(:hover) .ag-header-cell::after, .ag-header:not(:hover) .ag-header-group-cell::after":{opacity:0},".ag-pinned-left-header":{borderRight:"none"},".ag-overlay-loading-wrapper":{paddingTop:4*e.spacing.md,alignItems:"center",zIndex:2},".ag-overlay-loading-wrapper .ag-react-container":{flex:1},".ag-center-cols-container":{minHeight:0},".ag-full-width-row":{borderBottom:0,backgroundColor:"transparent",zIndex:1,"&.ag-row-hover":{backgroundColor:"transparent"}},".is-checkbox-cell":{display:"flex",alignItems:"center",paddingLeft:7,".is-multiline-cell .ag-cell-value":{height:"100%"}},".is-previewable-cell":{cursor:"pointer"},".ag-header-cell .ag-checkbox .ag-input-wrapper:not(.ag-indeterminate):not(.ag-checked)":{"--ag-checkbox-background-color":t.headerBackground},".ag-cell-wrapper .ag-selection-checkbox":{marginRight:20},".is-checkbox-cell, .ag-header-cell .ag-checkbox":{".ag-checkbox-input-wrapper::after":{color:t.checkboxBorderColor},".ag-checkbox-input-wrapper.ag-checked":{"--ag-checkbox-background-color":t.checkboxBackgroundColorChecked,"--ag-checkbox-checked-color":t.checkboxBorderColorChecked,"&::after":{color:t.checkboxBorderColorChecked}}}}}}};class ys{constructor(){this.runsSelected={},this.hiddenChildRunsSelected={},this.columnSelectorVisible=!1,this.previewPaneVisible=!1,this.artifactViewState={selectedTables:[],groupByCols:[],outputColumn:"",intersectingOnly:!1}}}var xs=n(57368);const bs="FETCHED_RUN_NOTIFICATION_KEY",ws=e=>{const{formatMessage:t}=(0,Ie.A)(),n=(0,a.useCallback)(((e,n)=>e===n?t({id:"KJbYrw",defaultMessage:"Loaded {childRuns} child {childRuns, plural, =1 {run} other {runs}}"},{childRuns:n}):t({id:"ziIhFQ",defaultMessage:"Loaded {allRuns} {allRuns, plural, =1 {run} other {runs}}, including {childRuns} child {childRuns, plural, =1 {run} other {runs}}"},{allRuns:e,childRuns:n})),[t]);return(0,a.useCallback)(((t,r)=>{if(Array.isArray(t)){const{allRuns:a,childRuns:s}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=e.filter((e=>!t.some((t=>t.runUuid===e.info.runUuid)))),r=n.filter((e=>{var t;const n=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.tags;return Array.isArray(n)&&n.some((e=>e.key===It.Ol&&Boolean(e.value)))}));return{allRuns:n.length,childRuns:r.length}}(t,r);if(s<1)return;e.close(bs),e.info({message:n(a,s),duration:3,placement:"bottomRight",key:bs})}}),[e,n])};var Cs=n(85343);const Ys=a.createContext({getMissingParams:()=>[],pendingDataLoading:{},getEvaluableRowCount:()=>0,evaluateCell:()=>{},evaluateAllClick:()=>{},runColumnsBeingEvaluated:[],canEvaluateInRunColumn:()=>!1,toggleExpandedHeader:()=>{},isHeaderExpanded:!1}),Ss=e=>{let{tableData:t,outputColumn:n,children:r}=e;const i=(0,Ie.A)(),[o,l]=(0,a.useState)(!1),d=(0,a.useCallback)((()=>l((e=>!e))),[]),c=(0,a.useCallback)(((e,n)=>{if(!(0,dn.o1)(e))return null;const r=t.find((e=>e.key===n));if(!r)return null;const{promptTemplate:a}=(0,dn.vC)(e);if(!a)return null;return(0,dn.rl)(a).filter((e=>!r.groupByCellValues[e]))}),[t]),u=(0,s.wA)(),{startEvaluatingRunColumn:p,stopEvaluatingRunColumn:m,runColumnsBeingEvaluated:g}=((e,t)=>{const n=(0,a.useRef)(e),r=(0,a.useRef)([]),i=(0,Ie.A)();(0,a.useEffect)((()=>{n.current=e}),[e]);const[o,l]=(0,a.useState)([]);(0,a.useEffect)((()=>{r.current=o}),[o]);const d=(0,s.wA)(),c=(0,a.useCallback)((e=>{const a=n.current,{parameters:s,promptTemplate:o,routeName:u,routeType:p}=(0,dn.vC)(e);if(!o)return;const m=(0,dn.rl)(o),g=a.find((t=>!t.cellValues[e.runUuid]&&((e,t)=>0===t.filter((t=>!e.groupByCellValues[t])).length)(t,m)));if(!g)return void l((t=>t.filter((t=>t!==e.runUuid))));const h=g.key,f=g.groupByCellValues;if(!o)return;const v=(0,dn.TG)(o,f);u&&d(Mn({routeName:u,routeType:p,compiledPrompt:v,inputValues:f,outputColumn:t,rowKey:h,parameters:s,run:e})).then((()=>{r.current.includes(e.runUuid)&&c(e)})).catch((t=>{const n=En(t),r=i.formatMessage({id:"jI22Qu",defaultMessage:'Gateway returned the following error: "{errorMessage}"'},{errorMessage:n});E.A.logErrorAndNotifyUser(r),l((t=>t.filter((t=>t!==e.runUuid))))}))}),[d,t,i]),u=(0,a.useCallback)((e=>{l((t=>[...t,e.runUuid])),c(e)}),[c]),p=(0,a.useCallback)((e=>{l((t=>t.filter((t=>t!==e.runUuid))))}),[]);return{runColumnsBeingEvaluated:o,startEvaluatingRunColumn:u,stopEvaluatingRunColumn:p}})(t,n),h=(0,s.d4)((e=>{let{evaluationData:t}=e;return t.evaluationPendingDataLoadingByRunUuid})),f=(0,a.useCallback)((e=>n===dn.hR&&(0,dn.o1)(e)),[n]),v=(0,a.useCallback)((e=>t.filter((t=>{if(t.cellValues[e.runUuid])return!1;const n=c(e,t.key);return 0===(null===n||void 0===n?void 0:n.length)})).length),[t,c]),y=(0,a.useCallback)((e=>{g.includes(e.runUuid)?m(e):p(e)}),[g,p,m]),b=(0,a.useCallback)(((e,r)=>{const a=t.find((e=>{let{key:t}=e;return t===r}));if(!a)return;const s=a.groupByCellValues,{parameters:o,promptTemplate:l,routeName:d,routeType:c}=(0,dn.vC)(e);if(!l)return;const p=(0,dn.TG)(l,s);if(d){u((()=>Mn({routeName:d,routeType:c,compiledPrompt:p,inputValues:s,outputColumn:n,rowKey:r,parameters:o,run:e}))()).catch((e=>{const t=En(e),n=i.formatMessage({id:"nyHcAz",defaultMessage:'MLflow deployment returned the following error: "{errorMessage}"'},{errorMessage:t});E.A.logErrorAndNotifyUser(n)}))}}),[t,u,n,i]),w=(0,a.useMemo)((()=>({getMissingParams:c,getEvaluableRowCount:v,evaluateCell:b,evaluateAllClick:y,pendingDataLoading:h,canEvaluateInRunColumn:f,runColumnsBeingEvaluated:g,isHeaderExpanded:o,toggleExpandedHeader:d})),[c,v,y,b,h,f,g,o,d]);return(0,x.Y)(Ys.Provider,{value:w,children:r})},As=()=>(0,a.useContext)(Ys);var Rs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},_s={name:"lyel5l",styles:"font-size:0"},Is={name:"1hetg88",styles:"max-width:300px"};const Ms=e=>{let{run:t}=e;const{theme:n}=(0,u.u)(),{isHeaderExpanded:a}=As(),i=(0,dn.vC)(t),o=(0,s.d4)((e=>{let{modelGateway:t}=e;const n=`${i.routeType}:${i.routeName}`;return i.routeName?t.modelGatewayRoutes[n]:null}));if(!(0,dn.o1)(t)||!i)return null;const{parameters:l,promptTemplate:d,routeName:c}=i,{stop:p=[]}=l;return(0,x.FD)("div",{css:(0,r.AH)({marginTop:n.spacing.xs,flex:1,display:"flex",flexDirection:"column",gap:n.spacing.sm,overflowX:"hidden",width:"100%"},""),children:[o&&"mlflowDeployment"in o&&o.mlflowDeployment&&(0,x.Y)(u.T.Hint,{children:o.mlflowDeployment.name}),a&&(0,x.FD)(x.FK,{children:[(0,x.Y)(u.T.Hint,{children:(0,x.Y)(X.A,{id:"HGBit9",defaultMessage:"Temperature: {temperature}",values:l})}),(0,x.Y)(u.T.Hint,{children:(0,x.Y)(X.A,{id:"6K04VZ",defaultMessage:"Max. tokens: {max_tokens}",values:l})}),p.length?(0,x.Y)(u.T.Hint,{css:Rs,children:(0,x.Y)(X.A,{id:"iC2Owx",defaultMessage:"Stop sequences: {stopSequences}",values:{stopSequences:null===p||void 0===p?void 0:p.join(", ")}})}):null,(0,x.Y)("div",{css:_s,children:(0,x.FD)(J.P.Root,{children:[(0,x.Y)(J.P.Trigger,{asChild:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadermodelindicator.tsx_115",type:"link",size:"small",css:(0,r.AH)({fontSize:n.typography.fontSizeSm},""),children:(0,x.Y)(X.A,{id:"XX8+x1",defaultMessage:"View prompt template"})})}),(0,x.FD)(J.P.Content,{css:Is,children:[(0,x.Y)(J.P.Arrow,{}),d]})]})})]})]})};var ks=n(38243);var Es={name:"1iwgvlm",styles:"flex-shrink:1;flex-grow:1;overflow:hidden"},Ts={name:"1kd7iwj",styles:"flex-shrink:0;flex-grow:1;display:flex;align-items:flex-end"};const Ds=e=>{var t;let{run:n,onDatasetSelected:s}=e;const{theme:i}=(0,u.u)(),o=(0,a.useCallback)((e=>s(e,n)),[s,n]);return(null===(t=n.datasets)||void 0===t?void 0:t.length)<1?null:(0,x.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",gap:i.spacing.xs,overflow:"hidden"},""),children:[(0,x.Y)("div",{css:Es,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheaderdatasetindicator.tsx_37",type:"link",onClick:()=>o(n.datasets[0]),children:(0,x.Y)(ks.E,{datasetWithTags:n.datasets[0],displayTextAsLink:!0,css:(0,r.AH)({marginTop:i.spacing.xs/2,marginBottom:i.spacing.xs/2},"")})})}),n.datasets.length>1&&(0,x.Y)("div",{css:Ts,children:(0,x.FD)(J.P.Root,{modal:!1,children:[(0,x.Y)(J.P.Trigger,{asChild:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheaderdatasetindicator.tsx_49",size:"small",style:{borderRadius:"8px",width:"40px"},children:(0,x.FD)(u.T.Text,{color:"secondary",children:["+",n.datasets.length-1]})})}),(0,x.Y)(J.P.Content,{align:"start",children:n.datasets.slice(1).filter(Boolean).map((e=>(0,x.Y)("div",{css:(0,r.AH)({height:i.general.heightSm,display:"flex",alignItems:"center"},""),children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheaderdatasetindicator.tsx_66",type:"link",onClick:()=>o(e),children:(0,x.Y)(ks.E,{datasetWithTags:e,displayTextAsLink:!0})})},`${e.dataset.name}-${e.dataset.digest}`)))})]})})]})};var Fs={name:"1on1b16",styles:"width:100%;height:100%;display:flex;flex-direction:column"};const Ls=e=>{let{children:t,className:n,groupHeaderContent:a=null}=e;const{theme:s}=(0,u.u)();return(0,x.FD)("div",{css:Fs,children:[(0,x.Y)("div",{css:(0,r.AH)({width:"100%",flexBasis:40,display:"flex",alignItems:"center",padding:s.spacing.sm,borderBottom:`1px solid ${s.colors.borderDecorative}`},""),className:"header-group-cell",children:a}),(0,x.Y)("div",{css:(0,r.AH)({width:"100%",flex:1,display:"flex",justifyContent:"flex-start",alignItems:"flex-start",padding:s.spacing.xs,borderRight:`1px solid ${s.colors.borderDecorative}`},""),className:n,children:t})]})};var Ps={name:"8xhv84",styles:"width:100%;display:flex"},Bs={name:"ozd7xs",styles:"flex-shrink:0"},Ns={name:"82a6rk",styles:"flex:1"};const Hs=e=>{let{run:t,onHideRun:n,onDuplicateRun:s,onDatasetSelected:i,groupHeaderContent:l=null}=e;const{theme:d}=(0,u.u)(),{getEvaluableRowCount:p,evaluateAllClick:m,runColumnsBeingEvaluated:h,canEvaluateInRunColumn:f}=As(),v=(0,Ie.A)(),y=p(t),b=(0,va.LE)(),w=y>0,C=h.includes(t.runUuid),Y=(0,a.useMemo)((()=>w?w&&!C?v.formatMessage({id:"2gmOVq",defaultMessage:"Process {evaluableRowCount} rows without evaluation output"},{evaluableRowCount:y}):null:v.formatMessage({id:"7m2B5x",defaultMessage:"There are no evaluable rows within this column"})),[y,w,C,v]);return(0,x.FD)(Ls,{css:(0,r.AH)({justifyContent:"flex-start",padding:d.spacing.sm,paddingBottom:0,paddingTop:d.spacing.sm,flexDirection:"column",gap:d.spacing.xs/2,overflow:"hidden"},""),groupHeaderContent:l,children:[(0,x.FD)("div",{css:Ps,children:[(0,x.FD)("span",{css:(0,r.AH)({display:"flex",gap:d.spacing.sm,alignItems:"center"},""),children:[(0,x.Y)(fa.E,{color:b(t.runUuid)}),(0,x.Y)(o.N_,{to:g.h.getRunPageRoute(t.experimentId||"",t.runUuid),target:"_blank",children:t.runName})]}),(0,x.Y)("div",{css:(0,r.AH)({flexBasis:d.spacing.sm,flexShrink:0},"")}),(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadercellrenderer.tsx_112",onClick:()=>n(t.runUuid),size:"small",icon:(0,x.Y)(c.kFX,{}),css:Bs}),(0,x.Y)("div",{css:Ns}),(0,ne.Ii)()&&f(t)&&(0,x.FD)(x.FK,{children:[(0,x.Y)("div",{css:(0,r.AH)({flexBasis:d.spacing.sm},"")}),(0,x.Y)(c.m_M,{title:Y,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadercellrenderer.tsx_118",disabled:!w,size:"small",onClick:()=>m(t),icon:C?(0,x.Y)(c.wFz,{}):(0,x.Y)(c.udU,{}),children:C?(0,x.Y)(X.A,{id:"plw4Kp",defaultMessage:"Stop evaluating"}):(0,x.Y)(X.A,{id:"JnIbS3",defaultMessage:"Evaluate all"})})})]}),(0,x.Y)("div",{css:(0,r.AH)({flexBasis:d.spacing.sm},"")}),(0,ne.Ii)()&&(0,dn.o1)(t)&&(0,x.FD)(c.rId.Root,{modal:!1,children:[(0,x.Y)(c.rId.Trigger,{asChild:!0,children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadercellrenderer.tsx_143",size:"small",icon:(0,x.Y)(c.ssM,{})})}),(0,x.Y)(c.rId.Content,{children:(0,x.Y)(c.rId.Item,{onClick:()=>s(t),children:(0,x.Y)(X.A,{id:"1YGQOY",defaultMessage:"Duplicate run"})})})]})]}),(0,ne.Ii)()&&(0,dn.o1)(t)?(0,x.Y)(Ms,{run:t}):(0,x.Y)(Ds,{run:t,onDatasetSelected:i})]})},Os=e=>{let{disabled:t,isLoading:n,run:r,rowKey:a}=e;const s=(0,dn.o1)(r),{evaluateCell:i,getMissingParams:o}=As(),l=r&&o(r,a)||null;return l&&l.length>0?(0,x.Y)(c.m_M,{title:(0,x.Y)(X.A,{id:"yAuDRt",defaultMessage:'Evaluation is not possible because values for the following inputs cannot be determined: {missingParamList}. Add input columns to the "group by" settings or use "Add row" button to define new parameter set.',values:{missingParamList:(0,x.Y)("code",{children:l.join(", ")})}}),children:(0,x.Y)(c.mo0,{})}):s?(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcellevaluatebutton.tsx_59",loading:n,disabled:t,size:"small",onMouseDownCapture:e=>e.stopPropagation(),onClickCapture:e=>{e.stopPropagation(),i(r,a)},icon:(0,x.Y)(c.udU,{}),children:(0,x.Y)(x.FK,{children:"Evaluate"})}):(0,x.Y)(c.m_M,{title:(0,x.Y)(X.A,{id:"MhtxHm",defaultMessage:"You cannot evaluate this cell, this run was not created using served LLM model route"}),children:(0,x.Y)(c.mo0,{})})};var Us=n(40555);const Ks=a.memo((e=>{let{text:t,highlight:n}=e;const{theme:s}=(0,u.u)();if(!n)return(0,x.Y)(x.FK,{children:t});const i=t.split(new RegExp(`(${n})`,"gi"));return(0,x.Y)(x.FK,{children:i.map(((e,t)=>(0,x.Y)(a.Fragment,{children:e.toLowerCase()===n.toLowerCase()?(0,x.Y)("span",{css:(0,r.AH)({backgroundColor:s.colors.yellow200},""),children:e}):e},t)))})}));var zs={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"},Vs={name:"52b6nu",styles:"display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:7"},Gs={name:"1jwcxx3",styles:"font-style:italic"};const qs=e=>{var t,n;let{value:i,context:o,isGroupByColumn:l,run:d,data:p}=e;const{theme:m}=(0,u.u)(),{pendingDataLoading:g,canEvaluateInRunColumn:h}=As(),f=(0,s.d4)((e=>{let{modelGateway:{modelGatewayRoutesLoading:t,modelGatewayRoutesLoadingLegacy:n}}=e;return t.loading})),v=d&&(null===(t=g[d.runUuid])||void 0===t?void 0:t[null===p||void 0===p?void 0:p.key]),y=d&&(null===(n=p.outputMetadataByRunUuid)||void 0===n?void 0:n[d.runUuid])||null,b=null!==y&&void 0!==y&&y.isPending||p.isPendingInputRow?m.colors.backgroundSecondary:m.colors.backgroundPrimary,w=a.useMemo((()=>{try{return JSON.parse(i)}catch(e){return null}}),[i]);return(0,x.FD)("div",{css:(0,r.AH)({height:"100%",whiteSpace:"normal",padding:m.spacing.sm,overflow:"hidden",position:"relative",cursor:"pointer",backgroundColor:b,"&:hover":{backgroundColor:m.colors.actionDefaultBackgroundHover}},""),children:[v?(0,x.Y)(c.QvX,{lines:3}):(0,x.Y)(x.FK,{children:i?w?(0,x.Y)(Us.fh,{json:JSON.stringify(w,null,2)}):(0,x.Y)("span",{css:Vs,children:l&&o.highlightedText?(0,x.Y)(Ks,{text:i,highlight:o.highlightedText}):"string"===typeof i?i.substring(0,512):"object"!==typeof i&&i}):(0,x.Y)(u.T.Text,{color:"info",css:zs,children:(0,x.Y)(X.A,{id:"aQxQIF",defaultMessage:"(empty)"})})}),(0,ne.Ii)()&&d&&h(d)&&(0,x.FD)("div",{css:(0,r.AH)({position:"absolute",left:8,bottom:8,right:8,display:"flex",gap:m.spacing.sm,alignItems:"center",justifyContent:"space-between"},""),children:[(0,x.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",gap:m.spacing.xs},""),children:[!i&&(0,x.Y)(Os,{disabled:v,isLoading:f,run:d,rowKey:p.key}),((null===y||void 0===y?void 0:y.isPending)||p.isPendingInputRow)&&(0,x.Y)(u.T.Hint,{size:"sm",css:Gs,children:(0,x.Y)(X.A,{id:"2fvQaF",defaultMessage:"Unsaved"})})]}),y&&!v&&(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:m.spacing.xs,alignItems:"center"},""),children:[y.evaluationTime&&(0,x.FD)(u.T.Hint,{size:"sm",children:[Math.round(y.evaluationTime)," ms",y.totalTokens?",":""]}),y.totalTokens&&(0,x.Y)(u.T.Hint,{size:"sm",children:(0,x.Y)(X.A,{id:"/nPZbt",defaultMessage:"{totalTokens} total tokens",values:{totalTokens:y.totalTokens}})})]})]})]})},$s={initialWidthGroupBy:200,initialWidthOutput:360,maxWidth:500,minWidth:140};var Ws={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const js=e=>{let{displayName:t}=e;const{theme:n}=(0,u.u)();return(0,x.Y)(Ls,{css:(0,r.AH)({justifyContent:"flex-start",padding:n.spacing.sm},""),children:(0,x.Y)(c.m_M,{title:(0,V.truncate)(t,{length:250}),children:(0,x.Y)(u.T.Text,{bold:!0,css:Ws,children:t})})})};var Qs={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const Js={svg:{width:20,height:20}},Xs=()=>{const{toggleExpandedHeader:e,isHeaderExpanded:t}=As();return(0,x.Y)(Ls,{children:(0,x.Y)(c.m_M,{placement:"right",title:(0,x.Y)(X.A,{id:"lDGQGa",defaultMessage:"Toggle detailed view"}),children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationtableactionscolumnrenderer.tsx_22",icon:t?(0,x.Y)(c.D3D,{css:Js}):(0,x.Y)(c.vKP,{css:Js}),onClick:e})})})},Zs=e=>{let{onAddNewInputs:t,displayAddNewInputsButton:n}=e;const{theme:a}=(0,u.u)();return n?(0,x.Y)("div",{css:(0,r.AH)({width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:a.spacing.xs},""),children:(0,x.Y)(c.m_M,{placement:"right",title:(0,x.Y)(X.A,{id:"PNfcez",defaultMessage:"Add row"}),children:(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationtableactionscellrenderer.tsx_37",icon:(0,x.Y)(Nt.P,{}),onClick:t})})}):null};var ei=n(54421);var ti={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"},ni={name:"pdi3j6",styles:"display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:7;width:100%;height:100%"};const ri=e=>{let{value:t}=e;const{theme:n}=(0,u.u)(),a=n.colors.backgroundPrimary;return(0,x.Y)("div",{css:(0,r.AH)({height:"100%",whiteSpace:"normal",padding:n.spacing.sm,overflow:"hidden",position:"relative",cursor:"pointer",backgroundColor:a,"&:hover":{backgroundColor:n.colors.actionDefaultBackgroundHover}},""),children:t&&t.url&&t.compressed_url?(0,x.Y)("span",{css:ni,children:(0,x.Y)(ei.TV,{imageUrl:t.url,compressedImageUrl:t.compressed_url})}):(0,x.Y)(u.T.Text,{color:"info",css:ti,children:(0,x.Y)(X.A,{id:"aQxQIF",defaultMessage:"(empty)"})})})};var ai={name:"3ytxc3",styles:"height:100%;overflow:hidden"};const si=e=>{let{resultList:t,visibleRuns:n,groupByColumns:i,onCellClick:o,onHideRun:l,onDatasetSelected:d,highlightedText:p="",isPreviewPaneVisible:m,outputColumnName:g,isImageColumn:h}=e;const[f,v]=(0,a.useState)([]),[y,b]=(0,a.useState)(null),w=(0,s.d4)((e=>{let{evaluationData:t}=e;return t.evaluationPendingDataByRunUuid})),C=(0,a.useRef)(null),{isHeaderExpanded:Y}=As(),{createNewRun:S}=Un(),A=(0,a.useCallback)((e=>{null===y||void 0===y||y.refreshHeader(),l(e)}),[y,l]),R=(0,a.useCallback)((e=>{null===y||void 0===y||y.refreshHeader(),S(e)}),[S,y]);(0,a.useEffect)((()=>{y&&!m&&y.clearFocusedCell()}),[y,m]),(0,a.useEffect)((()=>{if(!y)return;const e=y.getRenderedNodes();y.refreshCells({force:!0,rowNodes:e})}),[y,w,p]);const{showAddNewInputsModal:_,AddNewInputsModal:I}=(()=>{const[e,t]=(0,a.useState)(!1),[n,s]=(0,a.useState)([]),[i,o]=(0,a.useState)({}),l=(0,a.useMemo)((()=>n.every((e=>{let{inputName:t}=e;return i[t]}))),[i,n]),[d,p]=(0,a.useState)((async()=>{})),m=(0,a.useCallback)(((e,t)=>{o((n=>({...n,[e]:t})))}),[]),g=(0,a.useCallback)(((e,n)=>{const r=e.filter(dn.o1).map((e=>({runName:e.runName,params:(0,dn.xP)(e)}))),a=(0,V.uniq)(r.map((e=>{let{params:t}=e;return t})).flat()).map((e=>({inputName:e,runNames:(0,V.compact)(r.filter((t=>t.params.includes(e))).map((e=>{let{runName:t}=e;return t})))})));t(!0),s(a),o({}),p((()=>n))}),[]),{theme:h}=(0,u.u)(),f=(0,x.Y)(J.M,{title:(0,x.Y)(X.A,{id:"JnidmZ",defaultMessage:"Add row"}),okButtonProps:{disabled:!l},okText:(0,x.Y)(X.A,{id:"eeLqSn",defaultMessage:"Submit"}),cancelText:(0,x.Y)(X.A,{id:"jwALGI",defaultMessage:"Cancel"}),onOk:()=>{d(i),t(!1)},visible:e,onCancel:()=>t(!1),children:n.map((e=>{let{inputName:t,runNames:n}=e;return(0,x.FD)("div",{css:(0,r.AH)({marginBottom:h.spacing.md},""),children:[(0,x.Y)(u.T.Text,{bold:!0,children:t}),(0,x.Y)(u.T.Hint,{css:Qs,children:(0,x.Y)(X.A,{id:"s35HDG",defaultMessage:"Used by {runNames} {hasMore, select, true {and other runs} other {}}",values:{runNames:n.slice(0,5).join(", "),hasMore:n.length>5}})}),(0,x.Y)("div",{css:(0,r.AH)({marginTop:h.spacing.sm},""),children:(0,x.Y)(c.pde.TextArea,{value:i[t],onChange:e=>m(t,e.target.value)})})]},t)}))});return{showAddNewInputsModal:g,AddNewInputsModal:f}})(),M=(0,s.wA)(),k=(0,a.useCallback)((()=>{var e;const t=null===(e=C.current)||void 0===e?void 0:e.querySelector(".ag-body-viewport");t?t.scrollTo({top:0,behavior:"smooth"}):null===y||void 0===y||y.ensureIndexVisible(0,"top")}),[y]),E=(0,a.useMemo)((()=>n.map(dn.xP).flat().length>0),[n]),T=(0,a.useCallback)((()=>{_(n,(e=>{M({type:"EVALUATE_ADD_INPUT_VALUES",payload:e,meta:{}}),k()}))}),[k,_,M,n]),{theme:D}=(0,u.u)(),F=(0,Ie.A)(),L=(0,a.useCallback)((e=>{let{value:t,colDef:n,column:r}=e;const a=F.formatMessage({id:"aQxQIF",defaultMessage:"(empty)"});return null===o||void 0===o?void 0:o(t||a,n.headerName||r.getId())}),[F,o]),P=(0,a.useMemo)((()=>(0,x.Y)(u.T.Text,{bold:!0,children:g})),[g]);return(0,a.useEffect)((()=>{const e=[],{initialWidthGroupBy:t,initialWidthOutput:r,maxWidth:a,minWidth:s}=$s;(0,ne.Ii)()&&n.some((e=>(0,dn.o1)(e)))&&e.push({resizable:!1,pinned:!0,width:40,headerComponent:"ActionsColumnRenderer",cellRendererSelector:e=>{let{rowIndex:t}=e;return 0===t?{component:"ActionsCellRenderer",params:{displayAddNewInputsButton:E,onAddNewInputs:T}}:void 0},cellClass:"leading-column-cell"}),i.forEach(((n,r)=>{const o=r===i.length-1;e.push({resizable:!0,initialWidth:t,minWidth:s,maxWidth:a,headerName:n,valueGetter:e=>{let{data:t}=e;return t.groupByCellValues[n]},suppressMovable:!0,cellRenderer:"TextRendererCellRenderer",headerClass:o?"last-group-by-header-cell":void 0,cellRendererParams:{isGroupByColumn:!0},headerComponent:"GroupHeaderCellRenderer",headerComponentParams:{displayAddNewInputsButton:E,onAddNewInputs:T},colId:n,onCellClicked:L})})),n.forEach(((t,n)=>{const i=0===n;e.push({resizable:!0,initialWidth:r,minWidth:s,maxWidth:a,headerName:t.runName,colId:t.runUuid,valueGetter:e=>{let{data:n}=e;return n.cellValues[t.runUuid]},suppressMovable:!0,cellRenderer:h?"ImageRendererCellRenderer":"TextRendererCellRenderer",cellRendererParams:{run:t},headerComponent:"RunHeaderCellRenderer",headerComponentParams:{run:t,onDuplicateRun:R,onHideRun:A,onDatasetSelected:d,groupHeaderContent:i?P:null},onCellClicked:L})})),v(e)}),[n,i,A,R,d,T,E,L,P,h]),(0,a.useEffect)((()=>{if(!y)return;const e=n.some((e=>{var t;return(0,dn.o1)(e)||(null===(t=e.datasets)||void 0===t?void 0:t.length)>0}));y.setHeaderHeight(function(){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?40+(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?175:62):80}(Y,e))}),[y,Y,n]),(0,x.FD)("div",{css:ai,ref:C,children:[(0,x.Y)(Sr,{css:ii(D),context:{highlightedText:p},rowHeight:190,onGridReady:e=>{let{api:t}=e;return b(t)},getRowId:e=>{let{data:t}=e;return t.key},suppressHorizontalScroll:!1,columnDefs:f,rowData:t,components:{TextRendererCellRenderer:qs,GroupHeaderCellRenderer:js,RunHeaderCellRenderer:Hs,ActionsColumnRenderer:Xs,ActionsCellRenderer:Zs,ImageRendererCellRenderer:ri}}),I]})},ii=e=>({".ag-row:not(.ag-row-first), .ag-body-viewport":{borderTop:`1px solid ${e.colors.borderDecorative}`},".ag-row-last":{borderBottom:`1px solid ${e.colors.borderDecorative}`},".ag-cell, .last-group-by-header-cell .header-group-cell":{borderRight:`1px solid ${e.colors.borderDecorative}`},".ag-cell-focus:not(.leading-column-cell)::after":{content:'""',position:"absolute",inset:0,boxShadow:`inset 0 0 0px 2px ${e.colors.blue300}`,pointerEvents:"none"}});var oi=n(77484);const li=(e,t)=>{const n=t.map((t=>{const n=e[t];return[t,(0,V.isString)(n)?n:JSON.stringify(n)]})),r=n.map((e=>{let[,t]=e;return String(t)})).join(".");return{key:r,groupByValues:(0,V.fromPairs)(n)}},di=()=>{var e;return/mac/i.test(null===(e=window.navigator.userAgentData)||void 0===e?void 0:e.platform)||/mac/i.test(window.navigator.platform)},ci=di()?"metaKey":"ctrlKey",ui=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const{altOrOptKey:r=!1,ctrlOrCmdKey:s=!1,shiftKey:i=!1}=t;return(0,a.useEffect)((()=>{const t=t=>{if((!s||t[ci])&&(!r||t.altKey)&&(!i||t.shiftKey)&&t.key===e){n()&&t.preventDefault()}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)}),[e,n,s,r,i]),{isMacKeyboard:di}},pi=()=>{const{evaluationPendingDataByRunUuid:e,evaluationArtifactsBeingUploaded:t,evaluationDraftInputValues:n}=(0,s.d4)((e=>{let{evaluationData:t}=e;return t})),[o,l]=(0,a.useState)(!1),d=(0,s.wA)(),c=(0,a.useCallback)((()=>{d({type:"DISCARD_PENDING_EVALUATION_DATA"})}),[d]),p=Object.values(e).flat().length,m=n.length,g=Object.values(t).filter((e=>Object.values(e).some((e=>e)))).length;(0,a.useEffect)((()=>{0===p&&l(!1)}),[p]);const h=(0,a.useCallback)((()=>(0===p||o||(l(!0),d((async(e,t)=>{const{evaluationPendingDataByRunUuid:n,evaluationArtifactsByRunUuid:r}=t().evaluationData,a=Object.keys(n),s=(0,V.fromPairs)(Object.entries(r).filter((e=>{let[t,n]=e;return a.includes(t)&&n[Ct.AH]})).map((e=>{let[t,n]=e;return[t,n[Ct.AH]]}))),o=a.map((e=>{const t=s[e];if(!t)throw new Error(`Cannot find existing prompt engineering artifact for run ${e}`);const r=n[e].map((e=>{let{entryData:n,evaluationTime:r,totalTokens:a}=e;return t.columns.map((e=>e===dn.Ef?r.toString():e===dn.jC&&a?a.toString():n[e]||""))})),a=(0,V.cloneDeep)(s[e].rawArtifactFile);return null===a||void 0===a||a.data.unshift(...r),{runUuid:e,updatedArtifactFile:a}})),l=o.map((t=>{let{runUuid:n,updatedArtifactFile:r}=t;return e((0,i.Of)(n,Ct.AH,r)).then((()=>{const e=(0,In.G)(Ct.AH,r);return{runUuid:n,newEvaluationTable:e}}))}));return e({type:"WRITE_BACK_EVALUATION_ARTIFACTS",payload:Promise.all(l),meta:{runUuidsToUpdate:a,artifactPath:Ct.AH}})})).catch((e=>{E.A.logErrorAndNotifyUser(e)}))),!0)),[d,p,o]),{isMacKeyboard:f}=ui("s",{ctrlOrCmdKey:!0},h),{theme:v}=(0,u.u)(),y=m>0&&0===p,b=p>0||y?(0,x.FD)("div",{css:(0,r.AH)({backgroundColor:v.colors.backgroundPrimary,border:`1px solid ${v.colors.border}`,padding:v.spacing.md,marginBottom:v.spacing.sm,display:"flex",justifyContent:"space-between",alignItems:"center"},""),children:[y?(0,x.Y)(X.A,{id:"EPcEi9",defaultMessage:"You have added rows with new input values, but you still need to evaluate the new data in order to save it."}):o?(0,x.Y)(u.T.Text,{children:(0,x.Y)(X.A,{id:"NGsTf/",defaultMessage:"Synchronizing artifacts for {runsBeingSynchronizedCount} runs...",values:{runsBeingSynchronizedCount:(0,x.Y)("strong",{children:g})}})}):(0,x.Y)(u.T.Text,{children:(0,x.Y)(X.A,{id:"BWpQZ7",defaultMessage:'You have <strong>{unsyncedDataEntriesCount}</strong> unsaved evaluated {unsyncedDataEntriesCount, plural, =1 {value} other {values}}. Click "Save" button or press {keyCombination} keys to synchronize the artifact data.',values:{strong:e=>(0,x.Y)("strong",{children:e}),unsyncedDataEntriesCount:p,keyCombination:f()?"\u2318CMD+S":"CTRL+S"}})}),(0,x.FD)("div",{css:(0,r.AH)({display:"flex",gap:v.spacing.sm},""),children:[(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_hooks_useevaluationartifactwriteback.tsx_102",disabled:o,onClick:c,children:(0,x.Y)(X.A,{id:"kNTkr+",defaultMessage:"Discard"})})," ",p>0&&(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_hooks_useevaluationartifactwriteback.tsx_110",loading:o,type:"primary",onClick:h,children:(0,x.Y)(X.A,{id:"nhqO2Z",defaultMessage:"Save"})})]})]}):null;return{isSyncingArtifacts:o,EvaluationSyncStatusElement:b}},mi=e=>{let{noEvalTablesLogged:t,userDeselectedAllColumns:n,areRunsSelected:r,areTablesSelected:a}=e;return!a||!r||n||t},gi=e=>{let{noEvalTablesLogged:t,userDeselectedAllColumns:n,areRunsSelected:r}=e;const[a,s]=r?t?[(0,x.Y)(X.A,{id:"sguNEF",defaultMessage:"No evaluation tables logged"}),(0,x.Y)(X.A,{id:"j7cj5r",defaultMessage:"Please log at least one table artifact containing evaluation data. <link>Learn more</link>.",values:{link:e=>(0,x.Y)(u.T.Link,{openInNewTab:!0,href:"https://mlflow.org/docs/latest/python_api/mlflow.html?highlight=log_table#mlflow.log_table",target:"_blank",rel:"noopener noreferrer",children:e})}})]:n?[(0,x.Y)(X.A,{id:"owr9l2",defaultMessage:"No group by columns selected"}),(0,x.Y)(X.A,{id:"lJQEW4",defaultMessage:'Using controls above, select at least one "group by" column.'})]:[(0,x.Y)(X.A,{id:"ZvJTXB",defaultMessage:"No tables selected"}),(0,x.Y)(X.A,{id:"18/UVG",defaultMessage:"Using controls above, select at least one artifact containing table."})]:[(0,x.Y)(X.A,{id:"BFzsMn",defaultMessage:"No runs selected"}),(0,x.Y)(X.A,{id:"nPWZsh",defaultMessage:"Make sure that at least one experiment run is visible and available to compare"})];return(0,x.Y)(c.SvL,{title:a,description:s})};var hi={name:"1hetg88",styles:"max-width:300px"},fi={name:"111arwn",styles:"width:300px;min-width:300px"},vi={name:"1hetg88",styles:"max-width:300px"},yi={name:"1hetg88",styles:"max-width:300px"},xi={name:"1ichkjj",styles:"height:100%;display:flex;justify-content:center;align-items:center"};const bi=e=>{let{comparedRuns:t,onDatasetSelected:n,viewState:o,updateViewState:l}=e;const d=(0,Ie.A)(),{theme:p}=(0,u.u)(),m=((0,Wn.e)(),(0,a.useMemo)((()=>t.filter((e=>{let{hidden:t}=e;return!t})).slice(0,10)),[t])),{selectedTables:g,groupByCols:h,outputColumn:f,setSelectedTables:v,setGroupByCols:y,setOutputColumn:b}=((e,t)=>{const{artifactViewState:n={}}=e,[r,s]=(0,a.useState)(n.selectedTables||[]),[i,o]=(0,a.useState)(n.groupByCols||[]),[l,d]=(0,a.useState)(n.outputColumn||"");return(0,a.useEffect)((()=>t({artifactViewState:{selectedTables:r,groupByCols:i,outputColumn:l}})),[t,r,i,l]),{selectedTables:r,groupByCols:i,outputColumn:l,setSelectedTables:s,setGroupByCols:o,setOutputColumn:d}})(o,l),[w,C]=(0,a.useState)(!1),[Y,S]=(0,a.useState)(""),[A,R]=(0,a.useState)(""),[_,I]=(0,a.useState)(!1),{isSyncingArtifacts:M,EvaluationSyncStatusElement:k}=pi(),T=(0,s.wA)();(0,a.useEffect)((()=>{(0,ne.Ii)()&&T(kn()).catch((e=>{E.A.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e)}))}),[T]);const D=(0,a.useCallback)((e=>v((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))),[v]),F=(0,a.useCallback)((e=>y((t=>{const n=t.includes(e)?t.filter((t=>t!==e)):[...t,e];return I(0===n.length),n}))),[y]),L=(0,a.useMemo)((()=>m.map((e=>{let{runUuid:t}=e;return t}))),[m]),{evaluationArtifactsByRunUuid:P,evaluationPendingDataByRunUuid:B,evaluationDraftInputValues:N}=(0,s.d4)((e=>{let{evaluationData:t}=e;return t})),{tables:H,tablesByRun:O,noEvalTablesLogged:U}=(K=m,(0,a.useMemo)((()=>{const e=(0,V.fromPairs)(K.map((e=>{var t,n;const r=null===(t=e.tags)||void 0===t||null===(n=t[Ct.WM])||void 0===n?void 0:n.value,a=new Set;if(r)try{JSON.parse(r).filter((e=>{let{type:t}=e;return t===Rr.qd.TABLE})).forEach((e=>{let{path:t}=e;a.add(t)}))}catch(s){if(s instanceof SyntaxError)throw new SyntaxError(`The "${Ct.WM}" tag in "${e.runName}" run is malformed!`);throw s}return[e.runUuid,Array.from(a)]})).filter((e=>{let[,t]=e;return t.length>0}))),t=Array.from(new Set(Object.values(e).flat())),n=t.filter((t=>K.every((n=>{var r;let{runUuid:a}=n;return null===(r=e[a])||void 0===r?void 0:r.includes(t)})))),r=0===t.length;return{tables:t,tablesByRun:e,tablesIntersection:n,noEvalTablesLogged:r}}),[K]));var K;(0,a.useEffect)((()=>{H.length>0&&0===g.length&&v([H[0]])}),[H,v,g.length]);const z=(0,s.d4)((e=>{let{evaluationData:t,modelGateway:n}=e;return n.modelGatewayRoutesLoading.loading||L.some((e=>g.some((n=>{var r;return null===(r=t.evaluationArtifactsLoadingByRunUuid[e])||void 0===r?void 0:r[n]}))))})),{columns:G,imageColumns:q}=($=P,W=L,j=g,(0,a.useMemo)((()=>{if(0===j.length||0===W.length)return{columns:[],columnsIntersection:[],imageColumns:[]};const e=W.map((e=>Object.values($[e]||{}).filter((e=>{let{path:t}=e;return j.includes(t)})))).flat(),t=e.filter((e=>{let{path:t}=e;return j.includes(t)})).map((e=>{let{columns:t,entries:n}=e;return t.map((e=>{const t=String(e);if(n.length>0){const r=n[0][e];return"object"===typeof r&&"image"===(null===r||void 0===r?void 0:r.type)?{name:t,type:"image"}:{name:t,type:"text"}}return{name:t,type:"text"}}))})).flat(),n=Array.from(new Set(t.filter((e=>"text"===e.type)).map((e=>e.name)))),r=Array.from(new Set(t.filter((e=>"image"===e.type)).map((e=>e.name)))),a=n.filter((t=>e.every((e=>{let{columns:n}=e;return n.includes(t)}))));return{columns:n,columnsIntersection:a,imageColumns:r}}),[W,$,j]));var $,W,j;const Q=q.includes(f),J=((e,t,n,r,s,i,o)=>(0,a.useMemo)((()=>{const a=[],l={},d={},c=[];for(const e of n){const t=i.map((t=>[t,e[t]])),n=t.map((e=>{let[,t]=e;return t})).join(".");d[n]=(0,V.fromPairs)(t),c.push(n)}const u={},p=r.map((t=>{const n=Object.values(e[t]||{}).filter((e=>{let{path:t}=e;return s.includes(t)})).map((e=>{let{entries:t}=e;return t})).flat();return[t,n]}));for(const[e,t]of p)for(const n of t){const{key:t,groupByValues:r}=li(n,i);if(Object.values(r).every((e=>!e)))continue;d[t]||(d[t]=r),(n[dn.Ef]||n[dn.jC])&&(u[t]||(u[t]={}),u[t][e]||(u[t][e]={isPending:!1,evaluationTime:parseFloat(n[dn.Ef]),totalTokens:n[dn.jC]?parseInt(n[dn.jC],10):void 0})),l[t]||(l[t]={});const a=l[t];a[e]=a[e]||n[o]}for(const[e,n]of Object.entries(t))for(const t of n){const{entryData:n,...r}=t,{key:a,groupByValues:s}=li(n,i);if(Object.values(s).every((e=>!e)))continue;d[a]||(d[a]=s,c.push(a)),u[a]||(u[a]={}),u[a][e]=r,l[a]||(l[a]={});const p=l[a];p[e]=n[o]||p[e]}const m=(0,V.sortBy)(Object.entries(d),(e=>{let[t]=e;return!c.includes(t)}));for(const[e,t]of m){const n=a.find((t=>{let{key:n}=t;return e===n}));if(n&&l[e])n.cellValues=l[e],n.outputMetadataByRunUuid=u[e];else{const n=l[e];Object.keys(n||{}).forEach((e=>{if(null!==n[e]&&"object"===typeof n[e])try{const{type:t,filepath:r,compressed_filepath:a}=n[e];t===Ct.Oe?n[e]={url:(0,oi.To)(r,e),compressed_url:(0,oi.To)(a,e)}:n[e]=JSON.stringify(n[e])}catch{n[e]=""}else(0,V.isNil)(n[e])||(0,V.isString)(n[e])||(n[e]=JSON.stringify(n[e]))})),a.push({key:e,groupByCellValues:t,cellValues:l[e]||{},outputMetadataByRunUuid:u[e],isPendingInputRow:c.includes(e)})}}return a}),[r,e,i,n,s,o,t]))(P,B,N,L,g,h,f),Z=(0,a.useMemo)((()=>{const e=m.filter(dn.o1).map(dn.xP).flat();if(!e.length)return null;return Array.from(new Set(e)).filter((e=>G.includes(e)))}),[m,G]);(0,a.useEffect)((()=>{m.every(dn.o1)&&y([])}),[y,m]),(0,a.useEffect)((()=>{if(g.length)for(const e of m){if(!e)continue;const t=(O[e.runUuid]||[]).filter((e=>g.includes(e)));for(const n of t)T((0,i.sT)(e.runUuid,n,!1)).catch((e=>{E.A.logErrorAndNotifyUser(e.message||e)}))}}),[m,T,g,O]);const ee=g.length>0,te=m.length>0,re=!z&&ee&&te,ae=(0,a.useMemo)((()=>{if(!A.trim())return J;const e=new RegExp(A,"i");return J.filter((t=>{let{groupByCellValues:n}=t;return Object.values(n).some((t=>null===t||void 0===t?void 0:t.match(e)))}))}),[J,A]),se=gs(t),ie=(0,a.useCallback)((e=>{se(Qr.oy.CUSTOM,e)}),[se]);(0,a.useEffect)((()=>{if(z||_)return;const e=h.length<1,t=h.some((e=>!G.includes(e))),n=G[0],r=Z||(n?[n]:null);(e||t)&&r&&y(r)}),[z,_,h,f,G,y,Z]);const oe=(0,a.useMemo)((()=>G.filter((e=>!e.startsWith("MLFLOW_")))),[G]),le=(0,a.useMemo)((()=>[...G,...q].filter((e=>!h.includes(e)&&!e.startsWith("MLFLOW_")))),[G,q,h]);(0,a.useEffect)((()=>{if(h.includes(f)||!f){const e=le.includes(dn.hR)?dn.hR:le[0];b(e||"")}}),[h,f,le,b]),(0,a.useEffect)((()=>{C(!0);const e=setTimeout((()=>R(Y)),250);return()=>clearTimeout(e)}),[Y]),(0,a.useEffect)((()=>{C(!1)}),[A]),(0,a.useEffect)((()=>{if(!le.includes(f)){const e=le.includes(dn.hR)?dn.hR:le[0];b(e||"")}}),[f,le,b]),(0,a.useEffect)((()=>{g.some((e=>!H.includes(e)))&&v([])}),[g,H,v]);const[de,ce]=(0,a.useState)(null),ue=(0,a.useCallback)(((e,t)=>{ce({value:e,header:t}),l({previewPaneVisible:!0})}),[l]);return(0,x.FD)("div",{css:(0,r.AH)({flex:1,borderTop:`1px solid ${p.colors.border}`,borderLeft:`1px solid ${p.colors.border}`,marginLeft:-1,zIndex:1,height:"100%",display:"grid",gridTemplateColumns:o.previewPaneVisible?"1fr auto":"1fr",overflow:"hidden"},""),children:[(0,x.FD)("div",{css:(0,r.AH)({paddingLeft:p.spacing.sm,paddingTop:p.spacing.sm,height:"100%",display:"grid",gridTemplateRows:"auto auto 1fr",overflow:"hidden",rowGap:p.spacing.sm,backgroundColor:p.colors.backgroundSecondary},""),children:[(0,x.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",gap:p.spacing.sm,overflow:"hidden",height:p.general.heightSm},""),children:[(0,x.FD)(c.AYc,{label:(0,x.Y)(X.A,{id:"syyEiR",defaultMessage:"Table"}),multiSelect:!0,value:g,children:[(0,x.Y)(c.gGe,{css:(0,r.AH)({maxWidth:300,backgroundColor:p.colors.backgroundPrimary},""),"data-testid":"dropdown-tables",onClear:()=>v([]),disabled:M||!te||U}),(0,x.Y)(c.dn6,{css:hi,children:(0,x.Y)(c.HI_,{children:H.map((e=>(0,x.Y)(c.jTC,{value:e,onChange:D,checked:g.includes(e),"data-testid":"dropdown-tables-option",children:e},e)))})})]}),(0,x.Y)(c.m_M,{title:(0,x.Y)(X.A,{id:"VZRc73",defaultMessage:"Using the list of logged table artifacts, select at least one to start comparing results."}),children:(0,x.Y)(c.mo0,{})})]}),z?(0,x.Y)(c.PLz,{}):(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:(0,r.AH)({display:"flex",columnGap:p.spacing.sm,alignItems:"center",overflow:"hidden",height:p.general.heightSm},""),children:[(0,x.Y)(c.pde,{prefix:(0,x.Y)(c.WIv,{}),suffix:w&&(0,x.Y)(u.S,{size:"small"}),css:fi,onChange:e=>S(e.target.value),value:Y,placeholder:d.formatMessage({id:"3D2Znf",defaultMessage:"Filter by {columnNames}"},{columnNames:h.join(", ")}),allowClear:!0,disabled:!re||M}),(0,x.FD)(c.AYc,{value:h,multiSelect:!0,label:(0,x.Y)(X.A,{id:"fWm1UC",defaultMessage:"Group by"}),children:[(0,x.Y)(c.gGe,{disabled:!re||M,allowClear:!1,showTagAfterValueCount:1,css:(0,r.AH)({maxWidth:300,backgroundColor:p.colors.backgroundPrimary},""),"aria-label":'Select "group by" columns'}),(0,x.Y)(c.dn6,{css:vi,children:(0,x.Y)(c.HI_,{children:oe.map((e=>(0,x.Y)(c.jTC,{value:e,onChange:F,checked:h.includes(e),children:e},e)))})})]}),(0,x.FD)(c.AYc,{value:[f],label:(0,x.Y)(X.A,{id:"ZqGzZd",defaultMessage:"Compare"}),children:[(0,x.Y)(c.gGe,{disabled:!re||M,allowClear:!1,css:(0,r.AH)({maxWidth:300,backgroundColor:p.colors.backgroundPrimary},"")}),(0,x.Y)(c.dn6,{css:yi,children:(0,x.Y)(c.HI_,{children:le.map((e=>(0,x.Y)(c.crD,{value:e,onChange:()=>b(e),checked:f===e,children:e},e)))})})]})]}),mi({areRunsSelected:te,areTablesSelected:ee,noEvalTablesLogged:U,userDeselectedAllColumns:_})?(0,x.Y)("div",{css:xi,children:(0,x.Y)(gi,{areRunsSelected:te,areTablesSelected:ee,noEvalTablesLogged:U,userDeselectedAllColumns:_})}):(0,x.Y)("div",{css:(0,r.AH)({position:"relative",zIndex:1,overflowY:"hidden",height:"100%",backgroundColor:p.colors.backgroundPrimary},""),children:(0,x.Y)(Ss,{tableData:J,outputColumn:f,children:(0,x.Y)(si,{visibleRuns:m,groupByColumns:h,resultList:ae,onCellClick:Q?void 0:ue,onHideRun:ie,onDatasetSelected:n,highlightedText:A.trim(),isPreviewPaneVisible:o.previewPaneVisible,outputColumnName:f,isImageColumn:Q})})}),k]})]}),o.previewPaneVisible&&(0,x.Y)(ps,{content:null!==de&&void 0!==de&&de.value?(0,x.Y)(Us.fX,{json:de.value}):null,copyText:(null===de||void 0===de?void 0:de.value)||"",headerText:null===de||void 0===de?void 0:de.header,onClose:()=>l({previewPaneVisible:!1}),empty:(0,x.Y)(c.SvL,{description:(0,x.Y)(X.A,{id:"lTngfr",defaultMessage:"Select a cell to display preview"})})})]})},wi=e=>{const{theme:t}=(0,u.u)();return e.disabled?(0,x.Y)("div",{css:(0,r.AH)({flex:1,backgroundColor:t.colors.backgroundSecondary,height:"100%",borderTop:`1px solid ${t.colors.border}`,borderLeft:`1px solid ${t.colors.border}`,paddingTop:t.spacing.lg,marginLeft:-1,zIndex:1,display:"flex",justifyContent:"center",alignItems:"center"},""),children:(0,x.Y)(c.SvL,{title:(0,x.Y)(X.A,{id:"2gxV/O",defaultMessage:"Evaluation not available when grouping is enabled"}),description:(0,x.Y)(X.A,{id:"kdTxC2",defaultMessage:"Disable run grouping in order to access the evaluation view"}),image:(0,x.Y)("div",{})})}):(0,x.Y)(bi,{...e})};var Ci=n(30152),Yi=n(19485),Si=n(73150),Ai=n(75627),Ri=n(83128),_i=n(62758),Ii=n(63617),Mi=n(55999),ki=n(90765);const Ei=(e,t,n,r,a,s)=>{var i,o;return{uuid:e.runUuid,displayName:(null===(i=e.runInfo)||void 0===i?void 0:i.runName)||e.runUuid,runInfo:e.runInfo,metrics:t[e.runUuid]||{},params:n[e.runUuid]||{},tags:r[e.runUuid]||{},images:a[e.runUuid]||{},color:s,pinned:e.pinned,pinnable:e.pinnable,metricsHistory:{},belongsToGroup:null===(o=e.runDateAndNestInfo)||void 0===o?void 0:o.belongsToGroup,hidden:e.hidden}},Ti=e=>{let{isLoading:t,comparedRuns:n,metricKeyList:i,paramKeyList:o,experimentTags:l,compareRunCharts:d,compareRunSections:p,groupBy:m,autoRefreshEnabled:g}=e;const h=(0,Wn.e)(),f=(0,va.LE)(),v=(0,_i.g_)(),{paramsByRunUuid:y,latestMetricsByRunUuid:b,tagsByRunUuid:w,imagesByRunUuid:C}=(0,s.d4)((e=>({paramsByRunUuid:e.entities.paramsByRunUuid,latestMetricsByRunUuid:e.entities.latestMetricsByRunUuid,tagsByRunUuid:e.entities.tagsByRunUuid,imagesByRunUuid:e.entities.imagesByRunUuid}))),{theme:Y}=(0,u.u)(),[S,A]=(0,a.useState)(!1),[R,_]=(0,a.useState)(null),[I,M]=(0,a.useState)(""),{formatMessage:k}=(0,Ie.A)(),E=(0,a.useMemo)((()=>(0,or.Zp)(m)),[m]),[T,D]=(0,a.useState)(void 0),F=(0,a.useCallback)((e=>{_(e)}),[]);(0,a.useEffect)((()=>{S||t||A(!0)}),[S,t]);const L=(0,a.useMemo)((()=>{const e=l[Ct.S0],t=l[Ct.Q4];return(null===e||void 0===e?void 0:e.value)||(null===t||void 0===t?void 0:t.value)||i[0]||""}),[l,i]),P=(0,a.useMemo)((()=>{if(!m)return n.filter((e=>e.runInfo)).filter((e=>(0,ne.M1)()||!e.hidden)).map((e=>Ei(e,b,y,w,C,f(e.runUuid))));const e=n.filter((e=>(0,ne.M1)()||!e.hidden)).filter((e=>e.groupParentInfo&&!(0,or.mC)(e.groupParentInfo))).map((e=>{var t;return((e,t)=>{var n,r,a;const s=null!==(n=e.groupParentInfo)&&void 0!==n&&n.aggregatedMetricData?(0,V.keyBy)((0,V.values)(null===(r=e.groupParentInfo)||void 0===r?void 0:r.aggregatedMetricData).map((e=>{let{key:t,value:n,maxStep:r}=e;return{key:t,value:n,step:r,timestamp:0}})),"key"):{};return{uuid:e.rowUuid,displayName:(0,or.QD)(e.groupParentInfo),groupParentInfo:e.groupParentInfo,metrics:s,params:(null===(a=e.groupParentInfo)||void 0===a?void 0:a.aggregatedParamData)||{},tags:{},images:{},color:t,pinned:e.pinned,pinnable:e.pinnable,metricsHistory:{},hidden:e.hidden}})(e,f(null===(t=e.groupParentInfo)||void 0===t?void 0:t.groupId))}));return[...e,...n.filter((e=>(0,ne.M1)()||!e.hidden)).filter((e=>{var t;return!e.groupParentInfo&&!(null!==(t=e.runDateAndNestInfo)&&void 0!==t&&t.belongsToGroup)})).map((e=>Ei(e,b,y,w,C,f(e.runUuid))))]}),[m,n,b,y,w,C,f]),B=P.filter((e=>!e.hidden&&e.tags[Ct.Cr]));(0,Mi.L)({runUuids:B.map((e=>e.uuid)),runUuidsIsActive:B.map((e=>{var t;return"RUNNING"===(null===(t=e.runInfo)||void 0===t?void 0:t.status)})),enabled:(0,ne.HW)(),autoRefreshEnabled:g}),(0,a.useEffect)((()=>{if((!p||!d)&&P.length>0){const{resultChartSet:e,resultSectionSet:t}=Ci.i$.getBaseChartAndSectionConfigs({primaryMetricKey:L,runsData:P,useParallelCoordinatesChart:!0});v((n=>({...n,compareRunCharts:e,compareRunSections:t})))}}),[d,p,L,P,v]),(0,a.useEffect)((()=>{v((e=>{if(!e.compareRunCharts||!e.compareRunSections)return e;const{resultChartSet:t,resultSectionSet:n,isResultUpdated:r}=Ci.i$.updateChartAndSectionConfigs({compareRunCharts:e.compareRunCharts,compareRunSections:e.compareRunSections,runsData:P,isAccordionReordered:e.isAccordionReordered});return r?{...e,compareRunCharts:t,compareRunSections:n}:e}))}),[P,v]);const N=(0,a.useCallback)((e=>{h((t=>({...t,runsPinned:t.runsPinned.includes(e)?t.runsPinned.filter((t=>t!==e)):[...t.runsPinned,e]})))}),[h]),H=gs(n),O=(0,a.useCallback)((e=>{(0,ne.M1)()?H(Qr.oy.CUSTOM,e):h((t=>({...t,runsHidden:[...t.runsHidden,e]})))}),[h,H]),U=(0,_i.Ez)(),K=(0,_i.KP)(),z=(0,_i.iO)(),G=(0,_i.cA)(),q=(0,a.useMemo)((()=>({runs:P,onTogglePin:N,onHideRun:O})),[P,O,N]);return S?(0,x.FD)("div",{css:(0,r.AH)({flex:1,borderTop:`1px solid ${Y.colors.border}`,borderLeft:`1px solid ${Y.colors.border}`,marginLeft:-1,position:"relative",backgroundColor:Y.colors.backgroundSecondary,paddingLeft:Y.spacing.md,paddingRight:Y.spacing.md,paddingBottom:Y.spacing.md,zIndex:1,overflowY:"auto",minWidth:320},""),"data-testid":"experiment-view-compare-runs-chart-area",children:[(0,x.Y)("div",{css:(0,r.AH)({paddingTop:Y.spacing.sm,paddingBottom:Y.spacing.sm},""),children:(0,x.Y)(c.pde,{role:"searchbox",prefix:(0,x.Y)(c.WIv,{}),value:I,allowClear:!0,onChange:e=>M(e.target.value),placeholder:k({id:"Xs1oJm",defaultMessage:"Search metric charts"})})}),(0,x.Y)(Ai.W,{contextData:q,component:Si.X,children:(0,x.Y)(ki.G,{children:(0,x.Y)(Ri.J,{compareRunSections:p,compareRunCharts:d,reorderCharts:z,insertCharts:G,chartData:P,startEditChart:F,removeChart:K,addNewChartCard:e=>t=>{_(Ci.i$.getEmptyChartCardByType(t,!1,void 0,e))},search:I,groupBy:E,setFullScreenChart:D,autoRefreshEnabled:g})})}),R&&(0,x.Y)(Yi.z,{chartRunData:P,metricKeyList:i,paramKeyList:o,config:R,onSubmit:e=>{U(e),_(null)},onCancel:()=>_(null),groupBy:E}),(0,x.Y)(Ii._,{fullScreenChart:T,onCancel:()=>D(void 0),chartData:P,groupBy:E,tooltipContextValue:q,tooltipComponent:Si.X,autoRefreshEnabled:g})]}):(0,x.Y)("div",{css:(0,r.AH)({flex:1,borderTop:`1px solid ${Y.colors.border}`,borderLeft:`1px solid ${Y.colors.border}`,marginLeft:-1,position:"relative",backgroundColor:Y.colors.backgroundSecondary,paddingLeft:Y.spacing.md,paddingRight:Y.spacing.md,paddingBottom:Y.spacing.md,zIndex:1,overflowY:"auto"},""),children:(0,x.Y)(c.PLz,{})})},Di=e=>{const t=(0,Wn.e)(),n=(0,a.useCallback)((e=>{t((t=>({...t,...e(t)})))}),[t]);return(0,x.Y)(_i.oB,{updateChartsUIState:n,children:(0,x.Y)(Ti,{...e})})};var Fi=n(4972),Li=n(15230);var Pi={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},Bi={name:"5ob2ly",styles:"display:flex;position:relative"};const Ni=e=>{let{runListHidden:t,width:n,onResize:s,children:i}=e;const o=(0,Wn.e)(),[l,d]=(0,a.useState)(!1);return(0,x.FD)(x.FK,{children:[(0,x.Y)(Li.ResizableBox,{css:Bi,style:{flex:`0 0 ${t?0:n}px`},width:n,axis:"x",resizeHandles:["e"],minConstraints:[250,0],handle:(0,x.Y)(Hi,{runListHidden:t,updateRunListHidden:e=>{o((t=>({...t,runListHidden:e})))}}),onResize:(e,n)=>{let{size:r}=n;t||s(r.width)},onResizeStart:()=>!t&&d(!0),onResizeStop:()=>d(!1),children:i}),l&&(0,x.Y)(r.mL,{styles:Pi})]})},Hi=a.forwardRef(((e,t)=>{let{updateRunListHidden:n,runListHidden:a,...s}=e;const{theme:i}=(0,u.u)();return(0,x.FD)("div",{ref:t,...s,css:(0,r.AH)({transition:"opacity 0.2s",width:0,overflow:"visible",height:"100%",position:"relative",zIndex:10,display:"flex",opacity:a?1:0,"&:hover":{opacity:1,".bar":{opacity:1},".button":{border:`2px solid ${i.colors.actionDefaultBorderHover}`}}},""),children:[(0,x.Y)("div",{css:(0,r.AH)({position:"absolute",left:-i.general.iconSize/2,width:i.general.iconSize,cursor:a?void 0:"ew-resize",height:"100%",top:0,bottom:0},""),children:(0,x.Y)("div",{className:"button",css:(0,r.AH)({top:"50%",transition:"border-color 0.2s",position:"absolute",width:i.general.iconSize,height:i.general.iconSize,backgroundColor:i.colors.backgroundPrimary,borderRadius:i.general.iconSize,overflow:"hidden",border:`1px solid ${i.colors.border}`,display:"flex",alignItems:"center",justifyContent:"center",zIndex:11},""),children:(0,x.Y)(u.B,{componentId:"mlflow.experiment_page.table_resizer.collapse",onClick:()=>n(!a),icon:a?(0,x.Y)(c.vKP,{}):(0,x.Y)(c.YJP,{}),size:"small"})})}),(0,x.Y)("div",{className:"bar",css:(0,r.AH)({position:"absolute",opacity:0,left:-1.5,width:3,height:"100%",top:0,bottom:0,backgroundColor:i.colors.actionPrimaryBackgroundDefault},"")})]})})),Oi=()=>{const e=new Date;return e.setMilliseconds(0),e},Ui=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,ne.Zt)()?{display:"flex"}:{display:"grid",gridTemplateColumns:e?t?"10px 1fr":"295px 1fr":"1fr"}},Ki=a.memo((e=>{var t;const[n]=se(),{experiments:r,runsData:i,uiState:o,searchFacetsState:l,isLoadingRuns:d,loadMoreRuns:u,moreRunsAvailable:p,requestError:m,refreshRuns:g}=e,[h,f]=(0,a.useState)(new ys),{experimentId:v}=r[0],y=ee(v),[b,w]=(0,a.useState)("true"===y.getItem("expandRows"));(0,a.useEffect)((()=>{y.setItem("expandRows",b)}),[b,y]);const{paramKeyList:C,metricKeyList:Y,tagsList:S,paramsList:A,metricsList:R,runInfos:_,runUuidsMatchingFilter:I,datasetsList:M}=i,k=(0,s.d4)((e=>{let{entities:t}=e;return t.modelVersionsByRunUuid})),T=(0,a.useMemo)((()=>_.map(((e,t)=>({runInfo:e,params:A[t],metrics:R[t],tags:S[t],datasets:M[t]})))),[M,R,A,_,S]),{orderByKey:D,searchFilter:F}=l,{runsPinned:L,runsExpanded:P,runsHidden:B,runListHidden:N}=o,H="TABLE"!==n,O=(0,a.useCallback)((e=>f((t=>({...t,...e})))),[]),U=(0,a.useCallback)((()=>{O({columnSelectorVisible:!0})}),[O]),K=(0,a.useMemo)((()=>!D&&!F||D===Ct.T8.DATE),[D,F]),[z,V]=(0,a.useState)(Oi);(0,a.useEffect)((()=>{V(Oi)}),[_]);const G=(0,a.useMemo)((()=>E.A.getVisibleTagKeyList(S)),[S]),[q,$]=(0,a.useState)(!1),[W,j]=(0,a.useState)(),Q=(0,xs.ZU)({experiments:r,paramKeyList:C,metricKeyList:Y,modelVersionsByRunUuid:k,runsExpanded:P,tagKeyList:G,nestChildren:K,referenceTime:z,runData:T,runUuidsMatchingFilter:I,runsPinned:L,runsHidden:B,groupBy:o.groupBy,groupsExpanded:o.groupsExpanded,runsHiddenMode:o.runsHiddenMode,useGroupedValuesInCharts:o.useGroupedValuesInCharts}),[J,X]=(0,c.oL1)(),Z=ws(J),[te,re]=(0,a.useState)(295),ae=(0,a.useCallback)((()=>{p&&!d&&u().then((e=>{Z(e,_)}))}),[p,d,u,_,Z]),ie=(0,a.useCallback)(((e,t)=>{j({datasetWithTags:e,runData:t}),$(!0)}),[]),oe=(0,Fi.$)(),le=o.autoRefreshEnabled&&(0,ne.Hn)()&&oe,de=null===(t=o.useGroupedValuesInCharts)||void 0===t||t,ce=(0,x.Y)(fs,{experiments:r,runsData:i,searchFacetsState:l,viewState:h,isLoading:d,updateViewState:O,onAddColumnClicked:U,rowsData:Q,loadMoreRunsFunc:ae,moreRunsAvailable:p,onDatasetSelected:ie,expandRows:b,uiState:o,compareRunsMode:n});return(0,x.FD)(On,{visibleRuns:Q,refreshRuns:g,children:[(0,x.Y)(br,{viewState:h,updateViewState:O,runsData:i,searchFacetsState:l,experimentId:v,requestError:m,expandRows:b,updateExpandRows:w,refreshRuns:g,uiState:o,isLoading:d}),(0,x.FD)("div",{css:["min-height:225px;height:100%;position:relative;",Ui(H,N),""],children:[H&&(0,ne.Zt)()?(0,x.Y)(Ni,{onResize:re,runListHidden:N,width:te,children:ce}):ce,"CHART"===n&&(0,x.Y)(Di,{isLoading:d,comparedRuns:Q,metricKeyList:i.metricKeyList,paramKeyList:i.paramKeyList,experimentTags:i.experimentTags,compareRunCharts:o.compareRunCharts,compareRunSections:o.compareRunSections,groupBy:de?o.groupBy:null,autoRefreshEnabled:le}),"ARTIFACT"===n&&(0,x.Y)(wi,{comparedRuns:Q,viewState:h,updateViewState:O,onDatasetSelected:ie,disabled:Boolean(o.groupBy)}),X,W&&(0,x.Y)(Cs.O,{isOpen:q,setIsOpen:$,selectedDatasetWithRun:W,setSelectedDatasetWithRun:j})]})]})})),zi=()=>{const e=(0,a.useContext)(G);if(!e)throw new Error("Trying to use GetExperimentsContext actions outside of the context!");return e};function Vi(e){try{return Z.A.getStoreForComponent("ExperimentPage",e).loadComponentState()}catch{return E.A.logErrorAndNotifyUser(`Error: malformed persisted search state for experiment(s) ${e}`),{...(0,Qr.uY)(),...Kn()}}}const Gi=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=$n(),i=(0,a.useMemo)((()=>n?JSON.stringify(n.sort()):null),[n]);(0,a.useEffect)((()=>{if(!r&&!t){const e=i?Vi(i):null,t=(0,V.pick)({...Kn(),...e},Gn);s(t,{replace:!0})}}),[t,i,r]),(0,a.useEffect)((()=>{var n,a;t&&i&&!r&&(n={...t,...e},a=i,Z.A.getStoreForComponent("ExperimentPage",a).saveComponentState(n))}),[t,e,i,r])};var qi=n(85017);const $i=(e,t)=>{const{experiments:n}=t,r=t.experimentIds||n.map((e=>e.experimentId)),a=r.length>1,s=Object.values(e.entities.runInfosByUuid).filter((e=>{let{experimentId:t}=e;return r.includes(t)})).map((e=>{let{runUuid:t}=e;return t})),{modelVersionsByRunUuid:i,runUuidsMatchingFilter:o}=e.entities,l=((e,t,n)=>{let{lifecycleFilter:r=Rr.gy.ACTIVE,modelVersionFilter:a=Rr.EL.ALL_RUNS,datasetsFilter:s=[]}=n;const{modelVersionsByRunUuid:i}=t.entities;return e.map((e=>[(0,A.K4)(e,t),(0,A.jF)(e,t)])).filter((e=>{let[t,n]=e;return r===Rr.gy.ACTIVE?"active"===t.lifecycleStage:"deleted"===t.lifecycleStage})).filter((e=>{let[t,n]=e;return a===Rr.EL.ALL_RUNS||(a===Rr.EL.WITH_MODEL_VERSIONS?t.runUuid in i:a===Rr.EL.WTIHOUT_MODEL_VERSIONS?!(t.runUuid in i):(console.warn("Invalid input to model version filter - defaulting to showing all runs."),!0))})).filter((e=>{let[t,n]=e;return!s||0===s.length||!!n&&n.some((e=>{const t=e.dataset.name,n=e.dataset.digest,r=e.tags?e.tags.find((e=>"mlflow.data.context"===e.key)):void 0;return s.some((e=>{let{name:a,digest:s,context:i}=e;return a===t&&s===n&&(r?i===r.value:void 0===i)}))}))})).map((e=>{let[t,n]=e;return t}))})(s,e,t),d=new Set,c=new Set,u=l.map((t=>e.entities.runDatasetsByUuid[t.runUuid])),p=l.map((t=>{const n=(0,qi.d0)(t.runUuid,e),r=Object.values(n||{});return r.forEach((e=>{d.add(e.key)})),r})),m=l.map((t=>{const n=Object.values((0,A.tI)(t.runUuid,e));return n.forEach((e=>{c.add(e.key)})),n})),g=l.map((t=>(0,A.X3)(t.runUuid,e))),h=r[0];return{modelVersionsByRunUuid:i,experimentTags:a?{}:(0,A.xy)(h,e),runInfos:l,paramsList:m,tagsList:g,metricsList:p,runUuidsMatchingFilter:o,datasetsList:u,metricKeyList:Array.from(d.values()).sort(),paramKeyList:Array.from(c.values()).sort()}};var Wi=n(69708);const ji=(e,t,n)=>{if(!e||!t.length)return null;return{...Ir(t,{...e,runsPinned:n},Date.now()),requestedFacets:e}},Qi=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=(0,s.wA)(),[d,c]=(0,a.useState)((()=>Ji())),u=(0,a.useMemo)((()=>n?JSON.stringify(n.sort()):null),[n]),[p,m]=(0,a.useState)(!0),[g,h]=(0,a.useState)(!0),[f,v]=(0,a.useState)(null),[y,x]=(0,a.useState)(null),b=(0,a.useRef)([]),w=(0,a.useRef)(null),C=(0,a.useRef)(null);(0,a.useEffect)((()=>{r||(h(!0),c(Ji()))}),[u,r]);const Y=(0,a.useCallback)(((e,t,n)=>{c($i(e,{datasetsFilter:n.datasetsFilter,lifecycleFilter:n.lifecycleFilter,modelVersionFilter:n.modelVersionFilter,experiments:[],experimentIds:t}))}),[]);(0,a.useEffect)((()=>{b.current=e.runsPinned}),[e.runsPinned]);const S=(0,a.useCallback)((e=>{((e,t,n)=>{const r=e.filter((e=>e.data.tags.some((e=>e.key===It.tS))));(0,V.chunk)(r,Ar.SF).forEach((e=>{let r;const a=t({run_id:e.map((e=>e.info.run_id))},(0,l.yk)(),r);n(a)}))})(e||[],Wi.hY,o)}),[o]),A=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(((n,r)=>(t.isAutoRefreshing||(m(!0),C.current=e),n((e.pageToken?i.e$:i.bn)(e)).then((async n=>{var a;let{value:s}=n;return v(s.next_page_token||null),w.current=Date.now(),m(!1),h(!1),C.current&&null!==(a=t.discardResultsFn)&&void 0!==a&&a.call(t,C.current)||(Y(r(),e.experimentIds,e.requestedFacets),S(s.runs||[])),s})).catch((e=>{m(!1),h(!1),x(e),E.A.logErrorAndNotifyUser(e)})))))}),[o,Y,S]);(0,a.useEffect)((()=>{if(r)return;const e=ji(t,n,b.current);e&&A(e)}),[A,o,r,t,n]);return(e=>{let{experimentIds:t,lastFetchedTime:n,fetchRuns:r,searchFacets:s,enabled:o,cachedPinnedRuns:l,runsData:d,isLoadingRuns:c}=e;const u=(0,a.useRef)(void 0),p=(0,a.useRef)(c),m=(0,a.useRef)(o),g=(0,a.useRef)(d.runInfos);g.current=d.runInfos,p.current=c,m.current=o,(0,a.useEffect)((()=>{if(window.clearTimeout(u.current),!o||c)return;const e=async()=>{const a=Boolean(n.current),o=n.current?Date.now()-n.current:0;if(s&&a&&o>=3e4){const e=Math.ceil(g.current.length/i.Aj),n={...Ir(t,{...s,runsPinned:l.current},Date.now()),requestedFacets:s,maxResults:e*i.Aj};await r(n,{isAutoRefreshing:!0,discardResultsFn:t=>{const r=Math.ceil(g.current.length/i.Aj);return!m.current||r!==e||!(0,V.isEqual)(t.requestedFacets,n.requestedFacets)}})}window.clearTimeout(u.current),m.current&&(u.current=window.setTimeout(e,3e4))};return e(),()=>{clearTimeout(u.current)}}),[t,r,s,o,l,n,c])})({experimentIds:n,fetchRuns:A,searchFacets:t,enabled:e.autoRefreshEnabled&&(0,ne.Hn)(),cachedPinnedRuns:b,runsData:d,isLoadingRuns:p,lastFetchedTime:w}),{isLoadingRuns:p,moreRunsAvailable:Boolean(f),refreshRuns:()=>{const e=ji(t,n,b.current);e&&A(e)},loadMoreRuns:async()=>{const e=ji(t,n,b.current);return f&&e?A({...e,pageToken:f}):[]},isInitialLoadingRuns:g,runsData:d,requestError:y}},Ji=()=>({datasetsList:[],experimentTags:{},metricKeyList:[],metricsList:[],modelVersionsByRunUuid:{},paramKeyList:[],paramsList:[],runInfos:[],runUuidsMatchingFilter:[],tagsList:[]}),Xi=[(e,t,n)=>{const r=n.runInfos.filter(((e,t)=>{var r,a;return(null===(r=n.tagsList[t])||void 0===r||null===(a=r[Ct.yU])||void 0===a?void 0:a.value)===Ct.m4})).map((e=>{let{runUuid:t}=e;return t})),a=(0,V.compact)(n.runInfos.map(((e,t)=>{var a;let{runUuid:s}=e;return r.includes(s)&&(null===(a=n.tagsList[t])||void 0===a?void 0:a[It.Ol].value)})));return a.length?{...t,runsExpanded:a.reduce(((e,t)=>({...e,[t]:!0})),t.runsExpanded)}:t}],Zi=(0,Qr.uY)();var eo=n(56928),to=n(75703),no=n(11473);const ro=[["header","bold","italic","strikethrough"],["link","code","image"],["unordered-list","ordered-list"]],ao=(0,no.T7)(),so=e=>{if(e){const t=(0,no.NW)(ao.makeHtml(e));return(0,no.Yc)(t)}return null},io=e=>{let{experiment:t,editing:n,setEditing:i,setShowAddDescriptionButton:o}=e;const l=(0,s.d4)((e=>{const n=(0,A.xy)(t.experimentId,e);return n?(e=>{var t;return(null===(t=Object.values(e).find((e=>e.key===eo.e)))||void 0===t?void 0:t.value)||void 0})(n):""}));o(!l);const[d,p]=(0,a.useState)(l),[m,g]=(0,a.useState)("write"),[h,f]=(0,a.useState)(!1),{theme:v}=(0,u.u)(),y=16+2*v.spacing.sm,{actions:{setExperimentTagApi:b}}=zi(),w=(0,s.wA)(),C=(0,a.useCallback)((e=>{i(!1),o(!e);const n=b(t.experimentId,eo.e,e);w(n)}),[t.experimentId,b,w,i,o]);return(0,x.FD)("div",{children:[d&&(0,x.FD)("div",{style:{whiteSpace:h?"normal":"pre",lineHeight:v.typography.lineHeightSm,background:v.colors.backgroundSecondary,display:"flex",alignItems:"flex-start",padding:v.spacing.xs},children:[(0,x.Y)("div",{style:{flexGrow:1,marginRight:12,overflow:"hidden",overflowWrap:h?"break-word":void 0,padding:`${v.spacing.sm}px 12px`,maxHeight:h?"none":y+"px"},children:(0,x.Y)("div",{dangerouslySetInnerHTML:{__html:so(d)}})}),(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_experimentviewdescriptionnotes.tsx_114",icon:(0,x.Y)(c.R2l,{}),onClick:()=>i(!0),style:{padding:`0px ${v.spacing.sm}px`}}),h?(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_experimentviewdescriptionnotes.tsx_120",icon:(0,x.Y)(c.Mtm,{}),onClick:()=>f(!1),style:{padding:`0px ${v.spacing.sm}px`}}):(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_experimentviewdescriptionnotes.tsx_126",icon:(0,x.Y)(c.D3D,{}),onClick:()=>f(!0),style:{padding:`0px ${v.spacing.sm}px`}})]}),(0,x.Y)(J.M,{title:(0,x.Y)(X.A,{id:"Vkr4Bs",defaultMessage:"Add description"}),visible:n,okText:(0,x.Y)(X.A,{id:"xUnYdk",defaultMessage:"Save"}),cancelText:(0,x.Y)(X.A,{id:"757GVc",defaultMessage:"Cancel"}),onOk:()=>{C(d),i(!1)},onCancel:()=>{p(l),i(!1)},children:(0,x.Y)(a.Fragment,{children:(0,x.Y)(to.default,{value:d,minEditorHeight:200,maxEditorHeight:500,minPreviewHeight:20,toolbarCommands:ro,onChange:e=>p(e),selectedTab:m,onTabChange:e=>g(e),generateMarkdownPreview:()=>Promise.resolve(so(d)),getIcon:e=>(0,x.Y)(c.m_M,{title:e,children:(0,x.Y)("span",{css:(0,r.AH)({color:v.colors.textPrimary},""),children:(0,x.Y)(to.SvgIcon,{icon:e})})})})})})]})},oo=e=>{let{experiment:t,size:n}=e;const r=(0,Ie.A)();return(0,x.Y)(u.T.Text,{size:n,dangerouslySetAntdProps:{copyable:{text:t.name,icon:(0,x.Y)(c.TdU,{}),tooltips:[r.formatMessage({id:"A7R0ii",defaultMessage:"Copy path"}),r.formatMessage({id:"JCboZ7",defaultMessage:"Path copied"})]}}})},lo=e=>{let{artifactLocation:t}=e;return(0,x.Y)(x.FK,{children:t})},co=e=>{let{experiment:t}=e;const n=(0,Ie.A)();return(0,x.Y)(u.T.Text,{size:"md",dangerouslySetAntdProps:{copyable:{text:t.experimentId,icon:(0,x.Y)(c.TdU,{}),tooltips:[n.formatMessage({id:"rytnce",defaultMessage:"Copy experiment id"}),n.formatMessage({id:"qH2cN+",defaultMessage:"Experiment id copied"})]}}})},uo=e=>{let{experiment:t}=e;const n=(0,Ie.A)();return(0,x.Y)(u.T.Text,{size:"md",dangerouslySetAntdProps:{copyable:{text:t.artifactLocation,icon:(0,x.Y)(c.TdU,{}),tooltips:[n.formatMessage({id:"cSSMIs",defaultMessage:"Copy artifact location"}),n.formatMessage({id:"5aZ7nE",defaultMessage:"Artifact location copied"})]}}})};var po={name:"1re1v0d",styles:"display:flex;flex-direction:column;flex-wrap:nowrap"};const mo=a.memo((e=>{let{experiment:t,searchFacetsState:n,uiState:s,showAddDescriptionButton:i,setEditing:o}=e;const l=(0,a.useMemo)((()=>t?[null===t||void 0===t?void 0:t.experimentId]:[]),[t]),{theme:d}=(0,u.u)(),p=(0,a.useMemo)((()=>t.name.split("/").pop()),[t.name]),m=Ct.Cm;return(0,x.Y)(ft.z,{title:(0,x.Y)("div",{css:(0,r.AH)({[d.responsive.mediaQueries.xs]:{display:"inline",wordBreak:"break-all"},[d.responsive.mediaQueries.sm]:{display:"inline-block",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"70%",textOverflow:"ellipsis",verticalAlign:"middle"}},""),children:p}),titleAddOns:(0,x.FD)(x.FK,{children:[(0,x.Y)("div",{style:{display:"flex"},children:(0,x.Y)(c.m_M,{placement:"bottomLeft",dangerouslySetAntdProps:{overlayStyle:{maxWidth:"none"}},arrowPointAtCenter:!0,title:(0,x.FD)("div",{css:po,"data-testid":"experiment-view-header-info-tooltip-content",children:[(0,x.FD)("div",{style:{whiteSpace:"nowrap"},children:[(0,x.Y)(X.A,{id:"F8MqzZ",defaultMessage:"Path"}),": ",t.name+" ",(0,x.Y)(oo,{experiment:t,size:"md"})]}),(0,x.FD)("div",{style:{whiteSpace:"nowrap"},children:[(0,x.Y)(X.A,{id:"PZGZHV",defaultMessage:"Experiment ID"}),": ",t.experimentId+" ",(0,x.Y)(co,{experiment:t})]}),(0,x.FD)("div",{style:{whiteSpace:"nowrap"},children:[(0,x.Y)(X.A,{id:"8/7V3S",defaultMessage:"Artifact Location"}),": ",(0,x.Y)(lo,{artifactLocation:t.artifactLocation})," ",(0,x.Y)(uo,{experiment:t})]})]}),children:(0,x.Y)(u.B,{size:"small",type:"link",componentId:"mlflow.experiment_page.header.info_tooltip",icon:(0,x.Y)(c.mo0,{css:(0,r.AH)({color:d.colors.textSecondary},"")}),"data-testid":"experiment-view-header-info-tooltip","aria-label":"Info"})})}),m&&(0,x.Y)(u.B,{href:m,target:"_blank",rel:"noreferrer",componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_header_experimentviewheaderv2.tsx_100",css:(0,r.AH)({marginLeft:d.spacing.sm},""),type:"link",size:"small",endIcon:(0,x.Y)(u.X,{}),children:(0,x.Y)(X.A,{id:"d78wwA",defaultMessage:"Provide Feedback"})}),i&&(0,x.Y)(u.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_header_experimentviewheaderv2.tsx_271",size:"small",onClick:()=>{o(!0)},css:(0,r.AH)({marginLeft:d.spacing.sm,background:`${d.colors.backgroundSecondary} !important`,border:"none"},""),children:(0,x.Y)(u.T.Text,{size:"md",children:"Add Description"})})]}),breadcrumbs:[],spacerSize:"sm",children:(0,x.Y)(Rt,{experimentIds:l,searchFacetsState:n,uiState:s})})}));var go={name:"1h8i7is",styles:"overflow-y:hidden;flex-shrink:0;transition:max-height .12s"};const ho=()=>{const e=(0,s.wA)(),[t,n]=qn(),[r]=se(),l=(d=n,(0,s.d4)((e=>d.map((t=>e.entities.experimentsById[t])).filter(Boolean)),((e,t)=>(0,V.isEqual)(e,t))));var d;const[u]=l,{fetchExperiments:p,isLoadingExperiment:m,requestError:h}=zi(),{elementHeight:f,observeHeight:v}=(()=>{const[e,t]=(0,a.useState)(null),[n,r]=(0,a.useState)(void 0);return(0,a.useEffect)((()=>{if(!e||!window.ResizeObserver)return;const t=new ResizeObserver((e=>{let[t]=e;t.target.scrollHeight&&r(t.target.scrollHeight)}));return t.observe(e),()=>t.disconnect()}),[e]),{elementHeight:n,observeHeight:t}})(),[y,b]=(0,a.useState)(!1),[w,C]=(0,a.useState)(!0),[Y,S,A]=(e=>{const t=(0,a.useMemo)((()=>JSON.stringify(e.sort())),[e]),[{uiState:n,isFirstVisit:r},s]=($n(),(0,a.useReducer)(((e,t)=>{if("UPDATE_UI_STATE"===t.type){const n="function"===typeof t.payload?t.payload(e.uiState):t.payload;return{...e,uiState:n}}return"INITIAL_UI_STATE_SEEDED"===t.type?e.isFirstVisit?{...e,isFirstVisit:!1}:e:"LOAD_NEW_EXPERIMENT"===t.type?{uiState:t.payload.uiState,isFirstVisit:t.payload.isFirstVisit,currentPersistKey:t.payload.newPersistKey}:e}),void 0,(()=>{const e=Vi(t),n=(0,V.keys)(e||{}).length,r=n?(0,V.pick)(e,Qr.HC):{};return{uiState:{...Zi,...r},isFirstVisit:!n,currentPersistKey:t}}))),i=(0,a.useCallback)((e=>{s({type:"UPDATE_UI_STATE",payload:e})}),[]),o=(0,a.useCallback)(((e,t)=>{r&&0!==e.length&&0!==t.runInfos.length&&(s({type:"INITIAL_UI_STATE_SEEDED"}),i((n=>Xi.reduce(((n,r)=>r(e,n,t)),{...n}))))}),[r,i]);return(0,a.useEffect)((()=>{const e=Vi(t),n=(0,V.pick)(e,Qr.HC),r=!(0,V.keys)(e||{}).length;s({type:"LOAD_NEW_EXPERIMENT",payload:{uiState:{...Zi,...n},isFirstVisit:r,newPersistKey:t}})}),[t]),[n,i,o]})(n),{isViewStateShared:R}=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[r]=(0,o.ok)(),s=(0,Ie.A)(),i=r.get(Ct.ex),l=Boolean(i),d=$n(),{sharedSearchFacetsState:c,sharedUiState:u,sharedStateError:p,sharedStateErrorMessage:m}=(0,a.useMemo)((()=>{if(!i||!t)return{sharedSearchFacetsState:null,sharedUiState:null,sharedStateError:null,sharedStateErrorMessage:null};const e=t.tags.find((e=>{let{key:t}=e;return t===`${Ct.o6}${i}`}));if(e)try{const t=JSON.parse(e.value);return{sharedSearchFacetsState:(0,V.pick)(t,Gn),sharedUiState:(0,V.pick)(t,Qr.HC),sharedStateError:null,sharedStateErrorMessage:null}}catch(n){return{sharedSearchFacetsState:null,sharedUiState:null,sharedStateError:"Error loading shared view state: share key is invalid",sharedStateErrorMessage:s.formatMessage({id:"Isig6r",defaultMessage:"Error loading shared view state: share key is invalid"})}}return{sharedSearchFacetsState:null,sharedUiState:null,sharedStateError:`Error loading shared view state: share key ${i} does not exist`,sharedStateErrorMessage:s.formatMessage({id:"s2L+xL",defaultMessage:'Error loading shared view state: share key "{viewStateShareKey}" does not exist'},{viewStateShareKey:i})}}),[t,i,s]);(0,a.useEffect)((()=>{c&&!n&&d(c,{replace:!0})}),[c,n]),(0,a.useEffect)((()=>{u&&!n&&e(u)}),[e,u,n]);const h=(0,o.Zp)();return(0,a.useEffect)((()=>{n||p&&t&&(E.A.logErrorAndNotifyUser(new Error(p)),E.A.displayGlobalErrorNotification(m,3),h(g.h.getExperimentPageRoute(t.experimentId),{replace:!0}))}),[p,m,t,h,n]),{isViewStateShared:l,sharedStateError:p}}(S,(0,V.first)(l)),_=Y.viewMaximized,{isLoadingRuns:I,loadMoreRuns:M,runsData:k,moreRunsAvailable:T,requestError:D,refreshRuns:F}=Qi(Y,t,n);(0,a.useEffect)((()=>{p(n)}),[p,n]),(0,a.useEffect)((()=>{A(l,k)}),[A,l,k]),(0,a.useEffect)((()=>{const t=(0,i.wT)(n);e(t).catch((e=>{E.A.logErrorAndNotifyUser(e)}))}),[e,n]);const L=n.length>1;Gi(Y,t,n,R);if(!Boolean(!m&&l[0]&&k&&t))return(0,x.Y)(c.PLz,{});if(h&&h.getErrorCode()===$.tG.PERMISSION_DENIED)return(0,x.Y)(Q,{errorMessage:h.getMessageField()});if(h&&h.getErrorCode()===$.tG.RESOURCE_DOES_NOT_EXIST)return(0,x.Y)(W.A,{});nn()(t,"searchFacets should be initialized at this point");const P=m||!l[0];return(0,x.Y)(Wn.i,{setUIState:S,children:(0,x.FD)("div",{css:fo.experimentViewWrapper,children:[P?(0,x.Y)(c.PLz,{title:!0,paragraph:!1,active:!0}):(0,x.Y)(x.FK,{children:L?(0,x.Y)(_t,{experiments:l}):(0,x.FD)(x.FK,{children:[(0,x.Y)(mo,{experiment:u,searchFacetsState:t||void 0,uiState:Y,showAddDescriptionButton:w,setEditing:b}),(0,x.Y)("div",{style:{maxHeight:_?0:f},css:go,children:(0,x.Y)("div",{ref:v,children:(0,x.Y)(io,{experiment:u,setShowAddDescriptionButton:C,editing:y,setEditing:b})})})]})}),(0,ne.XK)()&&"TRACES"===r?(0,x.Y)(ht,{experimentIds:n}):(0,x.Y)(Ki,{isLoading:!1,experiments:l,isLoadingRuns:I,runsData:k,searchFacetsState:t,loadMoreRuns:M,moreRunsAvailable:T,requestError:D,refreshRuns:F,uiState:Y})]})})},fo={experimentViewWrapper:{height:"100%",display:"flex",flexDirection:"column"}};var vo=n.p+"static/media/no-experiments.0e4f4a114ef73e7d81c09474aba64b6c.svg";const yo=function(){const{theme:e}=(0,u.u)();return(0,x.FD)("div",{className:"center",children:[(0,x.Y)("img",{alt:"No experiments found.",style:{height:"200px",marginTop:"80px"},src:vo}),(0,x.Y)("h1",{style:{paddingTop:"10px"},children:"No Experiments Exist"}),(0,x.FD)("h2",{css:(0,r.AH)({color:e.colors.textSecondary},""),children:["To create an experiment use the ",(0,x.Y)("a",{href:$.d1,children:"mlflow experiments"})," CLI."]})]})};const xo={setExperimentTagApi:i.EJ,getExperimentApi:i.yc,setCompareExperiments:i.I_};var bo={name:"1ichkjj",styles:"height:100%;display:flex;justify-content:center;align-items:center"},wo={name:"1s36c6h",styles:"display:flex;height:calc(100% - 60px)"},Co={name:"tby1uk",styles:"height:100%;padding-top:24px;display:flex"};var Yo=()=>{const e=(0,s.wA)(),{theme:t}=(0,u.u)(),n=(0,a.useRef)((0,l.yk)()),c=(0,z.z)(),p=(0,s.d4)((e=>(0,V.values)(e.entities.experimentsById))),m=p.length>0;if((0,a.useEffect)((()=>{e((0,i.vF)(n.current))}),[e]),!c.length){const e=(e=>[...e].sort(E.A.compareExperiments).find((e=>{let{lifecycleStage:t}=e;return"active"===t})))(p);if(e)return(0,x.Y)(o.C5,{to:g.h.getExperimentPageRoute(e.experimentId),replace:!0})}const h=(0,x.Y)("div",{css:bo,children:(0,x.Y)(u.S,{size:"large"})});return(0,x.Y)(d.Ay,{requestIds:[n.current],customSpinner:h,children:(0,x.FD)("div",{css:wo,children:[(0,x.Y)("div",{css:Co,children:(0,x.Y)(K,{activeExperimentIds:c||[],experiments:p})}),(0,x.Y)("div",{css:(0,r.AH)({height:"100%",flex:1,padding:t.spacing.md,paddingTop:t.spacing.lg,minWidth:0},""),children:(0,x.Y)(q,{actions:xo,children:m?(0,x.Y)(ho,{}):(0,x.Y)(yo,{})})})]})})}}}]);
//# sourceMappingURL=221.16a24c8d.chunk.js.map