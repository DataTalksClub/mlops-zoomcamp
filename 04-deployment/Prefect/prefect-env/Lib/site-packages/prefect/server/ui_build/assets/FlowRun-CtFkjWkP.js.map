{"version":3,"file":"FlowRun-CtFkjWkP.js","sources":["../../src/components/FlowRunGraphs.vue","../../src/pages/FlowRun.vue"],"sourcesContent":["<template>\n  <div class=\"flow-run-graphs\" :class=\"classes.root\">\n    <div class=\"flow-run-graphs__graph-panel-container\">\n      <div class=\"flow-run-graphs__graphs\">\n        <FlowRunGraph\n          v-model:fullscreen=\"fullscreen\"\n          v-model:viewport=\"dateRange\"\n          v-model:selected=\"selection\"\n          :flow-run=\"flowRun\"\n          class=\"flow-run-graphs__flow-run\"\n        />\n      </div>\n      <div class=\"flow-run-graphs__panel p-background\">\n        <FlowRunGraphSelectionPanel\n          v-if=\"selection?.kind === 'task-run' || selection?.kind === 'flow-run'\"\n          v-model:selection=\"selection\"\n          :floating=\"fullscreen\"\n        />\n      </div>\n    </div>\n    <FlowRunGraphArtifactsPopover\n      v-if=\"selection && selection.kind === 'artifacts'\"\n      v-model:selection=\"selection\"\n    />\n    <FlowRunGraphStatePopover\n      v-if=\"selection?.kind === 'state'\"\n      v-model:selection=\"selection\"\n    />\n    <FlowRunGraphArtifactDrawer v-model:selection=\"selection\" />\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import {\n    FlowRunGraph,\n    RunGraphItemSelection,\n    RunGraphViewportDateRange,\n    FlowRun,\n    FlowRunGraphSelectionPanel,\n    FlowRunGraphArtifactDrawer,\n    FlowRunGraphArtifactsPopover,\n    FlowRunGraphStatePopover\n  } from '@prefecthq/prefect-ui-library'\n  import { computed, ref } from 'vue'\n\n  defineProps<{\n    flowRun: FlowRun,\n  }>()\n\n  const dateRange = ref<RunGraphViewportDateRange>()\n\n  const fullscreen = ref(false)\n  const selection = ref<RunGraphItemSelection | null>(null)\n\n  const classes = computed(() => {\n    return {\n      root: {\n        'flow-run-graphs--fullscreen': fullscreen.value,\n        'flow-run-graphs--show-panel': Boolean(\n          selection.value?.kind === 'task-run'\n            || selection.value?.kind === 'flow-run',\n        ),\n      },\n    }\n  })\n</script>\n\n<style>\n.flow-run-graphs { @apply\n  relative;\n  --flow-run-graphs-panel-width: 320px;\n}\n\n.flow-run-graphs__graph-panel-container { @apply\n  relative\n  grid\n  grid-cols-1\n  gap-2\n  overflow-hidden\n}\n\n.flow-run-graphs--fullscreen { @apply\n  z-20\n  static\n}\n\n.flow-run-graphs__graphs { @apply\n  transition-[width];\n  width: 100%;\n}\n\n.flow-run-graphs--show-panel .flow-run-graphs__graphs {\n  width: calc(100% - var(--flow-run-graphs-panel-width) - theme(spacing.2));\n}\n\n.flow-run-graphs__flow-run { @apply\n  overflow-hidden\n  rounded\n}\n\n.flow-run-graphs__panel { @apply\n  absolute\n  right-0\n  top-0\n  bottom-0\n  translate-x-full\n  transition-transform\n  rounded;\n  width: var(--flow-run-graphs-panel-width)\n}\n\n.flow-run-graphs--fullscreen .flow-run-graphs__panel { @apply\n  top-4\n  right-4\n  bottom-auto\n}\n\n.flow-run-graphs--show-panel .flow-run-graphs__panel { @apply\n  translate-x-0\n}\n</style>\n","<template>\n  <p-layout-default class=\"flow-run\">\n    <template #header>\n      <PageHeadingFlowRun v-if=\"flowRun\" :flow-run-id=\"flowRun.id\" @delete=\"goToFlowRuns\" />\n    </template>\n\n    <FlowRunGraphs v-if=\"flowRun && !isPending\" :flow-run=\"flowRun\" />\n\n    <p-tabs v-model:selected=\"tab\" :tabs=\"tabs\">\n      <template #details>\n        <FlowRunDetails v-if=\"flowRun\" :flow-run=\"flowRun\" />\n      </template>\n\n      <template #logs>\n        <FlowRunLogs v-if=\"flowRun\" :flow-run=\"flowRun\" />\n      </template>\n\n      <template #results>\n        <FlowRunResults v-if=\"flowRun\" :flow-run=\"flowRun\" />\n      </template>\n\n      <template #artifacts>\n        <FlowRunArtifacts v-if=\"flowRun\" :flow-run=\"flowRun\" />\n      </template>\n\n      <template #task-runs>\n        <FlowRunTaskRuns v-if=\"flowRun\" :flow-run-id=\"flowRun.id\" />\n      </template>\n\n      <template #subflow-runs>\n        <FlowRunFilteredList :filter=\"subflowsFilter\" />\n      </template>\n\n      <template #parameters>\n        <CopyableWrapper v-if=\"flowRun\" :text-to-copy=\"parameters\">\n          <p-code-highlight lang=\"json\" :text=\"parameters\" class=\"flow-run__parameters\" />\n        </CopyableWrapper>\n      </template>\n\n      <template #job-variables>\n        <CopyableWrapper v-if=\"flowRun\" :text-to-copy=\"jobVariables\">\n          <p-code-highlight lang=\"json\" :text=\"jobVariables\" class=\"flow-run__job-variables\" />\n        </CopyableWrapper>\n      </template>\n    </p-tabs>\n  </p-layout-default>\n</template>\n\n<script lang=\"ts\" setup>\n  import {\n    PageHeadingFlowRun,\n    FlowRunArtifacts,\n    FlowRunDetails,\n    FlowRunLogs,\n    FlowRunTaskRuns,\n    FlowRunResults,\n    FlowRunFilteredList,\n    useFavicon,\n    useDeployment,\n    getSchemaValuesWithDefaultsJson,\n    CopyableWrapper,\n    isPendingStateType,\n    useTabs,\n    httpStatus,\n    useFlowRun,\n    useFlowRunsFilter,\n    stringify\n  } from '@prefecthq/prefect-ui-library'\n  import { useRouteParam, useRouteQueryParam } from '@prefecthq/vue-compositions'\n  import { computed, watchEffect } from 'vue'\n  import { useRouter } from 'vue-router'\n  import FlowRunGraphs from '@/components/FlowRunGraphs.vue'\n  import { useCan } from '@/compositions/useCan'\n  import { usePageTitle } from '@/compositions/usePageTitle'\n  import { routes } from '@/router'\n\n  const can = useCan()\n\n  const router = useRouter()\n  const flowRunId = useRouteParam('flowRunId')\n\n  const { flowRun, subscription: flowRunSubscription } = useFlowRun(flowRunId, { interval: 5000 })\n  const deploymentId = computed(() => flowRun.value?.deploymentId)\n  const { deployment } = useDeployment(deploymentId)\n\n  const isPending = computed(() => {\n    return flowRun.value?.stateType ? isPendingStateType(flowRun.value.stateType) : true\n  })\n\n  const jobVariables = computed(() => stringify(flowRun.value?.jobVariables ?? {}))\n\n  const computedTabs = computed(() => [\n    { label: 'Logs' },\n    { label: 'Task Runs', hidden: isPending.value },\n    { label: 'Subflow Runs', hidden: isPending.value },\n    { label: 'Results', hidden: isPending.value },\n    { label: 'Artifacts', hidden: isPending.value },\n    { label: 'Details' },\n    { label: 'Parameters' },\n    { label: 'Job Variables', hidden: !can.access.flowRunInfraOverrides },\n  ])\n  const tab = useRouteQueryParam('tab', 'Logs')\n  const { tabs } = useTabs(computedTabs, tab)\n\n  const flowRunParameters = computed(() => flowRun.value?.parameters ?? {})\n  const deploymentSchema = computed(() => deployment.value?.parameterOpenApiSchema ?? {})\n  const parameters = computed(() => getSchemaValuesWithDefaultsJson(flowRunParameters.value, deploymentSchema.value))\n\n\n  const parentFlowRunIds = computed(() => [flowRunId.value])\n  const { filter: subflowsFilter } = useFlowRunsFilter({\n    flowRuns: {\n      parentFlowRunId: parentFlowRunIds,\n    },\n  })\n\n  function goToFlowRuns(): void {\n    router.push(routes.flowRuns())\n  }\n\n  const stateType = computed(() => flowRun.value?.stateType)\n  useFavicon(stateType)\n\n  const title = computed(() => {\n    if (!flowRun.value) {\n      return 'Flow Run'\n    }\n    return `Flow Run: ${flowRun.value.name}`\n  })\n  usePageTitle(title)\n\n  watchEffect(() => {\n    if (flowRunSubscription.error) {\n      const status = httpStatus(flowRunSubscription.error)\n\n      if (status.isInRange('clientError')) {\n        router.replace(routes[404]())\n      }\n    }\n  })\n</script>\n\n<style>\n.flow-run { @apply\n  items-start\n}\n\n.flow-run__logs { @apply\n  max-h-screen\n}\n\n.flow-run__header-meta { @apply\n  flex\n  gap-2\n  items-center\n  xl:hidden\n}\n\n.flow-run__job-variables,\n.flow-run__parameters { @apply\n  px-4\n  py-3\n}\n</style>\n"],"names":["dateRange","ref","fullscreen","selection","classes","computed","_a","_b","can","useCan","router","useRouter","flowRunId","useRouteParam","flowRun","flowRunSubscription","useFlowRun","deploymentId","deployment","useDeployment","isPending","isPendingStateType","jobVariables","stringify","computedTabs","tab","useRouteQueryParam","tabs","useTabs","flowRunParameters","deploymentSchema","parameters","getSchemaValuesWithDefaultsJson","parentFlowRunIds","subflowsFilter","useFlowRunsFilter","goToFlowRuns","routes","stateType","useFavicon","title","usePageTitle","watchEffect","httpStatus"],"mappings":"kmBAiDE,MAAMA,EAAYC,IAEZC,EAAaD,EAAI,EAAK,EACtBE,EAAYF,EAAkC,IAAI,EAElDG,EAAUC,EAAS,IAAM,SACtB,MAAA,CACL,KAAM,CACJ,8BAA+BH,EAAW,MAC1C,gCACEI,EAAAH,EAAU,QAAV,YAAAG,EAAiB,QAAS,cACrBC,EAAAJ,EAAU,QAAV,YAAAI,EAAiB,QAAS,UAEnC,CAAA,CACF,CACD,+mCCYD,MAAMC,EAAMC,IAENC,EAASC,KACTC,EAAYC,EAAc,WAAW,EAErC,CAAE,QAAAC,EAAS,aAAcC,CAAoB,EAAIC,EAAWJ,EAAW,CAAE,SAAU,GAAA,CAAM,EACzFK,EAAeZ,EAAS,IAAA,OAAM,OAAAC,EAAAQ,EAAQ,QAAR,YAAAR,EAAe,aAAY,EACzD,CAAE,WAAAY,CAAA,EAAeC,EAAcF,CAAY,EAE3CG,EAAYf,EAAS,IAAM,OAC/B,OAAOC,EAAAQ,EAAQ,QAAR,MAAAR,EAAe,UAAYe,GAAmBP,EAAQ,MAAM,SAAS,EAAI,EAAA,CACjF,EAEKQ,EAAejB,EAAS,WAAMkB,OAAAA,KAAUjB,EAAAQ,EAAQ,QAAR,YAAAR,EAAe,eAAgB,CAAE,CAAA,EAAC,EAE1EkB,EAAenB,EAAS,IAAM,CAClC,CAAE,MAAO,MAAO,EAChB,CAAE,MAAO,YAAa,OAAQe,EAAU,KAAM,EAC9C,CAAE,MAAO,eAAgB,OAAQA,EAAU,KAAM,EACjD,CAAE,MAAO,UAAW,OAAQA,EAAU,KAAM,EAC5C,CAAE,MAAO,YAAa,OAAQA,EAAU,KAAM,EAC9C,CAAE,MAAO,SAAU,EACnB,CAAE,MAAO,YAAa,EACtB,CAAE,MAAO,gBAAiB,OAAQ,CAACZ,EAAI,OAAO,qBAAsB,CAAA,CACrE,EACKiB,EAAMC,EAAmB,MAAO,MAAM,EACtC,CAAE,KAAAC,CAAS,EAAAC,EAAQJ,EAAcC,CAAG,EAEpCI,EAAoBxB,EAAS,IAAM,OAAA,QAAAC,EAAAQ,EAAQ,QAAR,YAAAR,EAAe,aAAc,CAAA,EAAE,EAClEwB,EAAmBzB,EAAS,IAAM,OAAA,QAAAC,EAAAY,EAAW,QAAX,YAAAZ,EAAkB,yBAA0B,CAAA,EAAE,EAChFyB,EAAa1B,EAAS,IAAM2B,GAAgCH,EAAkB,MAAOC,EAAiB,KAAK,CAAC,EAG5GG,EAAmB5B,EAAS,IAAM,CAACO,EAAU,KAAK,CAAC,EACnD,CAAE,OAAQsB,CAAe,EAAIC,EAAkB,CACnD,SAAU,CACR,gBAAiBF,CACnB,CAAA,CACD,EAED,SAASG,GAAqB,CACrB1B,EAAA,KAAK2B,EAAO,SAAU,CAAA,CAC/B,CAEA,MAAMC,EAAYjC,EAAS,IAAA,OAAM,OAAAC,EAAAQ,EAAQ,QAAR,YAAAR,EAAe,UAAS,EACzDiC,GAAWD,CAAS,EAEd,MAAAE,EAAQnC,EAAS,IAChBS,EAAQ,MAGN,aAAaA,EAAQ,MAAM,IAAI,GAF7B,UAGV,EACD,OAAA2B,GAAaD,CAAK,EAElBE,GAAY,IAAM,CACZ3B,EAAoB,OACP4B,GAAW5B,EAAoB,KAAK,EAExC,UAAU,aAAa,GAChCL,EAAO,QAAQ2B,EAAO,GAAG,EAAG,CAAA,CAEhC,CACD"}